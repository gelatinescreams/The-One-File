<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The One File : Demo Browser</title>
  <meta name="description" content="Interactive demos for The One File. Map networks, smart homes, sports plays, mind maps, infrastructure or anything with nodes and connections.">
  <meta name="theme-color" content="#0a0a0a">
  <meta property="og:title" content="The One File : Demo Browser">
  <meta property="og:description" content="Interactive demos for The One File. Map networks, smart homes, sports plays, mind maps, infrastructure or anything with nodes and connections.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://therecanonlybe.one/demos/">
  <meta property="og:image" content="https://raw.githubusercontent.com/gelatinescreams/The-One-File/main/assets/theonefile.jpg">
  <meta property="og:site_name" content="The One File">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="The One File : Demo Browser">
  <meta name="twitter:description" content="Interactive demos for The One File. Map networks, smart homes, sports plays, mind maps, infrastructure or anything with nodes and connections.">
  <meta name="twitter:image" content="https://raw.githubusercontent.com/gelatinescreams/The-One-File/main/assets/theonefile.jpg">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, sans-serif; background: #0a0a0a; color: #e5e5e5; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
    .selector { text-align: center; max-width: 420px; width: 100%; padding: 20px; }
    .selector h1 { font-size: 24px; font-weight: 700; margin-bottom: 8px; }
    .selector p { color: #aaa; font-size: 14px; margin-bottom: 32px; }
    .form-row { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; justify-content: center; }
    .form-row label { color: #aaa; font-size: 13px; min-width: 60px; text-align: right; }
    .form-row select {
      padding: 10px 14px;
      background: #0f3460;
      color: #eee;
      border: 1px solid #e5e5e5;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      min-width: 180px;
    }
    .form-row select:hover { background: #1a4a7a; }
    .load-btn {
      margin-top: 24px;
      padding: 14px 40px;
      background: #e94560;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
    }
    .load-btn:hover { background: #d13550; }
    .load-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .github-btn {
      display: inline-block;
      margin-top: 12px;
      padding: 10px 24px;
      background: transparent;
      color: #aaa;
      border: 1px solid #444;
      border-radius: 8px;
      font-size: 14px;
      text-decoration: none;
      transition: border-color 0.2s, color 0.2s;
    }
    .github-btn:hover { border-color: #e5e5e5; color: #e5e5e5; }
    .loading { display: none; align-items: center; justify-content: center; gap: 12px; margin-top: 24px; color: #e94560; }
    .loading.active { display: flex; }
    .spinner {
      width: 28px; height: 28px;
      border: 3px solid #1a1a2e;
      border-top-color: #e94560;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .error { color: #e94560; margin-top: 16px; display: none; }
    .error.active { display: block; }
  </style>
</head>
<body>
  <div class="selector">
    <h1>The One File : Demo Browser</h1>
    <p>Select a version and demo to load</p>
    <div class="form-row">
      <label>Version:</label>
      <select id="version-select">
        <option value="networkening">Networkening</option>
        <option value="core">Core</option>
      </select>
    </div>
    <div class="form-row">
      <label>Demo:</label>
      <select id="demo-select">
        <option value="corporate">Corporate</option>
        <option value="homelab">Homelab</option>
        <option value="sports">Sports</option>
      </select>
    </div>
    <button class="load-btn" id="load-btn" onclick="loadDemo()">Load Demo</button>
    <div class="loading" id="loading">
      <div class="spinner"></div>
      Loading demo...
    </div>
    <div class="error" id="error"></div>
    <div style="margin-top: 32px;">
      <a class="github-btn" href="https://github.com/gelatinescreams/The-One-File" target="_blank" rel="noopener">View on GitHub</a>
    </div>
  </div>

  <script>
    var DEMOS = {
      core: {
        corporate: 'json-exports/the-one-file-corporate-demo.json',
        homelab: 'json-exports/the-one-file-homelab-demo.json'
      },
      networkening: {
        corporate: 'json-exports/theonefile-networkening-corporate-demo.json',
        homelab: 'json-exports/theonefile-networkening-homelab-demo.json',
        sports: 'json-exports/theonefile-networkening-sports-demo.json'
      }
    };

    var BASE_HTML = {
      core: '../the-one-file.html',
      networkening: '../theonefile-networkening.html'
    };

    var DEMO_LABELS = {
      core: { corporate: 'Core / Corporate', homelab: 'Core / Homelab' },
      networkening: { corporate: 'Networkening / Corporate', homelab: 'Networkening / Homelab', sports: 'Networkening / Sports' }
    };

    var DEMO_NAMES = {
      corporate: 'Corporate',
      homelab: 'Homelab',
      sports: 'Sports'
    };

    var PAGE_BASE_URL = window.location.href.replace(/[?#].*$/, '').replace(/[^/]*$/, '');
    var PAGE_ORIGIN = window.location.origin + window.location.pathname;

    var versionSelect = document.getElementById('version-select');
    var demoSelect = document.getElementById('demo-select');
    var params = new URLSearchParams(window.location.search);

    if (params.get('version') && DEMOS[params.get('version')]) {
      versionSelect.value = params.get('version');
    }
    if (params.get('demo') && DEMOS[versionSelect.value][params.get('demo')]) {
      demoSelect.value = params.get('demo');
    }

    if (params.get('autoload') === '1') {
      loadDemo();
    }

    function showError(msg) {
      var el = document.getElementById('error');
      el.textContent = msg;
      el.classList.add('active');
    }

    async function loadDemo() {
      var version = versionSelect.value;
      var demo = demoSelect.value;

      if (!DEMOS[version] || !DEMOS[version][demo]) {
        showError('Invalid demo selection');
        return;
      }

      document.getElementById('load-btn').disabled = true;
      document.getElementById('loading').classList.add('active');
      document.getElementById('error').classList.remove('active');

      try {
        var responses = await Promise.all([
          fetch(BASE_HTML[version]),
          fetch(DEMOS[version][demo])
        ]);

        if (!responses[0].ok || !responses[1].ok) throw new Error('Failed to load files');

        var html = await responses[0].text();
        var demoData = await responses[1].json();

        var versionDemos = DEMOS[version];
        var versionLabels = {};
        for (var k in versionDemos) {
          versionLabels[k] = DEMO_NAMES[k] || k;
        }

        var demoLabel = (DEMO_LABELS[version] && DEMO_LABELS[version][demo]) || (version + ' / ' + demo);

        var selectOptions = '';
        for (var demoKey in versionDemos) {
          var sel = demoKey === demo ? ' selected' : '';
          selectOptions += '<option value="' + demoKey + '"' + sel + '>' + (versionLabels[demoKey] || demoKey) + '</option>';
        }

        var absoluteDemoUrls = {};
        for (var dk in versionDemos) {
          absoluteDemoUrls[dk] = PAGE_BASE_URL + versionDemos[dk];
        }

        var selectorUrl = PAGE_ORIGIN;

        var toolbarHtml = '<div id="demo-toolbar" style="' +
          'position:fixed;top:0;left:0;right:0;height:44px;' +
          'background:linear-gradient(135deg,#3e3e59 0%,#14151c 100%);' +
          'border-bottom:2px solid #0f3460;' +
          'display:flex;align-items:center;padding:0 20px;gap:12px;' +
          'z-index:999999;box-shadow:0 2px 10px rgba(0,0,0,0.5);font-family:system-ui,sans-serif;' +
          '">' +
          '<span id="demo-version-label" style="color:#e5e5e5;font-size:14px;font-weight:700;white-space:nowrap">' + (version === 'core' ? 'Core' : 'Networkening') + '</span>' +
          '<select id="demo-switcher" style="' +
          'padding:5px 10px;background:#0f3460;color:#eee;border:1px solid #e94560;' +
          'border-radius:5px;font-size:13px;cursor:pointer;outline:none;' +
          '">' + selectOptions + '</select>' +
          '<span id="demo-loading-indicator" style="color:#e94560;font-size:12px;display:none">Loading...</span>' +
          '<a href="' + selectorUrl + '" style="' +
          'color:#888;font-size:12px;text-decoration:none;white-space:nowrap;' +
          '">All Demos</a>' +
          '<a href="https://github.com/gelatinescreams/The-One-File" target="_blank" rel="noopener" style="' +
          'color:#aaa;font-size:13px;text-decoration:none;padding:6px 14px;' +
          'border:1px solid #444;border-radius:5px;white-space:nowrap;margin-left:auto;' +
          '">GitHub</a>' +
          '</div>';

        var toolbarPadding = '<st' + 'yle>body{padding-top:44px !important}</st' + 'yle>';

        var autosaveBlocker = '<scr' + 'ipt>' +
          '(function(){' +
          'window.DEMO_MODE=true;' +
          'var blocked=["topology","autosave","savedState","nodeData","edgeData","canvasState","lastState","PAGE_STATE","theonefile"];' +
          'function isBlocked(k){if(!k)return false;var l=k.toLowerCase();for(var i=0;i<blocked.length;i++){if(l.indexOf(blocked[i].toLowerCase())!==-1)return true;}return false;}' +
          'var origGet=localStorage.getItem.bind(localStorage);' +
          'var origSet=localStorage.setItem.bind(localStorage);' +
          'var origRem=localStorage.removeItem.bind(localStorage);' +
          'localStorage.getItem=function(k){if(isBlocked(k))return null;return origGet(k);};' +
          'localStorage.setItem=function(k,v){if(isBlocked(k))return;return origSet(k,v);};' +
          'localStorage.removeItem=function(k){if(isBlocked(k))return;return origRem(k);};' +
          'var origOpen=indexedDB.open.bind(indexedDB);' +
          'indexedDB.open=function(name){' +
          'if(name&&name.toLowerCase().indexOf("theonefile")!==-1){' +
          'var fr={result:null,error:null,onsuccess:null,onerror:null,onupgradeneeded:null,onblocked:null,readyState:"done",transaction:null,source:null};' +
          'setTimeout(function(){if(fr.onerror)fr.onerror(new Event("error"));},0);return fr;}' +
          'return origOpen.apply(indexedDB,arguments);};' +
          '})();' +
          '</scr' + 'ipt>';

        var switcherScript = '<scr' + 'ipt>' +
          'window.__DEMO_URLS=' + JSON.stringify(absoluteDemoUrls) + ';' +
          '(function(){' +
          'function applyDemoData(d){' +
          'NODE_DATA=d.nodeData||{};' +
          'EDGE_DATA=d.edgeData||{list:[]};' +
          'EDGE_LEGEND=d.edgeLegend||{};' +
          'if(typeof RECT_DATA!=="undefined")RECT_DATA=d.rectData||{list:[]};' +
          'if(typeof TEXT_DATA!=="undefined")TEXT_DATA=d.textData||{list:[]};' +
          'savedPositions=d.nodePositions||{};' +
          'savedSizes=d.nodeSizes||{};' +
          'savedStyles=d.nodeStyles||{};' +
          'if(d.page&&typeof PAGE_STATE!=="undefined"&&typeof DEFAULT_PAGE_STATE!=="undefined"){' +
          'PAGE_STATE=Object.assign({},DEFAULT_PAGE_STATE,d.page);' +
          'if(typeof wieldThePower==="function")wieldThePower();}' +
          'if(d.canvas&&typeof canvasState!=="undefined"){' +
          'canvasState.zoom=d.canvas.zoom||1;canvasState.panX=d.canvas.panX||0;canvasState.panY=d.canvas.panY||0;}' +
          'if(d.documentTabs&&typeof documentTabs!=="undefined"){documentTabs=d.documentTabs;currentTabIndex=d.currentTabIndex||0;}' +
          'if(d.page&&d.page.title){document.title=d.page.title;' +
          'var te=document.querySelector(".editable-page-title");if(te)te.textContent=d.page.title;}' +
          'var lm={"physical":"layer1","logical":"layer2","security":"layer3","application":"layer4"};' +
          'Object.values(NODE_DATA).forEach(function(n){if(!n.tags)n.tags=[];if(!n.notes)n.notes=[];if(!n.layer||lm[n.layer])n.layer=lm[n.layer]||"layer1";});' +
          'forgeTheTopology();' +
          'if(typeof updateViewBox==="function")updateViewBox();' +
          '}' +
          'function waitForReady(cb){' +
          'if(typeof NODE_DATA!=="undefined"&&typeof forgeTheTopology==="function"){cb();return;}' +
          'setTimeout(function(){waitForReady(cb);},50);' +
          '}' +
          'waitForReady(function(){' +
          'var sel=document.getElementById("demo-switcher");' +
          'if(!sel)return;' +
          'sel.addEventListener("change",function(){' +
          'var key=sel.value;var url=window.__DEMO_URLS[key];' +
          'if(!url)return;' +
          'var indicator=document.getElementById("demo-loading-indicator");' +
          'if(indicator)indicator.style.display="inline";' +
          'sel.disabled=true;' +
          'fetch(url).then(function(r){' +
          'if(!r.ok)throw new Error("Failed to load");return r.json();' +
          '}).then(function(d){' +
          'applyDemoData(d);' +
          'if(indicator)indicator.style.display="none";' +
          'sel.disabled=false;' +
          '}).catch(function(e){' +
          'console.error("Demo switch error:",e);' +
          'if(indicator){indicator.style.display="inline";indicator.textContent="Error loading";}' +
          'sel.disabled=false;' +
          'setTimeout(function(){if(indicator){indicator.style.display="none";indicator.textContent="Loading...";}},3000);' +
          '});' +
          '});' +
          '});' +
          '})();' +
          '</scr' + 'ipt>';

        var dataLoaderScript = '<scr' + 'ipt>' +
          'window.__DEMO_DATA=' + JSON.stringify(demoData) + ';' +
          '(function(){' +
          'function applyData(){' +
          'if(typeof NODE_DATA==="undefined"||typeof forgeTheTopology==="undefined"){setTimeout(applyData,50);return;}' +
          'var d=window.__DEMO_DATA;' +
          'NODE_DATA=d.nodeData||{};' +
          'EDGE_DATA=d.edgeData||{list:[]};' +
          'EDGE_LEGEND=d.edgeLegend||{};' +
          'if(typeof RECT_DATA!=="undefined")RECT_DATA=d.rectData||{list:[]};' +
          'if(typeof TEXT_DATA!=="undefined")TEXT_DATA=d.textData||{list:[]};' +
          'savedPositions=d.nodePositions||{};' +
          'savedSizes=d.nodeSizes||{};' +
          'savedStyles=d.nodeStyles||{};' +
          'if(d.page&&typeof PAGE_STATE!=="undefined"&&typeof DEFAULT_PAGE_STATE!=="undefined"){' +
          'PAGE_STATE=Object.assign({},DEFAULT_PAGE_STATE,d.page);' +
          'if(typeof wieldThePower==="function")wieldThePower();}' +
          'if(d.canvas&&typeof canvasState!=="undefined"){' +
          'canvasState.zoom=d.canvas.zoom||1;canvasState.panX=d.canvas.panX||0;canvasState.panY=d.canvas.panY||0;}' +
          'if(d.documentTabs&&typeof documentTabs!=="undefined"){documentTabs=d.documentTabs;currentTabIndex=d.currentTabIndex||0;}' +
          'if(d.page&&d.page.title){document.title=d.page.title;' +
          'var te=document.querySelector(".editable-page-title");if(te)te.textContent=d.page.title;}' +
          'var lm={"physical":"layer1","logical":"layer2","security":"layer3","application":"layer4"};' +
          'Object.values(NODE_DATA).forEach(function(n){if(!n.tags)n.tags=[];if(!n.notes)n.notes=[];if(!n.layer||lm[n.layer])n.layer=lm[n.layer]||"layer1";});' +
          'forgeTheTopology();' +
          'if(typeof updateViewBox==="function")updateViewBox();' +
          'if(typeof showWelcomeModal==="function")showWelcomeModal();' +
          'delete window.__DEMO_DATA;' +
          '}' +
          'applyData();' +
          '})();' +
          '</scr' + 'ipt>';

        html = html.replace(/<head[^>]*>/i, '$&' + autosaveBlocker + toolbarPadding);
        html = html.replace(/<\/head>/i, switcherScript + dataLoaderScript + '</head>');
        html = html.replace(/<body[^>]*>/i, '$&' + toolbarHtml);

        var blob = new Blob([html], { type: 'text/html' });
        var blobUrl = URL.createObjectURL(blob);
        window.location.href = blobUrl;

      } catch (error) {
        console.error('Error loading demo:', error);
        document.getElementById('load-btn').disabled = false;
        document.getElementById('loading').classList.remove('active');
        showError('Failed to load demo. Please try again.');
      }
    }
  </script>
</body>
</html>
