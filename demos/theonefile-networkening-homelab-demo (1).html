<!DOCTYPE html>
<html lang="en" style="
   --panel: #0b0e13;
   --panel-alt: #10141b;
   --accent: #4fd1c5;
   --danger: #f56565;
   --text-main: #e2e8f0;
   --text-soft: #94a3b8;
   --topbar-bg: rgba(9, 12, 20, 0.9);
   --topbar-border: #1f2533;
   --topbar-height: 100px;
   --sidebar-width: 435px;
   --mobile-footer-height: 20vh;
   "><head>
  <meta charset="UTF-8">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Homelab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- 
         * ==================================================================================
         * The One File: The Networkening
		 * !!!!!!!!!!!!!!!!!!!NOTE: THIS IS THE ONLINE VERSION!!!!!!!!!!!!!!!!!!!!!!
		 * Online version uses 3 cdn calls from cdn.jsdelivr.net to display additional icons
         * "There can be only one". A all in one file topology maker.
         * 
         * This is your last backup when all others fail. A completely self-contained
         * network topology visualization tool that works as a single HTML file.
         * Open it anywhere, anytime and the idea lives forever.
         * ==================================================================================
         -->
  <style>
   :root {
    color-scheme: dark;
    --bg: #050608;
    --panel: #0b0e13;
    --panel-alt: #10141b;
    --accent: #4fd1c5;
    --danger: #f56565;
    --text-main: #e2e8f0;
    --text-soft: #94a3b8;
    --edge-main: #475569;
    --node-min: 35px;
    --node-max: 70px;
    --topbar-bg: rgba(9, 12, 20, 0.9);
    --topbar-border: #1f2533;
   }

   * {
    box-sizing: border-box;
    user-select: none;
   }

   input,
   textarea,
   [contenteditable="true"] {
    user-select: text;
    -webkit-user-select: text;
   }

   body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: radial-gradient(circle at top, #1e2532 0, #050608 70%);
    color: var(--text-main);
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
   }

   header {
    padding: 0 20px;
    height: var(--topbar-height, 52px);
    min-height: var(--topbar-height, 52px);
    background: var(--topbar-bg);
    backdrop-filter: blur(6px);
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--topbar-border);
    gap: 16px;
   }

   .title-block {
    display: flex;
    flex-direction: column;
    gap: 6px;
    min-width: 0;
   }

   header h1 {
    font-size: clamp(22px, 3vw, 32px);
    margin: 0;
    white-space: nowrap;
    text-overflow: ellipsis;
    overflow: hidden;
   }

   .editable-page-title {
    cursor: pointer;
    transition: opacity 0.2s;
   }

   .editable-page-title:hover {
    opacity: 0.7;
   }

   .save-row {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
   }

   .save-btn {
    padding: 6px 12px;
    background: var(--accent);
    color: var(--bg);
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    white-space: nowrap;
   }

   .save-btn:hover {
    opacity: 0.9;
   }

   .help-icon {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    border: 1px solid var(--edge-main);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    cursor: pointer;
    color: var(--text-soft);
    background: rgba(15, 23, 42, 0.9);
    flex-shrink: 0;
   }

   .help-icon:hover {
    color: var(--accent);
    border-color: var(--accent);
   }

   #settings-btn {
    background: var(--panel);
    color: var(--text-main);
    border: 1px solid var(--edge-main);
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    flex-shrink: 0;
   }

   #settings-btn:hover {
    background: var(--accent);
    color: var(--bg);
   }

   main {
    display: grid;
    grid-template-columns: 1fr var(--sidebar-width, 350px);
    flex: 1;
   }

   main.sidebar-collapsed {
    grid-template-columns: 1fr 0;
   }

   @media (max-width: 1024px) {
    main {
     grid-template-columns: 1fr var(--sidebar-width, 300px);
    }
   }

   @media (max-width: 768px) {
    main {
     grid-template-columns: 1fr;
     grid-template-rows: calc(100vh - var(--topbar-height, 52px) - var(--mobile-footer-height, 40vh)) var(--mobile-footer-height, 40vh);
    }

    main.sidebar-collapsed {
     grid-template-rows: 1fr 0;
    }

    .details-panel {
     max-height: var(--mobile-footer-height, 40vh);
     height: 100%;
    }
   }

   @media (max-width: 380px) {
    main {
     grid-template-rows: calc(100vh - var(--topbar-height, 52px) - var(--mobile-footer-height, 40vh)) var(--mobile-footer-height, 40vh);
    }
   }

   .topology-panel {
    background: var(--panel);
    border-right: 1px solid #111827;
    position: relative;
    overflow: hidden;
   }

   .topology-toolbar {
    position: absolute;
    top: 10px;
    right: 10px;
    display: none;
    align-items: center;
    gap: 8px;
    padding: 6px 10px;
    background: rgba(15, 23, 42, 0.92);
    border: 1px solid #1f2937;
    border-radius: 6px;
    z-index: 20;
    font-size: 13px;
   }

   .topology-toolbar label {
    color: var(--text-soft);
   }

   .topology-toolbar select {
    padding: 4px 6px;
    background: var(--panel);
    border: 1px solid var(--edge-main);
    border-radius: 4px;
    color: var(--text-main);
    font-size: 13px;
    cursor: pointer;
   }

   .topology-toolbar button {
    padding: 4px 10px;
    background: var(--accent);
    color: var(--bg);
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
   }

   .draw-toolbar {
    position: absolute;
    top: 10px;
    left: 10px;
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 8px;
    background: rgba(15, 23, 42, 0.92);
    border: 1px solid #1f2937;
    border-radius: 6px;
    z-index: 20;
    font-size: 13px;
    pointer-events: auto;
   }

   .draw-toolbar button {
    padding: 4px 8px;
    background: var(--panel);
    color: var(--text-main);
    border: 1px solid var(--edge-main);
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
   }

   .draw-toolbar button:hover {
    background: var(--accent);
    color: var(--bg);
   }

   .draw-toolbar input[type="color"] {
    width: 30px;
    height: 22px;
    border-radius: 4px;
    border: 1px solid var(--edge-main);
    padding: 0;
    background: transparent;
    cursor: pointer;
   }

   .draw-toolbar select {
    padding: 4px 6px;
    background: var(--panel);
    border: 1px solid var(--edge-main);
    border-radius: 4px;
    color: var(--text-main);
    font-size: 13px;
    cursor: pointer;
   }

   .legend-container {
    position: absolute;
    left: 10px;
    bottom: 10px;
    display: none;
    flex-direction: column;
    gap: 6px;
    padding: 8px 10px;
    background: rgba(15, 23, 42, 0.92);
    border: 1px solid #1f2937;
    border-radius: 6px;
    font-size: 12px;
    z-index: 20;
    max-width: 260px;
    pointer-events: auto;
   }

   .legend-container {
    padding-right: 22px;
   }

   .legend-close-btn {
    position: absolute;
    top: -6px;
    right: -6px;
    width: 18px;
    height: 18px;
    border-radius: 999px;
    border: 1px solid var(--edge-main);
    background: var(--panel-alt);
    color: var(--text-soft);
    font-size: 11px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
   }

   .legend-close-btn:hover {
    background: var(--danger);
    color: #fff;
   }

   .legend-mini-btn {
    position: absolute;
    left: 10px;
    padding: 4px 8px;
    border-radius: 4px;
    border: 1px solid #1f2937;
    background: rgba(15, 23, 42, 0.92);
    color: var(--text-main);
    font-size: 11px;
    cursor: pointer;
    z-index: 20;
    display: none;
    transition: all 0.2s;
   }

   .legend-mini-btn:hover,
   .legend-mini-btn:active {
    background: var(--accent);
    color: var(--bg);
    border-color: var(--accent);
   }

   .legend-title {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--text-soft);
    margin-bottom: 2px;
   }

   .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
   }

   .legend-swatch {
    width: 14px;
    height: 14px;
    border-radius: 3px;
    border: 1px solid #020617;
    flex-shrink: 0;
   }

   .legend-label {
    outline: none;
    cursor: text;
    flex: 1;
    min-width: 60px;
    user-select: text;
    -webkit-user-select: text;
   }

   .legend-label.editing {
    border-bottom: 1px dashed var(--accent);
   }

   .canvas-viewport {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    overflow: hidden;
   }

   .canvas-viewport.panning {
    cursor: grabbing !important;
   }

   .canvas-viewport.panning * {
    cursor: grabbing !important;
   }

   .canvas-viewport svg {
    width: 100%;
    height: 100%;
    display: block;
    background: linear-gradient(rgba(71, 85, 105, 0.1) 1px,
      transparent 1px),
     linear-gradient(90deg,
      rgba(71, 85, 105, 0.1) 1px,
      transparent 1px),
     linear-gradient(rgba(71, 85, 105, 0.05) 1px, transparent 1px),
     linear-gradient(90deg,
      rgba(71, 85, 105, 0.05) 1px,
      transparent 1px);
    background-size:
     100px 100px,
     100px 100px,
     20px 20px,
     20px 20px;
    background-position:
     -1px -1px,
     -1px -1px,
     -1px -1px,
     -1px -1px;
   }

   .zoom-toolbar {
    display: flex;
    gap: 4px;
    padding: 6px;
    background: rgba(15, 23, 42, 0.92);
    border: 1px solid #1f2937;
    border-radius: 6px;
   }

   .zoom-toolbar button {
    width: 32px;
    height: 32px;
    padding: 0;
    background: var(--panel);
    color: var(--text-main);
    border: 1px solid var(--edge-main);
    border-radius: 4px;
    cursor: pointer;
    font-size: 18px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
   }

   .zoom-toolbar button:hover {
    background: var(--accent);
    color: var(--bg);
   }

   .zoom-toolbar .zoom-level {
    font-size: 11px;
    color: var(--text-soft);
    text-align: center;
    padding: 2px 0;
    min-width: 32px;
   }

   .zoom-toolbar .divider {
    height: 1px;
    background: var(--edge-main);
    margin: 2px 0;
   }

   .minimap-zoom-wrapper {
    position: absolute;
    bottom: 10px;
    right: 10px;
    z-index: 19;
   }

   .minimap-container {
    background: rgba(15, 23, 42, 0.92);
    border: 1px solid #1f2937;
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 4px;
   }

   .minimap-container svg {
    width: 100%;
    height: 100%;
   }

   .minimap-viewport {
    fill: rgba(79, 209, 197, 0.2);
    stroke: var(--accent);
    stroke-width: 2;
    cursor: move;
   }

   .minimap-node {
    fill: var(--text-soft);
   }

   .minimap-edge {
    stroke: var(--edge-main);
    stroke-width: 1;
   }

   .minimap-close-btn {
    position: absolute;
    top: 2px;
    right: 2px;
    width: 18px;
    height: 18px;
    background: rgba(15, 23, 42, 0.9);
    border: 1px solid var(--edge-main);
    border-radius: 3px;
    color: var(--text-soft);
    font-size: 11px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    padding: 0;
    line-height: 1;
   }

   .minimap-close-btn:hover {
    background: var(--danger);
    color: white;
    border-color: var(--danger);
   }

   .toolbar-close-btn {
    width: 24px;
    height: 24px;
    background: rgba(15, 23, 42, 0.9);
    border: 1px solid var(--edge-main);
    border-radius: 4px;
    color: var(--text-soft);
    font-size: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    line-height: 1;
    flex-shrink: 0;
   }

   .toolbar-close-btn:hover {
    background: var(--danger);
    color: white;
    border-color: var(--danger);
   }

   .canvas-hint {
    position: absolute;
    top: 50px;
    left: 50%;
    transform: translateX(-50%);
    padding: 8px 16px;
    background: rgba(15, 23, 42, 0.92);
    border: 1px solid #1f2937;
    border-radius: 6px;
    font-size: 12px;
    color: var(--text-soft);
    z-index: 18;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s;
   }

   .canvas-hint.visible {
    opacity: 1;
   }

   .edge {
    stroke: var(--edge-main);
    stroke-width: 4;
    opacity: 0.75;
    transition: 0.25s ease-in-out;
    cursor: pointer;
   }

   .edge.backup {
    stroke: var(--danger);
    stroke-width: 5;
   }

   .edge.active {
    opacity: 1;
    stroke-width: 7;
   }

   .free-preview {
    fill: none;
    stroke-dasharray: 4 4;
    pointer-events: none;
   }

   .free-point {
    fill: #e5e7eb;
    stroke: #0f172a;
    stroke-width: 1.5;
    cursor: grab;
   }

   .node-circle {
    transition: 0.25s ease;
    transform-origin: center center;
   }

   .node-hit-area {
    cursor: grab;
    pointer-events: all;
   }

   .node-group:hover .node-circle {
    transform: scale(1.08);
    filter: drop-shadow(0 0 10px rgba(79, 209, 197, 0.45));
   }

   .node-group:hover .node-label,
   .node-group:hover .node-sub {
    transform: scale(1.08);
   }

   .node-group.active .node-circle {
    stroke: var(--accent);
    animation: pulse 1.2s infinite ease-in-out;
   }

   @keyframes pulse {
    0% {
     filter: drop-shadow(0 0 4px #4fd1c5);
    }

    50% {
     filter: drop-shadow(0 0 14px #4fd1c5);
    }

    100% {
     filter: drop-shadow(0 0 4px #4fd1c5);
    }
   }

   .node-label {
    fill: var(--text-main);
    font-size: 18px;
    text-anchor: middle;
    font-weight: 600;
   }

   .node-sub {
    fill: var(--text-soft);
    font-size: 13px;
    text-anchor: middle;
   }

   @media (max-width: 1024px) {
    .node-label {
     font-size: 28px;
    }

    .node-sub {
     font-size: 20px;
    }
   }

   @media (max-width: 768px) {
    .node-label {
     font-size: 70px;
    }

    .node-sub {
     font-size: 50px;
    }
   }

   @media (max-width: 380px) {
    .node-label {
     font-size: 60px;
    }

    .node-sub {
     font-size: 42px;
    }
   }

   .details-panel {
    background: var(--panel-alt);
    padding: 22px;
    padding-bottom: 80px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 15px;
    position: relative;
    transition:
     width 0.3s ease,
     min-width 0.3s ease,
     padding 0.3s ease,
     opacity 0.3s ease;
   }

   .details-panel {
    min-width: 260px !important;
   }

   .details-panel {
    overflow-y: auto !important;
    overflow-x: hidden;
   }

   .details-panel.collapsed {
    width: 0 !important;
    min-width: 0 !important;
    padding: 0 !important;
    overflow: hidden;
    opacity: 0;
   }

   body {
    overflow-x: hidden;
    overflow-y: hidden;
   }

   main {
    overflow-x: hidden;
    overflow-y: visible;
   }

   .details-panel {
    overflow-y: auto !important;
    overflow-x: hidden;
   }

   .details-panel.collapsed {
    min-width: 0 !important;
   }

   .sidebar-toggle {
    position: absolute;
    left: -16px;
    top: 50%;
    transform: translateY(-50%);
    width: 16px;
    height: 60px;
    background: var(--panel-alt);
    border: 1px solid var(--edge-main);
    border-right: none;
    border-radius: 8px 0 0 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-soft);
    font-size: 10px;
    z-index: 25;
    transition:
     background 0.2s,
     color 0.2s;
   }

   .sidebar-toggle:hover {
    background: var(--accent);
    color: var(--bg);
   }

   .sidebar-toggle.collapsed {
    left: 0;
    border-right: 1px solid var(--edge-main);
    border-radius: 0 8px 8px 0;
    position: fixed;
    right: 0;
    left: auto;
   }

   .details-name {
    font-size: clamp(22px, 2.5vw, 30px);
    font-weight: 700;
   }

   .details-ip {
    font-size: clamp(16px, 2vw, 22px);
    color: var(--text-soft);
   }

   .details-role {
    font-size: clamp(16px, 2vw, 22px);
    color: var(--accent);
   }

   .size-controls {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-top: 10px;
   }

   .size-controls label {
    font-size: clamp(14px, 1.6vw, 18px);
    color: var(--text-soft);
   }

   .size-controls input[type="range"] {
    flex: 1;
    accent-color: var(--accent);
   }

   .size-controls button {
    padding: 6px 12px;
    background: var(--panel);
    color: var(--text-main);
    border: 1px solid var(--edge-main);
    border-radius: 4px;
    cursor: pointer;
    font-size: clamp(12px, 1.4vw, 16px);
   }

   .size-controls button:hover {
    background: var(--accent);
    color: var(--bg);
   }

   .style-section {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid var(--edge-main);
   }

   .style-section summary {
    cursor: pointer;
    font-size: clamp(14px, 1.6vw, 20px);
    text-transform: uppercase;
    color: var(--text-soft);
    list-style: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
    user-select: none;
   }

   .style-section summary::-webkit-details-marker {
    display: none;
   }

   .password-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #ffffff;
    z-index: 9999;
   }

   .style-section summary::after {
    content: "‚ñº";
    transition: transform 0.2s;
   }

   .style-section[open] summary::after {
    transform: rotate(180deg);
   }

   .style-content {
    margin-top: 10px;
   }

   .style-row {
    display: flex;
    gap: 10px;
    align-items: center;
    margin: 8px 0;
   }

   .style-row label {
    font-size: clamp(13px, 1.5vw, 17px);
    color: var(--text-soft);
    min-width: 80px;
   }

   .style-row input[type="color"] {
    width: 50px;
    height: 30px;
    border: 1px solid var(--edge-main);
    border-radius: 4px;
    cursor: pointer;
    background: transparent;
   }

   .style-row input[type="number"] {
    width: 70px;
    padding: 4px 8px;
    background: var(--panel);
    border: 1px solid var(--edge-main);
    border-radius: 4px;
    color: var(--text-main);
    font-size: clamp(12px, 1.4vw, 16px);
   }

   .style-row select {
    flex: 1;
    padding: 4px 8px;
    background: var(--panel);
    border: 1px solid var(--edge-main);
    border-radius: 4px;
    color: var(--text-main);
    font-size: clamp(12px, 1.4vw, 16px);
    cursor: pointer;
   }

   .editable-text {
    cursor: pointer;
    transition: opacity 0.2s;
   }

   .editable-text:hover {
    opacity: 0.7;
   }

   .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 1000;
    justify-content: center;
    align-items: center;
   }

   .modal.active {
    display: flex;
   }

   .modal-content {
    background: var(--panel-alt);
    padding: 25px;
    border-radius: 8px;
    border: 1px solid var(--edge-main);
    min-width: 300px;
    max-width: 90%;
   }

   .modal-content h3 {
    margin: 0 0 15px 0;
    color: var(--text-main);
    font-size: clamp(18px, 2vw, 24px);
   }

   .modal-content p {
    color: var(--text-soft);
    font-size: clamp(14px, 1.6vw, 18px);
    margin: 0 0 20px 0;
   }

   .modal-content input:not([type="color"]),
   .modal-content select {
    width: 100%;
    padding: 10px;
    background: var(--panel);
    border: 1px solid var(--edge-main);
    border-radius: 4px;
    color: var(--text-main);
    font-size: clamp(14px, 1.6vw, 18px);
    margin-bottom: 15px;
    user-select: text;
    -webkit-user-select: text;
   }

   .modal-content input[type="color"] {
    width: 60px;
    height: 36px;
    padding: 2px;
    border: 2px solid var(--edge-main);
    border-radius: 6px;
    cursor: pointer;
    background: none;
    -webkit-appearance: none;
    appearance: none;
   }

   .modal-content input[type="color"]::-webkit-color-swatch-wrapper {
    padding: 0;
   }

   .modal-content input[type="color"]::-webkit-color-swatch {
    border: none;
    border-radius: 4px;
   }

   .modal-buttons {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
    margin-top: 10px;
   }

   .modal-buttons button {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: clamp(14px, 1.6vw, 18px);
    font-weight: 600;
   }

   .modal-buttons .btn-cancel {
    background: var(--panel);
    color: var(--text-main);
    border: 1px solid var(--edge-main);
   }

   .modal-buttons .btn-save {
    background: var(--accent);
    color: var(--bg);
   }

   .modal-buttons .btn-delete {
    background: var(--danger);
    color: white;
   }

   .confirm-modal p {
    color: var(--text-soft);
    font-size: clamp(14px, 1.6vw, 18px);
    margin: 0 0 20px 0;
   }

   .badge-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
   }

   .badge {
    border: 1px solid var(--edge-main);
    padding: 5px 12px;
    border-radius: 22px;
    font-size: clamp(12px, 1.4vw, 18px);
   }

   .badge.wg {
    color: var(--accent);
    border-color: var(--accent);
   }

   .section-label {
    margin-top: 8px;
    font-size: clamp(14px, 1.6vw, 20px);
    text-transform: uppercase;
    color: var(--text-soft);
   }

   .list li {
    margin: 6px 0;
    font-size: clamp(14px, 1.6vw, 20px);
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
   }

   .list li:hover {
    color: var(--accent);
   }

   .delete-note {
    color: var(--danger);
    font-size: 18px;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.2s;
    flex-shrink: 0;
   }

   .list li:hover .delete-note {
    opacity: 1;
   }

   .editing {
    outline: 2px solid var(--accent);
    background: #0d141f;
    padding: 4px;
    border-radius: 6px;
    user-select: text;
    -webkit-user-select: text;
   }

   .mobile-menu-btn {
    display: none;
    background: var(--panel);
    border: 1px solid var(--edge-main);
    color: var(--text-main);
    font-size: 22px;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
   }

   #topbar-menu {
    gap: 8px;
   }

   @media (min-width: 721px) {
    #topbar-menu {
     display: flex !important;
    }
   }

   @media (max-width: 720px) {
    #topbar-menu {
     display: none;
    }

    #topbar-menu.open {
     display: flex;
    }
   }

   @media (max-width: 720px) {
    .mobile-menu-btn {
     display: block;
    }

    #topbar-menu {
     position: absolute;
     top: var(--topbar-height);
     right: 0;
     background: var(--panel-alt);
     border-left: 1px solid var(--topbar-border);
     border-bottom: 1px solid var(--topbar-border);
     padding: 12px;
     display: none;
     flex-direction: column;
     width: 180px;
     z-index: 999;
    }

    #topbar-menu.open {
     display: flex;
    }

    header {
     position: relative;
     z-index: 9999;
    }
   }

   @media (max-width: 720px) {

    .draw-toolbar,
    .topology-toolbar {
     position: absolute;
     top: auto;
     bottom: auto;
     left: 10px !important;
     right: auto !important;
     width: auto;
     gap: 6px;
     padding: 8px;
    }

    .draw-toolbar {
     top: 10px !important;
    }

    .topology-toolbar {
     top: calc(10px + var(--draw-toolbar-height, 50px)) !important;
    }

    .canvas-hint {
     top: calc(10px + 120px);
    }
   }

   .icon-picker-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 10000;
    justify-content: center;
    align-items: center;
   }

   .icon-picker-modal.active {
    display: flex;
   }

   .icon-picker-content {
    background: var(--panel);
    border-radius: 12px;
    width: 90%;
    max-width: 800px;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
    border: 1px solid var(--edge-main);
   }

   .icon-picker-header {
    padding: 20px;
    border-bottom: 1px solid var(--edge-main);
   }

   .icon-picker-header h3 {
    margin: 0 0 15px 0;
    color: var(--text-main);
   }

   .icon-picker-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
   }

   .icon-picker-tab {
    padding: 8px 16px;
    background: var(--panel-alt);
    border: 1px solid var(--edge-main);
    border-radius: 6px;
    cursor: pointer;
    color: var(--text-soft);
    font-size: 14px;
    transition: all 0.2s;
   }

   .icon-picker-tab:hover {
    background: var(--accent);
    color: var(--bg);
   }

   .icon-picker-tab.active {
    background: var(--accent);
    color: var(--bg);
    border-color: var(--accent);
   }

   .icon-picker-search {
    width: 100%;
    padding: 10px 15px;
    background: var(--panel-alt);
    border: 1px solid var(--edge-main);
    border-radius: 6px;
    color: var(--text-main);
    font-size: 14px;
   }

   .icon-picker-search::placeholder {
    color: var(--text-soft);
   }

   .icon-picker-body {
    padding: 20px;
    overflow-y: auto;
    flex: 1;
   }

   .icon-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 10px;
   }

   .icon-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 15px 10px;
    background: var(--panel-alt);
    border: 1px solid var(--edge-main);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
   }

   .icon-item:hover {
    background: var(--accent);
    border-color: var(--accent);
    transform: scale(1.05);
   }

   .icon-item svg {
    width: 32px;
    height: 32px;
    fill: var(--text-main);
   }

   .icon-item:hover svg {
    fill: var(--bg);
   }

   .icon-item-name {
    margin-top: 8px;
    font-size: 10px;
    color: var(--text-soft);
    text-align: center;
    word-break: break-word;
   }

   .icon-item:hover .icon-item-name {
    color: var(--bg);
   }

   .icon-picker-loading {
    text-align: center;
    padding: 40px;
    color: var(--text-soft);
   }

   .icon-picker-footer {
    padding: 15px 20px;
    border-top: 1px solid var(--edge-main);
    display: flex;
    justify-content: flex-end;
   }

   .icon-btn-cancel {
    padding: 8px 20px;
    background: var(--panel-alt);
    color: var(--text-main);
    border: 1px solid var(--edge-main);
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
   }

   .icon-btn-cancel:hover {
    background: var(--edge-main);
   }

   .icon-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 4px 8px;
    background: var(--panel-alt);
    border-radius: 4px;
    font-size: 12px;
    margin: 2px;
   }

   .icon-badge svg {
    width: 16px;
    height: 16px;
    fill: currentColor;
   }

   .pick-icon-btn {
    padding: 6px 12px;
    background: var(--accent);
    color: var(--bg);
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    margin-top: 8px;
    width: 100%;
   }

   .pick-icon-btn:hover {
    opacity: 0.9;
   }

   @media (max-width: 768px) {
    .icon-picker-content {
     width: 95%;
     max-height: 90vh;
    }
   }
  </style>
 </head>
 <body style="
      background: radial-gradient(
      circle at center top,
      rgb(30, 37, 50) 0px,
      rgb(5, 6, 8) 70%
      );
      ">
  <div class="icon-picker-modal" id="icon-picker-modal">
   <div class="icon-picker-content">
    <div class="icon-picker-header">
     <h3>Select Icon</h3>
     <div class="icon-picker-tabs">
      <button class="icon-picker-tab active" data-library="mdi">MDI</button>
      <button class="icon-picker-tab" data-library="simple">Simple Icons</button>
      <button class="icon-picker-tab" data-library="selfhst">Selfh.st</button>
     </div>
     <input type="text" class="icon-picker-search" id="icon-search" placeholder="Search icons...">
    </div>
    <div class="icon-picker-body" id="icon-picker-body">
     <div class="icon-picker-loading">Loading icons...</div>
    </div>
    <div class="icon-picker-footer">
     <button class="icon-btn-cancel" id="icon-picker-cancel">Cancel</button>
    </div>
   </div>
  </div>

  <div class="modal" id="edit-modal">
   <div class="modal-content">
    <h3 id="modal-title">Edit Name</h3>
    <input type="text" id="modal-input">
    <div class="modal-buttons">
     <button class="btn-cancel" id="modal-cancel">Cancel</button>
     <button class="btn-save" id="modal-save">Save</button>
    </div>
   </div>
  </div>
  <div class="modal confirm-modal" id="confirm-modal">
   <div class="modal-content">
    <h3>Confirm</h3>
    <p id="confirm-message"> Are you sure you want to delete this line? </p>
    <div class="modal-buttons">
     <button class="btn-cancel" id="confirm-cancel">Cancel</button>
     <button class="btn-delete" id="confirm-delete">Delete</button>
    </div>
   </div>
  </div>
  <div class="modal" id="save-info-modal">
   <div class="modal-content">
    <h3>Why do I need to save?</h3>
    <p> Browsers are not allowed to overwrite local files automatically. When you click <strong>Save File</strong>, this page generates a new updated HTML file that contains all of your changes. Replace your old file with the new one to keep your edits. </p>
    <p style="
               margin-top: 12px;
               padding-top: 12px;
               border-top: 1px solid var(--edge-main);
               ">
     <strong>üîí Encryption:</strong> Check the "Encrypt" box before saving to password protect your data. You'll need the password to open the file later. No recovery possible!!
    </p>
    <div class="modal-buttons">
     <button class="btn-cancel" id="save-info-close">Close</button>
    </div>
   </div>
  </div>
  <div class="modal" id="settings-modal">
   <div class="modal-content" style="max-width: 400px">
    <h3>Page Settings</h3>
    <details class="style-section" open="">
     <summary>Background</summary>
     <div class="style-content">
      <div class="style-row">
       <label>Solid Color</label>
       <input type="color" id="page-bg-color" value="#050608">
      </div>
      <p style="
                     margin-top: 4px;
                     font-size: 12px;
                     color: var(--text-soft);
                     "> Change to apply a flat background color. </p>
     </div>
    </details>
    <details class="style-section" open="">
     <summary>Top Bar</summary>
     <div class="style-content">
      <div class="style-row">
       <label>Background</label>
       <input type="color" id="topbar-bg-color" value="#0b0e13">
      </div>
      <div class="style-row">
       <label>Border</label>
       <input type="color" id="topbar-border-color" value="#1f2533">
      </div>
     </div>
    </details>
    <details class="style-section" open="">
     <summary>Theme Colors</summary>
     <div class="style-content">
      <div class="style-row">
       <label>Panel</label>
       <input type="color" id="panel-color" value="#0b0e13">
      </div>
      <div class="style-row">
       <label>Panel Alt</label>
       <input type="color" id="panel-alt-color" value="#10141b">
      </div>
      <div class="style-row">
       <label>Accent</label>
       <input type="color" id="accent-color" value="#4fd1c5">
      </div>
      <div class="style-row">
       <label>Danger</label>
       <input type="color" id="danger-color" value="#f56565">
      </div>
      <div class="style-row">
       <label>Text Main</label>
       <input type="color" id="text-main-color" value="#e2e8f0">
      </div>
      <div class="style-row">
       <label>Text Soft</label>
       <input type="color" id="text-soft-color" value="#94a3b8">
      </div>
     </div>
    </details>
    <details class="style-section" open="">
     <summary>Import / Export Data</summary>
     <div class="style-content">
      <p style="
                     margin-bottom: 12px;
                     font-size: 13px;
                     color: var(--text-soft);
                     "> Export/Import your data to upgrade/downgrade versions of The One File. </p>
      <button id="export-data-btn" style="
                     width: 100%;
                     margin-bottom: 10px;
                     padding: 10px;
                     background: var(--accent);
                     color: var(--bg);
                     border: none;
                     border-radius: 6px;
                     cursor: pointer;
                     font-size: 14px;
                     font-weight: 600;
                     "> Export Data (JSON) </button>
      <button id="import-data-btn" style="
                     width: 100%;
                     padding: 10px;
                     background: var(--panel);
                     color: var(--text-main);
                     border: 1px solid var(--edge-main);
                     border-radius: 6px;
                     cursor: pointer;
                     font-size: 14px;
                     font-weight: 600;
                     "> Import Data (JSON) </button>
      <input type="file" id="import-data-file" accept=".json" style="display: none">
     </div>
    </details>
    <div class="modal-buttons">
     <button class="btn-cancel" id="settings-close">Close</button>
    </div>
   </div>
  </div>
  <div class="modal" id="add-node-modal">
   <div class="modal-content">
    <h3>Add New Node</h3>
    
    <div style="background: var(--panel-alt); border: 1px solid var(--edge-main); border-radius: 8px; padding: 15px; margin-bottom: 15px;">
     <div style="font-weight: 600; color: var(--text-main); margin-bottom: 12px; font-size: 14px;">Basic Information</div>
     <label style="
                display: block;
                margin-bottom: 4px;
                color: var(--text-soft);
                font-size: 13px;
                ">Name</label>
     <input type="text" id="new-node-name" placeholder="e.g. web server, jellyfin">
     <label style="
                display: block;
                margin-bottom: 4px;
                margin-top: 12px;
                color: var(--text-soft);
                font-size: 13px;
                ">IP / Subtitle</label>
     <input type="text" id="new-node-ip" placeholder="e.g. 192.168.1.100">
    </div>
    
    <div style="background: var(--panel-alt); border: 1px solid var(--edge-main); border-radius: 8px; padding: 15px; margin-bottom: 15px;">
     <div style="font-weight: 600; color: var(--text-main); margin-bottom: 12px; font-size: 14px;">Tags</div>
     <label style="
                display: block;
                margin-bottom: 4px;
                color: var(--text-soft);
                font-size: 13px;
                ">Text Tags (comma separated)</label>
     <input type="text" id="new-node-tags" placeholder="e.g. Docker, nginx, WG: vpn">
     <button class="pick-icon-btn" id="pick-new-node-tag-icon-btn" style="margin-top: 10px;">Add Icon Tag</button>
     <div id="new-node-icon-tags" style="margin-top: 10px; display: none;">
      <label style="display: block; margin-bottom: 8px; color: var(--text-soft); font-size: 13px;">Icon Tags:</label>
      <div id="new-node-icon-tags-list" style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px;"></div>
     </div>
    </div>
    
    <div style="background: var(--panel-alt); border: 1px solid var(--edge-main); border-radius: 8px; padding: 15px; margin-bottom: 15px;">
     <div style="font-weight: 600; color: var(--text-main); margin-bottom: 12px; font-size: 14px;">Node Appearance</div>
     <label style="
                display: block;
                margin-bottom: 4px;
                color: var(--text-soft);
                font-size: 13px;
                ">Shape</label>
     <select id="new-node-shape">
      <optgroup label="Basic Shapes">
       <option value="circle">Circle</option>
       <option value="square">Square</option>
       <option value="rectangle">Rectangle</option>
       <option value="triangle">Triangle</option>
       <option value="hexagon">Hexagon</option>
       <option value="diamond">Diamond</option>
       <option value="star">Star</option>
       <option value="stop-sign">Stop Sign</option>
      </optgroup>
      <optgroup label="Network Equipment">
       <option value="server">Server</option>
       <option value="pc">PC / Desktop</option>
       <option value="laptop">Laptop</option>
       <option value="phone">Phone / Mobile</option>
       <option value="router">Router</option>
       <option value="switch">Switch</option>
       <option value="firewall">Firewall</option>
       <option value="cloud">Cloud</option>
       <option value="database">Database</option>
       <option value="printer">Printer</option>
      </optgroup>
     </select>
     <button class="pick-icon-btn" id="pick-node-icon-btn" style="margin-top: 10px;"> Or Pick an web icon for Node Shape</button>
     <div id="selected-node-icon" style="margin-top: 10px; display: none;">
      <label style="display: block; margin-bottom: 8px; color: var(--text-soft); font-size: 13px;">Selected Icon:</label>
      <div class="icon-badge" id="selected-node-icon-preview"></div>
     </div>
    </div>
    
    <div class="modal-buttons">
     <button class="btn-cancel" id="add-node-cancel">Cancel</button>
     <button class="btn-save" id="add-node-save">Add Node</button>
    </div>
   </div>
  </div>
  <div class="modal confirm-modal" id="clear-all-modal">
   <div class="modal-content">
    <h3>Clear All Nodes</h3>
    <p> This will remove ALL nodes and connections. This cannot be undone until you reload without saving. Are you sure? </p>
    <div class="modal-buttons">
     <button class="btn-cancel" id="clear-all-cancel">Cancel</button>
     <button class="btn-delete" id="clear-all-confirm"> Clear Everything </button>
    </div>
   </div>
  </div>
  <header>
   <div class="title-block">
    <h1 id="page-title" class="editable-page-title">Homelab</h1>
    <div class="save-row">
     <button id="save-file-btn" class="save-btn" type="button"> Save File </button>
     <label style="
                  display: flex;
                  align-items: center;
                  gap: 4px;
                  font-size: 12px;
                  color: var(--text-soft);
                  cursor: pointer;
                  user-select: none;
                  ">
      <input type="checkbox" id="encrypt-toggle" style="cursor: pointer">
      <span title="Encrypt data with password">Encrypt</span>
     </label>
     <span id="save-help-btn" class="help-icon" title="Why save?">?</span>
    </div>
   </div>
   <div id="topbar-menu">
    <button id="add-node-btn" class="save-btn" title="Add new node" style="background: var(--accent)"> + Node </button>
    <button onclick="screenshotCanvas()" title="Export canvas as PNG image" style="
               padding: 6px 12px;
               background: var(--panel);
               color: var(--text-main);
               border: 1px solid var(--edge-main);
               border-radius: 6px;
               cursor: pointer;
               font-size: 14px;
               font-weight: 600;
               "> üì∑ PNG </button>
    <button onclick="exportCanvasSVG()" title="Export canvas as SVG vector" style="
               padding: 6px 12px;
               background: var(--panel);
               color: var(--text-main);
               border: 1px solid var(--edge-main);
               border-radius: 6px;
               cursor: pointer;
               font-size: 14px;
               font-weight: 600;
               "> üìÑ SVG </button>
    <button id="settings-btn" title="Page settings">‚öôÔ∏è</button>
    <button id="clear-all-btn" title="Clear all nodes" style="
               padding: 6px 12px;
               background: var(--danger);
               color: #fff;
               border: none;
               border-radius: 6px;
               cursor: pointer;
               font-size: 14px;
               font-weight: 600;
               "> Clear All </button>
   </div>
   <button id="mobile-menu-toggle" class="mobile-menu-btn">‚ò∞</button>
  </header>
  <main>
   <section class="topology-panel">
    <div class="draw-toolbar" id="draw-toolbar" style="display: flex !important;">
     <button type="button" class="toolbar-close-btn" id="draw-toolbar-close-btn" title="Hide draw toolbar">‚úï</button>
     <button id="draw-toggle" title="Draw custom line">‚úèÔ∏è</button>
     <input type="color" id="draw-color" value="#f97316" title="Line color">
     <select id="draw-style" title="Line style">
      <option value="solid">Solid</option>
      <option value="dashed">Dashed</option>
      <option value="dotted">Dotted</option>
     </select>
     <select id="draw-arrow" title="Arrow direction">
      <option value="none">No arrows</option>
      <option value="forward">‚Üí Right</option>
      <option value="backward">‚Üê Left</option>
      <option value="both">‚Üî Both</option>
     </select>
     <button id="draw-undo" style="display: none" title="Undo last point"> Undo </button>
    </div>
    <div class="topology-toolbar" id="topology-toolbar" style="display: flex !important;">
     <button type="button" class="toolbar-close-btn" id="topology-toolbar-close-btn" title="Hide add line toolbar">‚úï</button>
     <label for="add-line-select">Add line to:</label>
     <select id="add-line-select"><option value="opnsense">OPNsense</option><option value="main-switch">Main Switch</option><option value="proxmox">Proxmox</option><option value="truenas">TrueNAS</option><option value="docker-host">Docker Host</option><option value="pi-hole">Pi-hole</option><option value="plex">Plex</option><option value="jellyfin">Jellyfin</option><option value="nextcloud">Nextcloud</option><option value="bitwarden">Vaultwarden</option><option value="homeassistant">Home Assistant</option><option value="portainer">Portainer</option><option value="traefik">Traefik</option><option value="grafana">Grafana</option><option value="prometheus">Prometheus</option><option value="unifi-controller">UniFi Controller</option><option value="wireguard">WireGuard</option></select>
     <input type="color" id="add-line-color" value="#475569" title="Line color" style="
                  width: 30px;
                  height: 24px;
                  border: 1px solid var(--edge-main);
                  border-radius: 4px;
                  cursor: pointer;
                  background: transparent;
                  padding: 0;
                  ">
     <select id="add-line-direction" title="Line direction">
      <option value="none">No arrows</option>
      <option value="forward">‚Üí Forward</option>
      <option value="backward">‚Üê Backward</option>
      <option value="both">‚Üî Both</option>
     </select>
     <button id="add-line-btn">Add</button>
    </div>
    <div class="canvas-hint" id="canvas-hint"> Scroll to zoom ‚Ä¢ Drag empty space to pan ‚Ä¢ Hold Space + drag </div>
    <div class="legend-container" id="edge-legend" style="display: flex;"><div class="legend-title">Line Legend</div><button type="button" class="legend-close-btn">‚úï</button><div class="legend-item"><span class="legend-swatch" style="background-color: rgb(239, 68, 68);"></span><span class="legend-label" contenteditable="true">WAN</span></div><div class="legend-item"><span class="legend-swatch" style="background-color: rgb(16, 185, 129);"></span><span class="legend-label" contenteditable="true">LAN Trunk</span></div><div class="legend-item"><span class="legend-swatch" style="background-color: rgb(139, 92, 246);"></span><span class="legend-label" contenteditable="true">Server VLAN</span></div><div class="legend-item"><span class="legend-swatch" style="background-color: rgb(59, 130, 246);"></span><span class="legend-label" contenteditable="true">Management</span></div><div class="legend-item"><span class="legend-swatch" style="background-color: rgb(245, 158, 11);"></span><span class="legend-label" contenteditable="true">VM Network</span></div><div class="legend-item"><span class="legend-swatch" style="background-color: rgb(6, 182, 212);"></span><span class="legend-label" contenteditable="true">Containers</span></div><div class="legend-item"><span class="legend-swatch" style="background-color: rgb(236, 72, 153);"></span><span class="legend-label" contenteditable="true">Storage</span></div></div>
    <div class="canvas-viewport" id="canvas-viewport">
     <svg id="map" viewBox="366.66666666666674 0 3266.6666666666665 2450" style=""><defs><marker id="arrow-forward" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M0,0 L0,6 L9,3 z" fill="context-stroke"></path></marker><marker id="arrow-backward" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto" markerUnits="strokeWidth"><path d="M9,0 L9,6 L0,3 z" fill="context-stroke"></path></marker></defs><rect x="100" y="100" width="3800" height="2800" fill="none" stroke="rgba(71, 85, 105, 0.3)" stroke-width="2" stroke-dasharray="10 5" rx="8"></rect><path d="M 2000 200 Q 2000 375 2000 550" fill="none" class="edge active" data-edge-id="edge-1" data-from="isp-modem" data-to="opnsense" style="stroke: rgb(239, 68, 68); stroke-width: 6;"></path><path d="M 2000 550 Q 2000 750 2000 950" fill="none" class="edge" data-edge-id="edge-2" data-from="opnsense" data-to="main-switch" style="stroke: rgb(16, 185, 129); stroke-width: 6;"></path><path d="M 2000 950 Q 1600 1150 1200 1350" fill="none" class="edge" data-edge-id="edge-3" data-from="main-switch" data-to="proxmox" style="stroke: rgb(139, 92, 246); stroke-width: 5;"></path><path d="M 2000 950 Q 2400 1150 2800 1350" fill="none" class="edge" data-edge-id="edge-4" data-from="main-switch" data-to="truenas" style="stroke: rgb(139, 92, 246); stroke-width: 5;"></path><path d="M 2000 950 Q 2000 1150 2000 1350" fill="none" class="edge" data-edge-id="edge-5" data-from="main-switch" data-to="docker-host" style="stroke: rgb(139, 92, 246); stroke-width: 5;"></path><path d="M 2000 950 Q 2000 1300 2000 1650" fill="none" class="edge" data-edge-id="edge-6" data-from="main-switch" data-to="pi-hole" style="stroke: rgb(59, 130, 246); stroke-width: 4;"></path><path d="M 1200 1350 Q 900 1600 600 1850" fill="none" class="edge" data-edge-id="edge-7" data-from="proxmox" data-to="plex" style="stroke: rgb(245, 158, 11); stroke-width: 4;"></path><path d="M 1200 1350 Q 1100 1600 1000 1850" fill="none" class="edge" data-edge-id="edge-8" data-from="proxmox" data-to="homeassistant" style="stroke: rgb(245, 158, 11); stroke-width: 4;"></path><path d="M 1200 1350 Q 1300 1600 1400 1850" fill="none" class="edge" data-edge-id="edge-9" data-from="proxmox" data-to="wireguard" style="stroke: rgb(245, 158, 11); stroke-width: 4;"></path><path d="M 2000 1350 Q 1700 1800 1400 2250" fill="none" class="edge" data-edge-id="edge-10" data-from="docker-host" data-to="jellyfin" style="stroke: rgb(6, 182, 212); stroke-width: 4;"></path><path d="M 2000 1350 Q 1900 1800 1800 2250" fill="none" class="edge" data-edge-id="edge-11" data-from="docker-host" data-to="nextcloud" style="stroke: rgb(6, 182, 212); stroke-width: 4;"></path><path d="M 2000 1350 Q 2100 1800 2200 2250" fill="none" class="edge" data-edge-id="edge-12" data-from="docker-host" data-to="bitwarden" style="stroke: rgb(6, 182, 212); stroke-width: 4;"></path><path d="M 2000 1350 Q 2300 1800 2600 2250" fill="none" class="edge" data-edge-id="edge-13" data-from="docker-host" data-to="portainer" style="stroke: rgb(6, 182, 212); stroke-width: 4;"></path><path d="M 2000 1350 Q 2500 1800 3000 2250" fill="none" class="edge" data-edge-id="edge-14" data-from="docker-host" data-to="traefik" style="stroke: rgb(6, 182, 212); stroke-width: 4;"></path><path d="M 2000 1350 Q 2700 1800 3400 2250" fill="none" class="edge" data-edge-id="edge-15" data-from="docker-host" data-to="grafana" style="stroke: rgb(6, 182, 212); stroke-width: 4;"></path><path d="M 2000 1350 Q 2700 1600 3400 1850" fill="none" class="edge" data-edge-id="edge-16" data-from="docker-host" data-to="prometheus" style="stroke: rgb(6, 182, 212); stroke-width: 4;"></path><path d="M 2000 1350 Q 2500 1600 3000 1850" fill="none" class="edge" data-edge-id="edge-17" data-from="docker-host" data-to="unifi-controller" style="stroke: rgb(6, 182, 212); stroke-width: 4;"></path><path d="M 2800 1350 Q 1700 1600 600 1850" fill="none" class="edge" data-edge-id="edge-18" data-from="truenas" data-to="plex" style="stroke: rgb(236, 72, 153); stroke-width: 3;"></path><path d="M 2800 1350 Q 2100 1800 1400 2250" fill="none" class="edge" data-edge-id="edge-19" data-from="truenas" data-to="jellyfin" style="stroke: rgb(236, 72, 153); stroke-width: 3;"></path><path d="M 2800 1350 Q 2300 1800 1800 2250" fill="none" class="edge" data-edge-id="edge-20" data-from="truenas" data-to="nextcloud" style="stroke: rgb(236, 72, 153); stroke-width: 3;"></path><g class="node-group active" data-node-id="isp-modem" transform="translate(2000,200)" style="cursor: grab;"><circle r="82.5" class="node-hit-area" style="fill: transparent; stroke: none; cursor: grab;"></circle><path d="
          M -44 11
          Q -60.50000000000001 11 -60.50000000000001 -5.5
          Q -60.50000000000001 -27.5 -38.5 -27.5
          Q -38.5 -49.5 -11 -49.5
          Q 5.5 -60.50000000000001 27.5 -44
          Q 55 -44 60.50000000000001 -16.5
          Q 71.5 -5.5 60.50000000000001 11
          Q 60.50000000000001 27.5 38.5 27.5
          L -27.5 27.5
          Q -49.5 27.5 -49.5 11
          Z
         " class="node-circle"></path><text class="node-label" x="0" y="-15.400000000000002" style="font-size: 18.15px; cursor: pointer;">ISP Modem</text><text class="node-sub" x="0" y="22" style="font-size: 13.2px; cursor: pointer;">192.168.100.1</text></g><g class="node-group" data-node-id="opnsense" transform="translate(2000,550)" style="cursor: grab;"><circle r="82.5" class="node-hit-area" style="fill: transparent; stroke: none; cursor: grab;"></circle><g class="node-circle"><rect x="-55" y="-44" width="110" height="88" rx="4"></rect><line x1="-46.75" y1="-27.5" x2="46.75" y2="-27.5" style="stroke: rgb(71, 85, 105); stroke-width: 2;"></line><line x1="-46.75" y1="-2.75" x2="46.75" y2="-2.75" style="stroke: rgb(71, 85, 105); stroke-width: 2;"></line><line x1="-46.75" y1="22" x2="46.75" y2="22" style="stroke: rgb(71, 85, 105); stroke-width: 2;"></line><line x1="-27.5" y1="-44" x2="-27.5" y2="-19.25" style="stroke: rgb(71, 85, 105); stroke-width: 2;"></line><line x1="11" y1="-44" x2="11" y2="-19.25" style="stroke: rgb(71, 85, 105); stroke-width: 2;"></line><line x1="-8.25" y1="-19.25" x2="-8.25" y2="5.5" style="stroke: rgb(71, 85, 105); stroke-width: 2;"></line><line x1="30.25" y1="-19.25" x2="30.25" y2="5.5" style="stroke: rgb(71, 85, 105); stroke-width: 2;"></line><line x1="-27.5" y1="5.5" x2="-27.5" y2="30.25" style="stroke: rgb(71, 85, 105); stroke-width: 2;"></line><line x1="11" y1="5.5" x2="11" y2="30.25" style="stroke: rgb(71, 85, 105); stroke-width: 2;"></line><line x1="-8.25" y1="30.25" x2="-8.25" y2="55" style="stroke: rgb(71, 85, 105); stroke-width: 2;"></line><line x1="30.25" y1="30.25" x2="30.25" y2="55" style="stroke: rgb(71, 85, 105); stroke-width: 2;"></line></g><text class="node-label" x="0" y="-15.400000000000002" style="font-size: 18.15px; cursor: pointer;">OPNsense</text><text class="node-sub" x="0" y="22" style="font-size: 13.2px; cursor: pointer;">192.168.1.1</text></g><g class="node-group" data-node-id="main-switch" transform="translate(2000,950)" style="cursor: grab;"><circle r="82.5" class="node-hit-area" style="fill: transparent; stroke: none; cursor: grab;"></circle><g class="node-circle"><rect x="-77" y="-22" width="154" height="44" rx="4"></rect><rect x="-66" y="-8.25" width="12.1" height="16.5" rx="1" style="fill: rgb(30, 41, 59);"></rect><rect x="-48.4" y="-8.25" width="12.1" height="16.5" rx="1" style="fill: rgb(30, 41, 59);"></rect><rect x="-30.799999999999997" y="-8.25" width="12.1" height="16.5" rx="1" style="fill: rgb(30, 41, 59);"></rect><rect x="-13.199999999999996" y="-8.25" width="12.1" height="16.5" rx="1" style="fill: rgb(30, 41, 59);"></rect><rect x="4.400000000000006" y="-8.25" width="12.1" height="16.5" rx="1" style="fill: rgb(30, 41, 59);"></rect><rect x="22" y="-8.25" width="12.1" height="16.5" rx="1" style="fill: rgb(30, 41, 59);"></rect><rect x="39.60000000000001" y="-8.25" width="12.1" height="16.5" rx="1" style="fill: rgb(30, 41, 59);"></rect><rect x="57.2" y="-8.25" width="12.1" height="16.5" rx="1" style="fill: rgb(30, 41, 59);"></rect></g><text class="node-label" x="0" y="-15.400000000000002" style="font-size: 18.15px; cursor: pointer;">Main Switch</text><text class="node-sub" x="0" y="22" style="font-size: 13.2px; cursor: pointer;">192.168.1.2</text></g><g class="node-group" data-node-id="proxmox" transform="translate(1200,1350)" style="cursor: grab;"><circle r="82.5" class="node-hit-area" style="fill: transparent; stroke: none; cursor: grab;"></circle><g class="node-circle"><rect x="-66" y="-33" width="132" height="66" rx="4"></rect><line x1="-49.5" y1="-16.5" x2="-49.5" y2="16.5" style="stroke: currentcolor; stroke-width: 2; opacity: 0.5;"></line><line x1="-22" y1="-16.5" x2="-22" y2="16.5" style="stroke: currentcolor; stroke-width: 2; opacity: 0.5;"></line><line x1="5.5" y1="-16.5" x2="5.5" y2="16.5" style="stroke: currentcolor; stroke-width: 2; opacity: 0.5;"></line><circle cx="49.5" cy="0" r="5.5" style="fill: rgb(74, 222, 128);"></circle></g><text class="node-label" x="0" y="-15.400000000000002" style="font-size: 18.15px; cursor: pointer;">Proxmox</text><text class="node-sub" x="0" y="22" style="font-size: 13.2px; cursor: pointer;">192.168.1.10</text></g><g class="node-group" data-node-id="truenas" transform="translate(2800,1350)" style="cursor: grab;"><circle r="82.5" class="node-hit-area" style="fill: transparent; stroke: none; cursor: grab;"></circle><g class="node-circle"><rect x="-38.5" y="-33" width="77" height="77"></rect><ellipse cx="0" cy="-33" rx="38.5" ry="13.75"></ellipse><ellipse cx="0" cy="44" rx="38.5" ry="13.75"></ellipse><ellipse cx="0" cy="-8.25" rx="38.5" ry="11" style="fill: none; stroke: rgb(71, 85, 105); stroke-width: 2;"></ellipse><ellipse cx="0" cy="19.25" rx="38.5" ry="11" style="fill: none; stroke: rgb(71, 85, 105); stroke-width: 2;"></ellipse></g><text class="node-label" x="0" y="-15.400000000000002" style="font-size: 18.15px; cursor: pointer;">TrueNAS</text><text class="node-sub" x="0" y="22" style="font-size: 13.2px; cursor: pointer;">192.168.1.11</text></g><g class="node-group" data-node-id="docker-host" transform="translate(2000,1350)" style="cursor: grab;"><circle r="82.5" class="node-hit-area" style="fill: transparent; stroke: none; cursor: grab;"></circle><g class="node-circle"><rect x="-66" y="-33" width="132" height="66" rx="4"></rect><line x1="-49.5" y1="-16.5" x2="-49.5" y2="16.5" style="stroke: currentcolor; stroke-width: 2; opacity: 0.5;"></line><line x1="-22" y1="-16.5" x2="-22" y2="16.5" style="stroke: currentcolor; stroke-width: 2; opacity: 0.5;"></line><line x1="5.5" y1="-16.5" x2="5.5" y2="16.5" style="stroke: currentcolor; stroke-width: 2; opacity: 0.5;"></line><circle cx="49.5" cy="0" r="5.5" style="fill: rgb(74, 222, 128);"></circle></g><text class="node-label" x="0" y="-15.400000000000002" style="font-size: 18.15px; cursor: pointer;">Docker Host</text><text class="node-sub" x="0" y="22" style="font-size: 13.2px; cursor: pointer;">192.168.1.12</text></g><g class="node-group" data-node-id="pi-hole" transform="translate(2000,1650)" style="cursor: grab;"><circle r="82.5" class="node-hit-area" style="fill: transparent; stroke: none; cursor: grab;"></circle><g class="node-circle"><svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 512 512" width="66" height="66" x="-33" y="-33"><linearGradient id="pi-hole_svg__a" x1="1124.653" x2="1839.97" y1="-669.315" y2="-669.315" gradientTransform="matrix(.3694 0 0 -.3694 -322.747 -168.195)" gradientUnits="userSpaceOnUse"><stop offset="0" style="stop-color:#12b212"></stop><stop offset="1" style="stop-color:#0f0"></stop></linearGradient><path d="M226.1 157.3C162.1 150.5 97.7 102.2 92.7 0 191.8 0 244.9 58.7 250 151.8c18.8-111.6 106.7-98.5 106.7-98.5 4.2 63.2-47.8 101.6-106.7 104.8-16.5-35-115.7-120.5-115.7-120.5-.1-.1-.3-.1-.4 0q-.15.15 0 .3s95.7 83.4 92.2 119.4" style="fill:url(#pi-hole_svg__a)"></path><path d="M256 512c-6.2-.4-63.9-2.6-67.4-67.4-2.8-39.4 28.3-68.5 28.3-106.7-7.1-95.4-134.9-83.6-134.9 0-.1 20.9 8.2 40.9 23 55.7l95.2 95.3c14.8 14.8 34.8 23 55.8 23.1m0-348.1c6.2.4 63.9 2.6 67.4 67.4 2.8 39.4-28.3 68.5-28.3 106.7 7.1 95.4 134.8 83.6 134.8 0 .1-20.9-8.2-40.9-23-55.7L311.7 187c-14.8-14.8-34.8-23-55.7-23" style="fill:#91180c"></path><path d="M430 337.9c-.4 6.2-2.6 63.9-67.4 67.4-39.4 2.8-68.5-28.3-106.7-28.3-95.4 7.1-83.6 134.8 0 134.8 20.9.1 40.9-8.2 55.7-23l95.3-95.2c14.8-14.8 23-34.8 23.1-55.7m-347.7 0c.4-6.2 2.6-63.9 67.4-67.4 39.4-2.8 68.5 28.3 106.7 28.3 95.4-7.2 83.6-134.8 0-134.8-20.9-.1-40.9 8.2-55.7 23l-95.3 95.3c-14.8 14.8-23 34.8-23 55.7" style="fill:#f42e1c"></path></svg></g><text class="node-label" x="0" y="-15.400000000000002" style="font-size: 18.15px; cursor: pointer;">Pi-hole</text><text class="node-sub" x="0" y="22" style="font-size: 13.2px; cursor: pointer;">192.168.1.53</text></g><g class="node-group" data-node-id="plex" transform="translate(600,1850)" style="cursor: grab;"><circle r="82.5" class="node-hit-area" style="fill: transparent; stroke: none; cursor: grab;"></circle><g class="node-circle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="66" height="66" x="-33" y="-33"><rect width="512" height="512" fill="#282a2d" rx="15%"></rect><path fill="#e5a00d" d="M256 70H148l108 186-108 186h108l108-186z"></path></svg></g><text class="node-label" x="0" y="-15.400000000000002" style="font-size: 18.15px; cursor: pointer;">Plex</text><text class="node-sub" x="0" y="22" style="font-size: 13.2px; cursor: pointer;">192.168.1.20</text></g><g class="node-group" data-node-id="jellyfin" transform="translate(1400,2250)" style="cursor: grab;"><circle r="82.5" class="node-hit-area" style="fill: transparent; stroke: none; cursor: grab;"></circle><g class="node-circle"><svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 512 512" width="66" height="66" x="-33" y="-33"><linearGradient id="jellyfin_svg__a" x1="97.487" x2="522.047" y1="483.902" y2="729.018" gradientTransform="translate(0 -278)" gradientUnits="userSpaceOnUse"><stop offset="0" style="stop-color:#aa5cc3"></stop><stop offset="1" style="stop-color:#00a4dc"></stop></linearGradient><path d="M256 196.2c-22.4 0-94.8 131.3-83.8 153.4s156.8 21.9 167.7 0-61.3-153.4-83.9-153.4" style="fill:url(#jellyfin_svg__a)"></path><linearGradient id="jellyfin_svg__b" x1="94.186" x2="518.747" y1="489.619" y2="734.735" gradientTransform="translate(0 -278)" gradientUnits="userSpaceOnUse"><stop offset="0" style="stop-color:#aa5cc3"></stop><stop offset="1" style="stop-color:#00a4dc"></stop></linearGradient><path d="M256 0C188.3 0-29.8 395.4 3.4 462.2s472.3 66 505.2 0S323.8 0 256 0m165.6 404.3c-21.6 43.2-309.3 43.8-331.1 0S211.7 101.4 256 101.4 443.2 361 421.6 404.3" style="fill:url(#jellyfin_svg__b)"></path></svg></g><text class="node-label" x="0" y="-15.400000000000002" style="font-size: 18.15px; cursor: pointer;">Jellyfin</text><text class="node-sub" x="0" y="22" style="font-size: 13.2px; cursor: pointer;">192.168.1.21</text></g><g class="node-group" data-node-id="nextcloud" transform="translate(1800,2250)" style="cursor: grab;"><circle r="82.5" class="node-hit-area" style="fill: transparent; stroke: none; cursor: grab;"></circle><g class="node-circle"><svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 24 24" width="66" height="66" x="-33" y="-33"><title>Nextcloud</title><path d="M12.018 6.537c-2.5 0-4.6 1.712-5.241 4.015-.56-1.232-1.793-2.105-3.225-2.105A3.569 3.569 0 0 0 0 12a3.569 3.569 0 0 0 3.552 3.553c1.432 0 2.664-.874 3.224-2.106.641 2.304 2.742 4.016 5.242 4.016 2.487 0 4.576-1.693 5.231-3.977.569 1.21 1.783 2.067 3.198 2.067A3.568 3.568 0 0 0 24 12a3.569 3.569 0 0 0-3.553-3.553c-1.416 0-2.63.858-3.199 2.067-.654-2.284-2.743-3.978-5.23-3.977zm0 2.085c1.878 0 3.378 1.5 3.378 3.378 0 1.878-1.5 3.378-3.378 3.378A3.362 3.362 0 0 1 8.641 12c0-1.878 1.5-3.378 3.377-3.378zm-8.466 1.91c.822 0 1.467.645 1.467 1.468s-.644 1.467-1.467 1.468A1.452 1.452 0 0 1 2.085 12c0-.823.644-1.467 1.467-1.467zm16.895 0c.823 0 1.468.645 1.468 1.468s-.645 1.468-1.468 1.468A1.452 1.452 0 0 1 18.98 12c0-.823.644-1.467 1.467-1.467z"></path></svg></g><text class="node-label" x="0" y="-15.400000000000002" style="font-size: 18.15px; cursor: pointer;">Nextcloud</text><text class="node-sub" x="0" y="22" style="font-size: 13.2px; cursor: pointer;">192.168.1.30</text></g><g class="node-group" data-node-id="bitwarden" transform="translate(2200,2250)" style="cursor: grab;"><circle r="82.5" class="node-hit-area" style="fill: transparent; stroke: none; cursor: grab;"></circle><g class="node-circle"><svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 24 24" width="66" height="66" x="-33" y="-33"><title>Bitwarden</title><path d="M21.722.296A.964.964 0 0 0 21.018 0H2.982a.959.959 0 0 0-.703.296.96.96 0 0 0-.297.702v12c0 .895.174 1.783.523 2.665.349.88.783 1.66 1.3 2.345.517.68 1.132 1.346 1.848 1.993a21.807 21.807 0 0 0 1.98 1.609c.605.427 1.235.83 1.893 1.212.657.381 1.125.638 1.4.772.276.134.5.241.664.311a.916.916 0 0 0 .814 0c.168-.073.389-.177.667-.311.275-.134.743-.394 1.401-.772a25.305 25.305 0 0 0 1.894-1.212A21.891 21.891 0 0 0 18.348 20c.716-.647 1.33-1.31 1.847-1.993s.949-1.463 1.3-2.345c.35-.879.524-1.767.524-2.665V1.001a.95.95 0 0 0-.297-.705zm-2.325 12.815c0 4.344-7.397 8.087-7.397 8.087V2.57h7.397v10.54z"></path></svg></g><text class="node-label" x="0" y="-15.400000000000002" style="font-size: 18.15px; cursor: pointer;">Vaultwarden</text><text class="node-sub" x="0" y="22" style="font-size: 13.2px; cursor: pointer;">192.168.1.31</text></g><g class="node-group" data-node-id="homeassistant" transform="translate(1000,1850)" style="cursor: grab;"><circle r="82.5" class="node-hit-area" style="fill: transparent; stroke: none; cursor: grab;"></circle><g class="node-circle"><svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 24 24" width="66" height="66" x="-33" y="-33"><title>Home Assistant</title><path d="M22.939 10.627 13.061.749a1.505 1.505 0 0 0-2.121 0l-9.879 9.878C.478 11.21 0 12.363 0 13.187v9c0 .826.675 1.5 1.5 1.5h9.227l-4.063-4.062a2.034 2.034 0 0 1-.664.113c-1.13 0-2.05-.92-2.05-2.05s.92-2.05 2.05-2.05 2.05.92 2.05 2.05c0 .233-.041.456-.113.665l3.163 3.163V9.928a2.05 2.05 0 0 1-1.15-1.84c0-1.13.92-2.05 2.05-2.05s2.05.92 2.05 2.05a2.05 2.05 0 0 1-1.15 1.84v8.127l3.146-3.146A2.051 2.051 0 0 1 18 12.239c1.13 0 2.05.92 2.05 2.05s-.92 2.05-2.05 2.05c-.25 0-.488-.047-.709-.13L12.9 20.602v3.088h9.6c.825 0 1.5-.675 1.5-1.5v-9c0-.825-.477-1.977-1.061-2.561z"></path></svg></g><text class="node-label" x="0" y="-15.400000000000002" style="font-size: 18.15px; cursor: pointer;">Home Assistant</text><text class="node-sub" x="0" y="22" style="font-size: 13.2px; cursor: pointer;">192.168.1.40</text></g><g class="node-group" data-node-id="portainer" transform="translate(2600,2250)" style="cursor: grab;"><circle r="82.5" class="node-hit-area" style="fill: transparent; stroke: none; cursor: grab;"></circle><g class="node-circle"><svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 24 24" width="66" height="66" x="-33" y="-33"><title>Portainer</title><path d="M12.504 0v1.023l-.01-.015-6.106 3.526H3.417v.751h5.359v3.638h1.942V5.284h1.786v10.416c.027 0 .54-.01.751.091V5.285h.531v10.608c.293.147.55.312.751.54V5.286h6.046v-.75h-1.267l-6.061-3.5V0zm0 1.87v2.664H7.889zm.751.031l4.56 2.633h-4.56zM9.142 5.285h1.21v1.686h-1.21zm-4.736 2.73v1.951h1.942v-1.95zm2.19 0v1.951h1.941v-1.95zm-2.19 2.171v1.951h1.942v-1.95zm2.19 0v1.951h1.941v-1.95zm2.18 0v1.951h1.942v-1.95zM4.36 12.43a3.73 3.73 0 00-.494 1.851c0 1.227.604 2.308 1.52 2.986.239-.064.477-.1.724-.11.1 0 .165.01.266.019.284-1.191 1.383-1.988 2.665-1.988.724 0 1.438.201 1.924.668.229-.476.302-1.007.302-1.575 0-.65-.165-1.292-.494-1.85zm4.828 3.16c-1.21 0-2.226.844-2.492 1.97a.922.922 0 00-.275-.009 2.559 2.559 0 00-2.564 2.556 2.565 2.565 0 003.096 2.5A2.579 2.579 0 009.233 24c.862 0 1.622-.43 2.09-1.081a2.557 2.557 0 004.186-1.97c0-.567-.193-1.099-.504-1.52a2.557 2.557 0 00-3.866-2.94 2.574 2.574 0 00-1.951-.898z"></path></svg></g><text class="node-label" x="0" y="-15.400000000000002" style="font-size: 18.15px; cursor: pointer;">Portainer</text><text class="node-sub" x="0" y="22" style="font-size: 13.2px; cursor: pointer;">192.168.1.50</text></g><g class="node-group" data-node-id="traefik" transform="translate(3000,2250)" style="cursor: grab;"><circle r="82.5" class="node-hit-area" style="fill: transparent; stroke: none; cursor: grab;"></circle><g class="node-circle"><svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 24 24" width="66" height="66" x="-33" y="-33"><title>Traefik Proxy</title><path d="M12 1.19c1.088 0 2.056.768 2.056 1.714 0 .947-.921 1.715-2.056 1.715-.13 0-.3-.022-.509-.064a.685.685 0 0 0-.475.076l-7.37 4.195a.344.344 0 0 0 .001.597l7.99 4.49c.208.116.461.116.669 0l8.034-4.468a.343.343 0 0 0 .003-.598l-2.507-1.424a.683.683 0 0 0-.67-.003l-2.647 1.468a.234.234 0 0 0-.119.18l-.001.025c0 .946-.921 1.714-2.056 1.714s-2.056-.768-2.056-1.714c0-.947.921-1.715 2.056-1.715.042 0 .09.002.145.007l.087.008.096.013a.685.685 0 0 0 .425-.08l3.913-2.173c.3-.166.662-.171.965-.017l.04.023 5.465 3.104c.686.39.693 1.368.03 1.773l-.037.021-3.656 2.033a.343.343 0 0 0 .007.604l3.62 1.906c.72.378.736 1.402.03 1.804l-10.995 6.272a1.03 1.03 0 0 1-1.019 0L.526 16.43a1.03 1.03 0 0 1 .034-1.806l3.66-1.911a.343.343 0 0 0 .01-.603L.524 10.029a1.03 1.03 0 0 1-.041-1.77l.036-.021L9.618 3.06a.688.688 0 0 0 .308-.369l.011-.036c.32-.952 1.046-1.466 2.063-1.466Zm5.076 12.63-4.492 2.586-.041.022c-.306.158-.671.152-.973-.018l-4.478-2.527a.682.682 0 0 0-.65-.01L3.86 15.224a.343.343 0 0 0-.012.602l7.887 4.515c.21.12.467.121.677 0l7.956-4.547a.343.343 0 0 0-.01-.602l-2.623-1.384a.683.683 0 0 0-.659.012z"></path></svg></g><text class="node-label" x="0" y="-15.400000000000002" style="font-size: 18.15px; cursor: pointer;">Traefik</text><text class="node-sub" x="0" y="22" style="font-size: 13.2px; cursor: pointer;">192.168.1.51</text></g><g class="node-group" data-node-id="grafana" transform="translate(3400,2250)" style="cursor: grab;"><circle r="82.5" class="node-hit-area" style="fill: transparent; stroke: none; cursor: grab;"></circle><g class="node-circle"><svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 24 24" width="66" height="66" x="-33" y="-33"><title>Grafana</title><path d="M23.02 10.59a8.578 8.578 0 0 0-.862-3.034 8.911 8.911 0 0 0-1.789-2.445c.337-1.342-.413-2.505-.413-2.505-1.292-.08-2.113.4-2.416.62-.052-.02-.102-.044-.154-.064-.22-.089-.446-.172-.677-.247-.231-.073-.47-.14-.711-.197a9.867 9.867 0 0 0-.875-.161C14.557.753 12.94 0 12.94 0c-1.804 1.145-2.147 2.744-2.147 2.744l-.018.093c-.098.029-.2.057-.298.088-.138.042-.275.094-.413.143-.138.055-.275.107-.41.166a8.869 8.869 0 0 0-1.557.87l-.063-.029c-2.497-.955-4.716.195-4.716.195-.203 2.658.996 4.33 1.235 4.636a11.608 11.608 0 0 0-.607 2.635C1.636 12.677.953 15.014.953 15.014c1.926 2.214 4.171 2.351 4.171 2.351.003-.002.006-.002.006-.005.285.509.615.994.986 1.446.156.19.32.371.488.548-.704 2.009.099 3.68.099 3.68 2.144.08 3.553-.937 3.849-1.173a9.784 9.784 0 0 0 3.164.501h.08l.055-.003.107-.002.103-.005.003.002c1.01 1.44 2.788 1.646 2.788 1.646 1.264-1.332 1.337-2.653 1.337-2.94v-.058c0-.02-.003-.039-.003-.06.265-.187.52-.387.758-.6a7.875 7.875 0 0 0 1.415-1.7c1.43.083 2.437-.885 2.437-.885-.236-1.49-1.085-2.216-1.264-2.354l-.018-.013-.016-.013a.217.217 0 0 1-.031-.02c.008-.092.016-.18.02-.27.011-.162.016-.323.016-.48v-.253l-.005-.098-.008-.135a1.891 1.891 0 0 0-.01-.13c-.003-.042-.008-.083-.013-.125l-.016-.124-.018-.122a6.215 6.215 0 0 0-2.032-3.73 6.015 6.015 0 0 0-3.222-1.46 6.292 6.292 0 0 0-.85-.048l-.107.002h-.063l-.044.003-.104.008a4.777 4.777 0 0 0-3.335 1.695c-.332.4-.592.84-.768 1.297a4.594 4.594 0 0 0-.312 1.817l.003.091c.005.055.007.11.013.164a3.615 3.615 0 0 0 .698 1.82 3.53 3.53 0 0 0 1.827 1.282c.33.098.66.14.971.137.039 0 .078 0 .114-.002l.063-.003c.02 0 .041-.003.062-.003.034-.002.065-.007.099-.01.007 0 .018-.003.028-.003l.031-.005.06-.008a1.18 1.18 0 0 0 .112-.02c.036-.008.072-.013.109-.024a2.634 2.634 0 0 0 .914-.415c.028-.02.056-.041.085-.065a.248.248 0 0 0 .039-.35.244.244 0 0 0-.309-.06l-.078.042c-.09.044-.184.083-.283.116a2.476 2.476 0 0 1-.475.096c-.028.003-.054.006-.083.006l-.083.002c-.026 0-.054 0-.08-.002l-.102-.006h-.012l-.024.006c-.016-.003-.031-.003-.044-.006-.031-.002-.06-.007-.091-.01a2.59 2.59 0 0 1-.724-.213 2.557 2.557 0 0 1-.667-.438 2.52 2.52 0 0 1-.805-1.475 2.306 2.306 0 0 1-.029-.444l.006-.122v-.023l.002-.031c.003-.021.003-.04.005-.06a3.163 3.163 0 0 1 1.352-2.29 3.12 3.12 0 0 1 .937-.43 2.946 2.946 0 0 1 .776-.101h.06l.07.002.045.003h.026l.07.005a4.041 4.041 0 0 1 1.635.49 3.94 3.94 0 0 1 1.602 1.662 3.77 3.77 0 0 1 .397 1.414l.005.076.003.075c.002.026.002.05.002.075 0 .024.003.052 0 .07v.065l-.002.073-.008.174a6.195 6.195 0 0 1-.08.639 5.1 5.1 0 0 1-.267.927 5.31 5.31 0 0 1-.624 1.13 5.052 5.052 0 0 1-3.237 2.014 4.82 4.82 0 0 1-.649.066l-.039.003h-.287a6.607 6.607 0 0 1-1.716-.265 6.776 6.776 0 0 1-3.4-2.274 6.75 6.75 0 0 1-.746-1.15 6.616 6.616 0 0 1-.714-2.596l-.005-.083-.002-.02v-.056l-.003-.073v-.096l-.003-.104v-.07l.003-.163c.008-.22.026-.45.054-.678a8.707 8.707 0 0 1 .28-1.355c.128-.444.286-.872.473-1.277a7.04 7.04 0 0 1 1.456-2.1 5.925 5.925 0 0 1 .953-.763c.169-.111.343-.213.524-.306.089-.05.182-.091.273-.135.047-.02.093-.042.138-.062a7.177 7.177 0 0 1 .714-.267l.145-.045c.049-.015.098-.026.148-.041.098-.029.197-.052.296-.076.049-.013.1-.02.15-.033l.15-.032.151-.028.076-.013.075-.01.153-.024c.057-.01.114-.013.171-.023l.169-.021c.036-.003.073-.008.106-.01l.073-.008.036-.003.042-.002c.057-.003.114-.008.171-.01l.086-.006h.023l.037-.003.145-.007a7.999 7.999 0 0 1 1.708.125 7.917 7.917 0 0 1 2.048.68 8.253 8.253 0 0 1 1.672 1.09l.09.077.089.078c.06.052.114.107.171.159.057.052.112.106.166.16.052.055.107.107.159.164a8.671 8.671 0 0 1 1.41 1.978c.012.026.028.052.04.078l.04.078.075.156c.023.051.05.1.07.153l.065.15a8.848 8.848 0 0 1 .45 1.34.19.19 0 0 0 .201.142.186.186 0 0 0 .172-.184c.01-.246.002-.532-.024-.856z"></path></svg></g><text class="node-label" x="0" y="-15.400000000000002" style="font-size: 18.15px; cursor: pointer;">Grafana</text><text class="node-sub" x="0" y="22" style="font-size: 13.2px; cursor: pointer;">192.168.1.60</text></g><g class="node-group" data-node-id="prometheus" transform="translate(3400,1850)" style="cursor: grab;"><circle r="82.5" class="node-hit-area" style="fill: transparent; stroke: none; cursor: grab;"></circle><g class="node-circle"><svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 24 24" width="66" height="66" x="-33" y="-33"><title>Prometheus</title><path d="M12 0C5.373 0 0 5.372 0 12c0 6.627 5.373 12 12 12s12-5.373 12-12c0-6.628-5.373-12-12-12zm0 22.46c-1.885 0-3.414-1.26-3.414-2.814h6.828c0 1.553-1.528 2.813-3.414 2.813zm5.64-3.745H6.36v-2.046h11.28v2.046zm-.04-3.098H6.391c-.037-.043-.075-.086-.111-.13-1.155-1.401-1.427-2.133-1.69-2.879-.005-.025 1.4.287 2.395.511 0 0 .513.119 1.262.255-.72-.843-1.147-1.915-1.147-3.01 0-2.406 1.845-4.508 1.18-6.207.648.053 1.34 1.367 1.387 3.422.689-.951.977-2.69.977-3.755 0-1.103.727-2.385 1.454-2.429-.648 1.069.168 1.984.894 4.256.272.854.237 2.29.447 3.201.07-1.892.395-4.652 1.595-5.605-.529 1.2.079 2.702.494 3.424.671 1.164 1.078 2.047 1.078 3.716a4.642 4.642 0 01-1.11 2.996c.792-.149 1.34-.283 1.34-.283l2.573-.502s-.374 1.538-1.81 3.019z"></path></svg></g><text class="node-label" x="0" y="-15.400000000000002" style="font-size: 18.15px; cursor: pointer;">Prometheus</text><text class="node-sub" x="0" y="22" style="font-size: 13.2px; cursor: pointer;">192.168.1.61</text></g><g class="node-group" data-node-id="unifi-controller" transform="translate(3000,1850)" style="cursor: grab;"><circle r="82.5" class="node-hit-area" style="fill: transparent; stroke: none; cursor: grab;"></circle><g class="node-circle"><svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 24 24" width="66" height="66" x="-33" y="-33"><title>Ubiquiti</title><path d="M23.1627 0h-1.4882v1.4882h1.4882zm-5.2072 10.4226V7.4409l.0007.001h2.9755v2.9762h2.9756v.9433c0 1.0906-.0927 2.3827-.306 3.3973-.1194.5672-.3004 1.1308-.5127 1.672-.2175.5537-.468 1.0841-.7408 1.5595a11.6795 11.6795 0 0 1-1.2456 1.7762l-.0253.0294-.0417.0488c-.1148.1347-.2283.2679-.3531.398a11.7612 11.7612 0 0 1-.4494.4492c-1.9046 1.8343-4.3861 2.98-6.9808 3.243-.3122.032-.939.0652-1.2519.0652-.3139-.001-.9397-.0331-1.252-.0651-2.5946-.263-5.0761-1.4097-6.9806-3.243a11.75 11.75 0 0 1-.4495-.4494c-.131-.1356-.249-.2748-.3683-.4154l-.0006-.0004-.0512-.0603a11.6576 11.6576 0 0 1-1.2456-1.7762c-.2727-.4763-.5233-1.0058-.7408-1.5595-.2123-.5414-.3933-1.1048-.5128-1.6718C.1854 13.743.0927 12.452.0927 11.3616V.1864h5.9518v10.2362s0 .7847.0099 1.0415l.0022.0599v.0004c.0127.332.0247.6575.0594.9812.098.919.3014 1.7913.7203 2.5288.1213.213.2443.42.3915.616.8953 1.1939 2.2577 2.0901 3.9573 2.3398.2022.0294.6108.0552.8149.0552.204 0 .6125-.0258.8149-.0552 1.6996-.2497 3.062-1.146 3.9573-2.3398.148-.196.2701-.403.3914-.616.419-.7375.6224-1.6095.7204-2.5288.0346-.3243.047-.6503.0594-.9831l.0022-.0584c.0099-.2568.0099-1.0415.0099-1.0415zm.7427-8.19h2.2326v2.2319h2.9764v2.9764h-2.9764V4.4654h-2.2326V2.2328Z"></path></svg></g><text class="node-label" x="0" y="-15.400000000000002" style="font-size: 18.15px; cursor: pointer;">UniFi Controller</text><text class="node-sub" x="0" y="22" style="font-size: 13.2px; cursor: pointer;">192.168.1.70</text></g><g class="node-group" data-node-id="wireguard" transform="translate(1400,1850)" style="cursor: grab;"><circle r="82.5" class="node-hit-area" style="fill: transparent; stroke: none; cursor: grab;"></circle><g class="node-circle"><svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="0 0 24 24" width="66" height="66" x="-33" y="-33"><title>WireGuard</title><path d="M23.98 11.645S24.533 0 11.735 0C.418 0 .064 11.17.064 11.17S-1.6 24 11.997 24C25.04 24 23.98 11.645 23.98 11.645zM8.155 7.576c2.4-1.47 5.469-.571 6.618 1.638.218.419.246 1.063.108 1.503-.477 1.516-1.601 2.366-3.145 2.728.455-.39.817-.832.933-1.442a2.112 2.112 0 0 0-.364-1.677 2.14 2.14 0 0 0-2.465-.75c-.95.36-1.47 1.228-1.377 2.294.087.99.839 1.632 2.245 1.876-.21.111-.372.193-.53.281a5.113 5.113 0 0 0-1.644 1.43c-.143.192-.24.208-.458.075-2.827-1.729-3.009-6.067.078-7.956zM6.04 18.258c-.455.116-.895.286-1.359.438.227-1.532 2.021-2.943 3.539-2.782a3.91 3.91 0 0 0-.74 2.072c-.504.093-.98.155-1.44.272zM15.703 3.3c.448.017.898.01 1.347.02a2.324 2.324 0 0 1 .334.047 3.249 3.249 0 0 1-.34.434c-.16.15-.341.296-.573.069-.055-.055-.187-.042-.283-.044-.447-.005-.894-.02-1.34-.003a8.323 8.323 0 0 0-1.154.118c-.072.013-.178.25-.146.338.078.207.191.435.359.567.619.49 1.277.928 1.9 1.413.604.472 1.167.99 1.51 1.7.446.928.46 1.9.267 2.877-.322 1.63-1.147 2.98-2.483 3.962-.538.395-1.205.62-1.821.903-.543.25-1.1.465-1.644.712-.98.446-1.53 1.51-1.369 2.615.149 1.015 1.04 1.862 2.059 2.037 1.223.21 2.486-.586 2.785-1.83.336-1.397-.423-2.646-1.845-3.024l-.256-.066c.38-.17.708-.291 1.012-.458q.793-.437 1.558-.925c.15-.096.231-.096.36.014.977.846 1.56 1.898 1.724 3.187.27 2.135-.74 4.096-2.646 5.101-2.948 1.555-6.557-.215-7.208-3.484-.558-2.8 1.418-5.34 3.797-5.83 1.023-.211 1.958-.637 2.685-1.425.47-.508.697-.944.775-1.141a3.165 3.165 0 0 0 .217-1.158 2.71 2.71 0 0 0-.237-.992c-.248-.566-1.2-1.466-1.435-1.656l-2.24-1.754c-.079-.065-.168-.06-.36-.047-.23.016-.815.048-1.067-.018.204-.155.76-.38 1-.56-.726-.49-1.554-.314-2.315-.46.176-.328 1.046-.831 1.541-.888a7.323 7.323 0 0 0-.135-.822c-.03-.111-.154-.22-.263-.283-.262-.154-.541-.281-.843-.434a1.755 1.755 0 0 1 .906-.28 3.385 3.385 0 0 1 .908.088c.54.123.97.042 1.399-.324-.338-.136-.676-.26-1.003-.407a9.843 9.843 0 0 1-.942-.493c.85.118 1.671.437 2.54.32l.022-.118-2.018-.47c1.203-.11 2.323-.128 3.384.388.299.146.61.266.897.432.14.08.233.24.348.365.09.098.164.23.276.29.424.225.89.234 1.366.223l.01-.16c.479.15 1.017.702 1.017 1.105-.776 0-1.55-.003-2.325.004-.083 0-.165.061-.247.094.078.046.155.128.235.131z M14.703 2.153a.118.118 0 0 0-.016.19.179.179 0 0 0 .246.065c.075-.038.148-.078.238-.125-.072-.062-.13-.114-.19-.163-.106-.087-.193-.032-.278.033z"></path></svg></g><text class="node-label" x="0" y="-15.400000000000002" style="font-size: 18.15px; cursor: pointer;">WireGuard</text><text class="node-sub" x="0" y="22" style="font-size: 13.2px; cursor: pointer;">192.168.1.80</text></g></svg>
    </div>
    <div class="minimap-zoom-wrapper" id="minimap-zoom-wrapper" style="display: block;">
     <button type="button" class="minimap-close-btn" id="minimap-close-btn" title="Hide map &amp; zoom">‚úï</button>
     <div class="minimap-container" id="minimap-container">
      <svg id="minimap" viewBox="0 0 4000 3000">
       <line x1="2000" y1="200" x2="2000" y2="550" class="minimap-edge"></line><line x1="2000" y1="550" x2="2000" y2="950" class="minimap-edge"></line><line x1="2000" y1="950" x2="1200" y2="1350" class="minimap-edge"></line><line x1="2000" y1="950" x2="2800" y2="1350" class="minimap-edge"></line><line x1="2000" y1="950" x2="2000" y2="1350" class="minimap-edge"></line><line x1="2000" y1="950" x2="2000" y2="1650" class="minimap-edge"></line><line x1="1200" y1="1350" x2="600" y2="1850" class="minimap-edge"></line><line x1="1200" y1="1350" x2="1000" y2="1850" class="minimap-edge"></line><line x1="1200" y1="1350" x2="1400" y2="1850" class="minimap-edge"></line><line x1="2000" y1="1350" x2="1400" y2="2250" class="minimap-edge"></line><line x1="2000" y1="1350" x2="1800" y2="2250" class="minimap-edge"></line><line x1="2000" y1="1350" x2="2200" y2="2250" class="minimap-edge"></line><line x1="2000" y1="1350" x2="2600" y2="2250" class="minimap-edge"></line><line x1="2000" y1="1350" x2="3000" y2="2250" class="minimap-edge"></line><line x1="2000" y1="1350" x2="3400" y2="2250" class="minimap-edge"></line><line x1="2000" y1="1350" x2="3400" y2="1850" class="minimap-edge"></line><line x1="2000" y1="1350" x2="3000" y2="1850" class="minimap-edge"></line><line x1="2800" y1="1350" x2="600" y2="1850" class="minimap-edge"></line><line x1="2800" y1="1350" x2="1400" y2="2250" class="minimap-edge"></line><line x1="2800" y1="1350" x2="1800" y2="2250" class="minimap-edge"></line><circle cx="2000" cy="200" r="40" class="minimap-node"></circle><circle cx="2000" cy="550" r="40" class="minimap-node"></circle><circle cx="2000" cy="950" r="40" class="minimap-node"></circle><circle cx="1200" cy="1350" r="40" class="minimap-node"></circle><circle cx="2800" cy="1350" r="40" class="minimap-node"></circle><circle cx="2000" cy="1350" r="40" class="minimap-node"></circle><circle cx="2000" cy="1650" r="40" class="minimap-node"></circle><circle cx="600" cy="1850" r="40" class="minimap-node"></circle><circle cx="1400" cy="2250" r="40" class="minimap-node"></circle><circle cx="1800" cy="2250" r="40" class="minimap-node"></circle><circle cx="2200" cy="2250" r="40" class="minimap-node"></circle><circle cx="1000" cy="1850" r="40" class="minimap-node"></circle><circle cx="2600" cy="2250" r="40" class="minimap-node"></circle><circle cx="3000" cy="2250" r="40" class="minimap-node"></circle><circle cx="3400" cy="2250" r="40" class="minimap-node"></circle><circle cx="3400" cy="1850" r="40" class="minimap-node"></circle><circle cx="3000" cy="1850" r="40" class="minimap-node"></circle><circle cx="1400" cy="1850" r="40" class="minimap-node"></circle><rect class="minimap-viewport" id="minimap-viewport" x="366.66666666666674" y="0" width="3266.6666666666665" height="2450"></rect>
      </svg>
     </div>
     <div class="zoom-toolbar" id="zoom-toolbar">
      <button id="zoom-in-btn" title="Zoom in">+</button>
      <div class="zoom-level" id="zoom-level">122%</div>
      <button id="zoom-out-btn" title="Zoom out">-</button>
      <div class="divider"></div>
      <button id="zoom-fit-btn" title="Fit to view">[ ]</button>
      <button id="zoom-reset-btn" title="Reset view">R</button>
     </div>
    </div>
   <button type="button" id="edge-legend-mini" class="legend-mini-btn" style="bottom: 10px; display: none;">Legend</button><button type="button" id="minimap-mini" class="legend-mini-btn" style="right: 10px; left: auto; bottom: 10px; display: none;">Map</button><button type="button" id="draw-toolbar-mini" class="legend-mini-btn" style="top: 10px; left: 10px; right: auto; display: none;">Draw</button><button type="button" id="topology-toolbar-mini" class="legend-mini-btn" style="top: 10px; left: auto; right: 40px; display: none;">Add Line</button></section>
   <aside class="details-panel" id="details-panel">
    <div id="node-panel" style="display: block;">
     <div class="details-name editable-text" id="node-name">ISP Modem</div>
     <div class="details-ip editable-text" id="node-ip">192.168.100.1</div>
     <div class="details-role" id="node-role">WAN</div>
     <div class="badge-row" id="node-tags"><span class="badge" style="cursor: pointer; position: relative;"><span>1Gbps Fiber</span><span style="opacity: 0.6; margin-left: 4px; font-size: 10px;"> ‚úï</span></span><span class="badge" style="cursor: pointer; position: relative;"><span>Bridge Mode</span><span style="opacity: 0.6; margin-left: 4px; font-size: 10px;"> ‚úï</span></span><span class="badge" style="cursor: pointer; opacity: 0.6; border-style: dashed;">+ Add</span></div>
     <div style="margin-top: 10px; display: flex; gap: 8px">
      <input type="text" id="new-tag-input" placeholder="Add tag..." style="
                     flex: 1;
                     padding: 8px 12px;
                     background: var(--panel);
                     border: 1px solid var(--edge-main);
                     border-radius: 6px;
                     color: var(--text-main);
                     font-size: clamp(14px, 1.6vw, 18px);
                     ">
      <button id="add-tag-btn" style="
                     padding: 8px 16px;
                     background: var(--accent);
                     color: var(--bg);
                     border: none;
                     border-radius: 6px;
                     cursor: pointer;
                     font-size: clamp(14px, 1.6vw, 18px);
                     font-weight: 600;
                     "> Add </button>
     </div>
     <button class="pick-icon-btn" id="pick-tag-icon-btn">üé® Add Icon Tag</button>
     <div class="section-label">Size</div>
     <div class="size-controls">
      <label>Size:</label>
      <input type="range" id="size-slider" min="20" max="200" value="55">
      <span id="size-value">55</span>
      <button id="reset-size">Reset</button>
     </div>
     <details class="style-section">
      <summary>Styling</summary>
      <div class="style-content">
       <div class="style-row">
        <label>Screen:</label>
        <select id="style-scope">
         <option value="all">All</option>
         <option value="desktop">Desktop</option>
         <option value="tablet">Tablet</option>
         <option value="mobile">Mobile</option>
         <option value="fold">Fold</option>
        </select>
       </div>
       <div class="style-row">
        <label>Shape:</label>
        <select id="shape-select">
         <optgroup label="Basic Shapes">
          <option value="circle">Circle</option>
          <option value="square">Square</option>
          <option value="rectangle">Rectangle</option>
          <option value="triangle">Triangle</option>
          <option value="hexagon">Hexagon</option>
          <option value="diamond">Diamond</option>
          <option value="star">Star</option>
          <option value="stop-sign">Stop Sign</option>
         </optgroup>
         <optgroup label="Network Equipment">
          <option value="server">Server</option>
          <option value="pc">PC / Desktop</option>
          <option value="laptop">Laptop</option>
          <option value="phone">Phone / Mobile</option>
          <option value="router">Router</option>
          <option value="switch">Switch</option>
          <option value="firewall">Firewall</option>
          <option value="cloud">Cloud</option>
          <option value="database">Database</option>
          <option value="printer">Printer</option>
         </optgroup>
        </select>
       </div>
       <button class="pick-icon-btn" id="pick-shape-icon-btn">üé® Or Pick an Icon</button>
       <div class="style-row">
        <label>Circle Color:</label>
        <input type="color" id="circle-color" value="#1e293b">
       </div>
       <div class="style-row">
        <label>Title Color:</label>
        <input type="color" id="title-color" value="#e2e8f0">
       </div>
       <div class="style-row">
        <label>Title Font:</label>
        <select id="title-font">
         <option value="system-ui, sans-serif"> System UI </option>
         <option value="monospace">Monospace</option>
         <option value="serif">Serif</option>
         <option value="cursive">Cursive</option>
         <option value="'Courier New', monospace"> Courier </option>
         <option value="Arial, sans-serif">Arial</option>
         <option value="'Times New Roman', serif"> Times </option>
        </select>
       </div>
       <div class="style-row">
        <label>Title Size:</label>
        <input type="number" id="title-size" min="8" max="100" value="18">
       </div>
       <div class="style-row">
        <label>Sub Color:</label>
        <input type="color" id="sub-color" value="#94a3b8">
       </div>
       <div class="style-row">
        <label>Sub Font:</label>
        <select id="sub-font">
         <option value="system-ui, sans-serif"> System UI </option>
         <option value="monospace">Monospace</option>
         <option value="serif">Serif</option>
         <option value="cursive">Cursive</option>
         <option value="'Courier New', monospace"> Courier </option>
         <option value="Arial, sans-serif">Arial</option>
         <option value="'Times New Roman', serif"> Times </option>
        </select>
       </div>
       <div class="style-row">
        <label>Sub Size:</label>
        <input type="number" id="sub-size" min="6" max="80" value="13">
       </div>
       <div style="
                        margin-top: 12px;
                        padding-top: 10px;
                        border-top: 1px solid var(--edge-main);
                        ">
        <div style="
                           font-size: 12px;
                           color: var(--text-soft);
                           margin-bottom: 8px;
                           text-transform: uppercase;
                           "> Text Position </div>
        <div class="style-row">
         <label>Name Y:</label>
         <input type="number" id="title-offset-y" min="-100" max="100" value="0" style="width: 60px">
        </div>
        <div class="style-row">
         <label>Name X:</label>
         <input type="number" id="title-offset-x" min="-100" max="100" value="0" style="width: 60px">
        </div>
        <div class="style-row">
         <label>IP Y:</label>
         <input type="number" id="sub-offset-y" min="-100" max="100" value="0" style="width: 60px">
        </div>
        <div class="style-row">
         <label>IP X:</label>
         <input type="number" id="sub-offset-x" min="-100" max="100" value="0" style="width: 60px">
        </div>
       </div>
       <button id="reset-styles" style="
                        width: 100%;
                        margin-top: 10px;
                        padding: 8px;
                        background: var(--panel);
                        color: var(--text-main);
                        border: 1px solid var(--edge-main);
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: clamp(13px, 1.5vw, 17px);
                        "> Reset Styles </button>
      </div>
     </details>
     <div class="section-label">Notes</div>
     <ul class="list" id="node-notes"><li><span style="flex: 1 1 0%;">ISP: AT&amp;T Fiber</span><span class="delete-note">‚úï</span></li></ul>
     <div style="margin-top: 10px; display: flex; gap: 8px">
      <input type="text" id="new-note-input" placeholder="Type new note..." style="
                     flex: 1;
                     padding: 8px 12px;
                     background: var(--panel);
                     border: 1px solid var(--edge-main);
                     border-radius: 6px;
                     color: var(--text-main);
                     font-size: clamp(14px, 1.6vw, 18px);
                     ">
      <button id="add-note-btn" style="
                     padding: 8px 16px;
                     background: var(--accent);
                     color: var(--bg);
                     border: none;
                     border-radius: 6px;
                     cursor: pointer;
                     font-size: clamp(14px, 1.6vw, 18px);
                     font-weight: 600;
                     "> Add </button>
     </div>
     <button id="delete-node-btn" style="
                  margin-top: 15px;
                  padding: 10px 16px;
                  background: var(--danger);
                  color: rgb(255, 255, 255);
                  border: none;
                  border-radius: 6px;
                  cursor: pointer;
                  font-size: clamp(14px, 1.6vw, 18px);
                  font-weight: 600;
                  width: 100%;
                  "> Delete Node </button>
    </div>
    <div id="edge-panel" style="display: none">
     <div class="details-name" id="edge-title">Custom line</div>
     <div class="style-row" style="margin-top: 10px">
      <label>Width:</label>
      <input type="number" id="edge-width" min="1" max="20" value="4">
     </div>
     <div class="style-row">
      <label>Color:</label>
      <input type="color" id="edge-color" value="#475569">
     </div>
     <div class="style-row">
      <label>Line Style:</label>
      <select id="edge-line-style">
       <option value="solid">Solid</option>
       <option value="dashed">Dashed</option>
       <option value="dotted">Dotted</option>
      </select>
     </div>
     <div class="style-row">
      <label>Direction:</label>
      <select id="edge-direction">
       <option value="none">No arrows</option>
       <option value="forward">‚Üí Forward</option>
       <option value="backward">‚Üê Backward</option>
       <option value="both">‚Üî Bidirectional</option>
      </select>
     </div>
     <div class="section-label">Line Notes</div>
     <ul class="list" id="edge-notes"></ul>
     <div style="margin-top: 10px; display: flex; gap: 8px">
      <input type="text" id="new-edge-note" placeholder="Add note..." style="
                     flex: 1;
                     padding: 8px 12px;
                     background: var(--panel);
                     border: 1px solid var(--edge-main);
                     border-radius: 6px;
                     color: var(--text-main);
                     font-size: clamp(14px, 1.6vw, 18px);
                     ">
      <button id="add-edge-note" style="
                     padding: 8px 16px;
                     background: var(--accent);
                     color: var(--bg);
                     border: none;
                     border-radius: 6px;
                     cursor: pointer;
                     font-size: clamp(14px, 1.6vw, 18px);
                     font-weight: 600;
                     "> Add </button>
     </div>
     <button id="delete-edge" style="
                  margin-top: 15px;
                  padding: 10px 16px;
                  background: var(--danger);
                  color: #fff;
                  border: none;
                  border-radius: 6px;
                  cursor: pointer;
                  font-size: clamp(14px, 1.6vw, 18px);
                  font-weight: 600;
                  "> Delete Line </button>
    </div>
    <details class="style-section" open="">
     <summary>Page Layout</summary>
     <div class="style-content">
      <div class="style-row">
       <label>Topbar Height</label>
       <input type="range" id="topbar-height" min="40" max="100" value="52" style="flex: 1">
       <span id="topbar-height-val" style="min-width: 35px; text-align: right">100px</span>
      </div>
      <div class="style-row">
       <label>Sidebar Width</label>
       <input type="range" id="sidebar-width" min="200" max="600" value="350" style="flex: 1">
       <span id="sidebar-width-val" style="min-width: 45px; text-align: right">435px</span>
      </div>
      <div class="style-row">
       <label>Mobile Footer Height</label>
       <input type="range" id="mobile-footer-height" min="20" max="70" value="40" style="flex: 1">
       <span id="mobile-footer-height-val" style="min-width: 45px; text-align: right">20%</span>
      </div>
     </div>
    </details>
   </aside>
  </main>
  <script id="nodes-json" type="application/json">{
  "isp-modem": {
    "shape": "cloud",
    "name": "ISP Modem",
    "ip": "192.168.100.1",
    "role": "WAN",
    "tags": [
      "1Gbps Fiber",
      "Bridge Mode"
    ],
    "notes": [
      "ISP: AT&T Fiber"
    ]
  },
  "opnsense": {
    "shape": "firewall",
    "name": "OPNsense",
    "ip": "192.168.1.1",
    "role": "Router/Firewall",
    "tags": [
      "Protectli",
      "4 port"
    ],
    "notes": [
      "DNS: Pi-hole",
      "VPN: WireGuard"
    ]
  },
  "main-switch": {
    "shape": "switch",
    "name": "Main Switch",
    "ip": "192.168.1.2",
    "role": "Core",
    "tags": [
      "UniFi 24 port",
      "PoE"
    ],
    "notes": [
      "USW 24 POE"
    ]
  },
  "proxmox": {
    "shape": "server",
    "name": "Proxmox",
    "ip": "192.168.1.10",
    "role": "Hypervisor",
    "tags": [
      {
        "type": "icon",
        "library": "simple",
        "name": "proxmox"
      },
      "Dell R720",
      "128GB RAM"
    ],
    "notes": [
      "2x Xeon E5 2670",
      "10x VMs running"
    ]
  },
  "truenas": {
    "shape": "database",
    "name": "TrueNAS",
    "ip": "192.168.1.11",
    "role": "NAS",
    "tags": [
      {
        "type": "icon",
        "library": "selfhst",
        "name": "truenas"
      },
      "48TB RAW",
      "ZFS"
    ],
    "notes": [
      "6x 8TB WD Red",
      "RAID Z2"
    ]
  },
  "docker-host": {
    "shape": "server",
    "name": "Docker Host",
    "ip": "192.168.1.12",
    "role": "Containers",
    "tags": [
      {
        "type": "icon",
        "library": "simple",
        "name": "docker"
      },
      "Ubuntu 22.04",
      "32GB RAM"
    ],
    "notes": [
      "Dell Optiplex 7050",
      "35 containers"
    ]
  },
  "pi-hole": {
    "shape": "circle",
    "name": "Pi-hole",
    "ip": "192.168.1.53",
    "role": "DNS",
    "tags": [
      {
        "type": "icon",
        "library": "selfhst",
        "name": "pi-hole"
      },
      "Ad Blocking"
    ],
    "notes": [
      "Raspberry Pi 4",
      "Primary DNS"
    ]
  },
  "plex": {
    "shape": "circle",
    "name": "Plex",
    "ip": "192.168.1.20",
    "role": "Media Server",
    "tags": [
      {
        "type": "icon",
        "library": "selfhst",
        "name": "plex"
      },
      "Transcoding"
    ],
    "notes": [
      "VM on Proxmox",
      "4 cores",
      "8GB RAM"
    ]
  },
  "jellyfin": {
    "shape": "circle",
    "name": "Jellyfin",
    "ip": "192.168.1.21",
    "role": "Media Server",
    "tags": [
      {
        "type": "icon",
        "library": "selfhst",
        "name": "jellyfin"
      },
      "Open Source"
    ],
    "notes": [
      "Container on Docker",
      "Backup media server"
    ]
  },
  "nextcloud": {
    "shape": "circle",
    "name": "Nextcloud",
    "ip": "192.168.1.30",
    "role": "Cloud Storage",
    "tags": [
      {
        "type": "icon",
        "library": "simple",
        "name": "nextcloud"
      },
      "Files",
      "Calendar"
    ],
    "notes": [
      "Container on Docker",
      "MariaDB backend"
    ]
  },
  "bitwarden": {
    "shape": "circle",
    "name": "Vaultwarden",
    "ip": "192.168.1.31",
    "role": "Password Manager",
    "tags": [
      {
        "type": "icon",
        "library": "simple",
        "name": "bitwarden"
      },
      "Self hosted"
    ],
    "notes": [
      "Container on Docker",
      "Bitwarden compatible"
    ]
  },
  "homeassistant": {
    "shape": "circle",
    "name": "Home Assistant",
    "ip": "192.168.1.40",
    "role": "Smart Home",
    "tags": [
      {
        "type": "icon",
        "library": "simple",
        "name": "homeassistant"
      },
      "Automation"
    ],
    "notes": [
      "VM on Proxmox",
      "45 devices"
    ]
  },
  "portainer": {
    "shape": "circle",
    "name": "Portainer",
    "ip": "192.168.1.50",
    "role": "Container Mgmt",
    "tags": [
      {
        "type": "icon",
        "library": "simple",
        "name": "portainer"
      },
      "Docker GUI"
    ],
    "notes": [
      "Managing 35 containers"
    ]
  },
  "traefik": {
    "shape": "circle",
    "name": "Traefik",
    "ip": "192.168.1.51",
    "role": "Reverse Proxy",
    "tags": [
      {
        "type": "icon",
        "library": "simple",
        "name": "traefikproxy"
      },
      "SSL"
    ],
    "notes": [
      "Container on Docker",
      "Wildcard cert"
    ]
  },
  "grafana": {
    "shape": "circle",
    "name": "Grafana",
    "ip": "192.168.1.60",
    "role": "Monitoring",
    "tags": [
      {
        "type": "icon",
        "library": "simple",
        "name": "grafana"
      },
      "Dashboards"
    ],
    "notes": [
      "Container on Docker"
    ]
  },
  "prometheus": {
    "shape": "circle",
    "name": "Prometheus",
    "ip": "192.168.1.61",
    "role": "Metrics",
    "tags": [
      {
        "type": "icon",
        "library": "simple",
        "name": "prometheus"
      },
      "Time Series"
    ],
    "notes": [
      "Container on Docker",
      "15d retention"
    ]
  },
  "unifi-controller": {
    "shape": "router",
    "name": "UniFi Controller",
    "ip": "192.168.1.70",
    "role": "WiFi Management",
    "tags": [
      {
        "type": "icon",
        "library": "simple",
        "name": "ubiquiti"
      },
      "Network"
    ],
    "notes": [
      "Container on Docker",
      "3 APs"
    ]
  },
  "wireguard": {
    "shape": "router",
    "name": "WireGuard",
    "ip": "192.168.1.80",
    "role": "VPN",
    "tags": [
      {
        "type": "icon",
        "library": "simple",
        "name": "wireguard"
      },
      "Remote Access"
    ],
    "notes": [
      "VM on Proxmox",
      "5 clients"
    ]
  }
}</script>
  <script id="topology-state" type="application/json">{
  "nodeData": {
    "isp-modem": {
      "shape": "cloud",
      "name": "ISP Modem",
      "ip": "192.168.100.1",
      "role": "WAN",
      "tags": [
        "1Gbps Fiber",
        "Bridge Mode"
      ],
      "notes": [
        "ISP: AT&T Fiber"
      ]
    },
    "opnsense": {
      "shape": "firewall",
      "name": "OPNsense",
      "ip": "192.168.1.1",
      "role": "Router/Firewall",
      "tags": [
        "Protectli",
        "4 port"
      ],
      "notes": [
        "DNS: Pi-hole",
        "VPN: WireGuard"
      ]
    },
    "main-switch": {
      "shape": "switch",
      "name": "Main Switch",
      "ip": "192.168.1.2",
      "role": "Core",
      "tags": [
        "UniFi 24 port",
        "PoE"
      ],
      "notes": [
        "USW 24 POE"
      ]
    },
    "proxmox": {
      "shape": "server",
      "name": "Proxmox",
      "ip": "192.168.1.10",
      "role": "Hypervisor",
      "tags": [
        {
          "type": "icon",
          "library": "simple",
          "name": "proxmox"
        },
        "Dell R720",
        "128GB RAM"
      ],
      "notes": [
        "2x Xeon E5 2670",
        "10x VMs running"
      ]
    },
    "truenas": {
      "shape": "database",
      "name": "TrueNAS",
      "ip": "192.168.1.11",
      "role": "NAS",
      "tags": [
        {
          "type": "icon",
          "library": "selfhst",
          "name": "truenas"
        },
        "48TB RAW",
        "ZFS"
      ],
      "notes": [
        "6x 8TB WD Red",
        "RAID Z2"
      ]
    },
    "docker-host": {
      "shape": "server",
      "name": "Docker Host",
      "ip": "192.168.1.12",
      "role": "Containers",
      "tags": [
        {
          "type": "icon",
          "library": "simple",
          "name": "docker"
        },
        "Ubuntu 22.04",
        "32GB RAM"
      ],
      "notes": [
        "Dell Optiplex 7050",
        "35 containers"
      ]
    },
    "pi-hole": {
      "shape": "circle",
      "name": "Pi-hole",
      "ip": "192.168.1.53",
      "role": "DNS",
      "tags": [
        {
          "type": "icon",
          "library": "selfhst",
          "name": "pi-hole"
        },
        "Ad Blocking"
      ],
      "notes": [
        "Raspberry Pi 4",
        "Primary DNS"
      ]
    },
    "plex": {
      "shape": "circle",
      "name": "Plex",
      "ip": "192.168.1.20",
      "role": "Media Server",
      "tags": [
        {
          "type": "icon",
          "library": "selfhst",
          "name": "plex"
        },
        "Transcoding"
      ],
      "notes": [
        "VM on Proxmox",
        "4 cores",
        "8GB RAM"
      ]
    },
    "jellyfin": {
      "shape": "circle",
      "name": "Jellyfin",
      "ip": "192.168.1.21",
      "role": "Media Server",
      "tags": [
        {
          "type": "icon",
          "library": "selfhst",
          "name": "jellyfin"
        },
        "Open Source"
      ],
      "notes": [
        "Container on Docker",
        "Backup media server"
      ]
    },
    "nextcloud": {
      "shape": "circle",
      "name": "Nextcloud",
      "ip": "192.168.1.30",
      "role": "Cloud Storage",
      "tags": [
        {
          "type": "icon",
          "library": "simple",
          "name": "nextcloud"
        },
        "Files",
        "Calendar"
      ],
      "notes": [
        "Container on Docker",
        "MariaDB backend"
      ]
    },
    "bitwarden": {
      "shape": "circle",
      "name": "Vaultwarden",
      "ip": "192.168.1.31",
      "role": "Password Manager",
      "tags": [
        {
          "type": "icon",
          "library": "simple",
          "name": "bitwarden"
        },
        "Self hosted"
      ],
      "notes": [
        "Container on Docker",
        "Bitwarden compatible"
      ]
    },
    "homeassistant": {
      "shape": "circle",
      "name": "Home Assistant",
      "ip": "192.168.1.40",
      "role": "Smart Home",
      "tags": [
        {
          "type": "icon",
          "library": "simple",
          "name": "homeassistant"
        },
        "Automation"
      ],
      "notes": [
        "VM on Proxmox",
        "45 devices"
      ]
    },
    "portainer": {
      "shape": "circle",
      "name": "Portainer",
      "ip": "192.168.1.50",
      "role": "Container Mgmt",
      "tags": [
        {
          "type": "icon",
          "library": "simple",
          "name": "portainer"
        },
        "Docker GUI"
      ],
      "notes": [
        "Managing 35 containers"
      ]
    },
    "traefik": {
      "shape": "circle",
      "name": "Traefik",
      "ip": "192.168.1.51",
      "role": "Reverse Proxy",
      "tags": [
        {
          "type": "icon",
          "library": "simple",
          "name": "traefikproxy"
        },
        "SSL"
      ],
      "notes": [
        "Container on Docker",
        "Wildcard cert"
      ]
    },
    "grafana": {
      "shape": "circle",
      "name": "Grafana",
      "ip": "192.168.1.60",
      "role": "Monitoring",
      "tags": [
        {
          "type": "icon",
          "library": "simple",
          "name": "grafana"
        },
        "Dashboards"
      ],
      "notes": [
        "Container on Docker"
      ]
    },
    "prometheus": {
      "shape": "circle",
      "name": "Prometheus",
      "ip": "192.168.1.61",
      "role": "Metrics",
      "tags": [
        {
          "type": "icon",
          "library": "simple",
          "name": "prometheus"
        },
        "Time Series"
      ],
      "notes": [
        "Container on Docker",
        "15d retention"
      ]
    },
    "unifi-controller": {
      "shape": "router",
      "name": "UniFi Controller",
      "ip": "192.168.1.70",
      "role": "WiFi Management",
      "tags": [
        {
          "type": "icon",
          "library": "simple",
          "name": "ubiquiti"
        },
        "Network"
      ],
      "notes": [
        "Container on Docker",
        "3 APs"
      ]
    },
    "wireguard": {
      "shape": "router",
      "name": "WireGuard",
      "ip": "192.168.1.80",
      "role": "VPN",
      "tags": [
        {
          "type": "icon",
          "library": "simple",
          "name": "wireguard"
        },
        "Remote Access"
      ],
      "notes": [
        "VM on Proxmox",
        "5 clients"
      ]
    }
  },
  "edgeData": {
    "list": [
      {
        "id": "edge-1",
        "from": "isp-modem",
        "to": "opnsense",
        "color": "#ef4444",
        "width": 6,
        "notes": [
          "WAN 1Gbps"
        ],
        "lineStyle": "solid",
        "direction": "both",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-2",
        "from": "opnsense",
        "to": "main-switch",
        "color": "#10b981",
        "width": 6,
        "notes": [
          "LAN Trunk"
        ],
        "lineStyle": "solid",
        "direction": "both",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-3",
        "from": "main-switch",
        "to": "proxmox",
        "color": "#8b5cf6",
        "width": 5,
        "notes": [
          "Server VLAN"
        ],
        "lineStyle": "solid",
        "direction": "both",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-4",
        "from": "main-switch",
        "to": "truenas",
        "color": "#8b5cf6",
        "width": 5,
        "notes": [
          "Storage VLAN",
          "Jumbo frames"
        ],
        "lineStyle": "solid",
        "direction": "both",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-5",
        "from": "main-switch",
        "to": "docker-host",
        "color": "#8b5cf6",
        "width": 5,
        "notes": [
          "Server VLAN"
        ],
        "lineStyle": "solid",
        "direction": "both",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-6",
        "from": "main-switch",
        "to": "pi-hole",
        "color": "#3b82f6",
        "width": 4,
        "notes": [
          "Management VLAN"
        ],
        "lineStyle": "solid",
        "direction": "both",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-7",
        "from": "proxmox",
        "to": "plex",
        "color": "#f59e0b",
        "width": 4,
        "notes": [
          "VM Network"
        ],
        "lineStyle": "dashed",
        "direction": "both",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-8",
        "from": "proxmox",
        "to": "homeassistant",
        "color": "#f59e0b",
        "width": 4,
        "notes": [
          "VM Network"
        ],
        "lineStyle": "dashed",
        "direction": "both",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-9",
        "from": "proxmox",
        "to": "wireguard",
        "color": "#f59e0b",
        "width": 4,
        "notes": [
          "VM Network"
        ],
        "lineStyle": "dashed",
        "direction": "both",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-10",
        "from": "docker-host",
        "to": "jellyfin",
        "color": "#06b6d4",
        "width": 4,
        "notes": [
          "Container"
        ],
        "lineStyle": "dotted",
        "direction": "both",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-11",
        "from": "docker-host",
        "to": "nextcloud",
        "color": "#06b6d4",
        "width": 4,
        "notes": [
          "Container"
        ],
        "lineStyle": "dotted",
        "direction": "both",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-12",
        "from": "docker-host",
        "to": "bitwarden",
        "color": "#06b6d4",
        "width": 4,
        "notes": [
          "Container"
        ],
        "lineStyle": "dotted",
        "direction": "both",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-13",
        "from": "docker-host",
        "to": "portainer",
        "color": "#06b6d4",
        "width": 4,
        "notes": [
          "Container"
        ],
        "lineStyle": "dotted",
        "direction": "both",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-14",
        "from": "docker-host",
        "to": "traefik",
        "color": "#06b6d4",
        "width": 4,
        "notes": [
          "Container"
        ],
        "lineStyle": "dotted",
        "direction": "both",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-15",
        "from": "docker-host",
        "to": "grafana",
        "color": "#06b6d4",
        "width": 4,
        "notes": [
          "Container"
        ],
        "lineStyle": "dotted",
        "direction": "both",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-16",
        "from": "docker-host",
        "to": "prometheus",
        "color": "#06b6d4",
        "width": 4,
        "notes": [
          "Container"
        ],
        "lineStyle": "dotted",
        "direction": "both",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-17",
        "from": "docker-host",
        "to": "unifi-controller",
        "color": "#06b6d4",
        "width": 4,
        "notes": [
          "Container"
        ],
        "lineStyle": "dotted",
        "direction": "both",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-18",
        "from": "truenas",
        "to": "plex",
        "color": "#ec4899",
        "width": 3,
        "notes": [
          "Media Storage",
          "NFS"
        ],
        "lineStyle": "dashed",
        "direction": "forward",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-19",
        "from": "truenas",
        "to": "jellyfin",
        "color": "#ec4899",
        "width": 3,
        "notes": [
          "Media Storage",
          "NFS"
        ],
        "lineStyle": "dashed",
        "direction": "forward",
        "_pairIndex": 0,
        "_pairTotal": 1
      },
      {
        "id": "edge-20",
        "from": "truenas",
        "to": "nextcloud",
        "color": "#ec4899",
        "width": 3,
        "notes": [
          "Data Storage",
          "SMB"
        ],
        "lineStyle": "dashed",
        "direction": "forward",
        "_pairIndex": 0,
        "_pairTotal": 1
      }
    ]
  },
  "edgeLegend": {
    "#ef4444": "WAN",
    "#10b981": "LAN Trunk",
    "#8b5cf6": "Server VLAN",
    "#3b82f6": "Management",
    "#f59e0b": "VM Network",
    "#06b6d4": "Containers",
    "#ec4899": "Storage"
  },
  "nodePositions": {
    "isp-modem": {
      "x": 2000,
      "y": 200
    },
    "opnsense": {
      "x": 2000,
      "y": 550
    },
    "main-switch": {
      "x": 2000,
      "y": 950
    },
    "proxmox": {
      "x": 1200,
      "y": 1350
    },
    "truenas": {
      "x": 2800,
      "y": 1350
    },
    "docker-host": {
      "x": 2000,
      "y": 1350
    },
    "pi-hole": {
      "x": 2000,
      "y": 1650
    },
    "plex": {
      "x": 600,
      "y": 1850
    },
    "jellyfin": {
      "x": 1400,
      "y": 2250
    },
    "nextcloud": {
      "x": 1800,
      "y": 2250
    },
    "bitwarden": {
      "x": 2200,
      "y": 2250
    },
    "homeassistant": {
      "x": 1000,
      "y": 1850
    },
    "portainer": {
      "x": 2600,
      "y": 2250
    },
    "traefik": {
      "x": 3000,
      "y": 2250
    },
    "grafana": {
      "x": 3400,
      "y": 2250
    },
    "prometheus": {
      "x": 3400,
      "y": 1850
    },
    "unifi-controller": {
      "x": 3000,
      "y": 1850
    },
    "wireguard": {
      "x": 1400,
      "y": 1850
    }
  },
  "nodeSizes": {},
  "nodeStyles": {
    "pi-hole": {
      "all": {
        "icon": {
          "library": "selfhst",
          "name": "pi-hole"
        }
      }
    },
    "plex": {
      "all": {
        "icon": {
          "library": "selfhst",
          "name": "plex"
        }
      }
    },
    "jellyfin": {
      "all": {
        "icon": {
          "library": "selfhst",
          "name": "jellyfin"
        }
      }
    },
    "nextcloud": {
      "all": {
        "icon": {
          "library": "simple",
          "name": "nextcloud"
        }
      }
    },
    "bitwarden": {
      "all": {
        "icon": {
          "library": "simple",
          "name": "bitwarden"
        }
      }
    },
    "homeassistant": {
      "all": {
        "icon": {
          "library": "simple",
          "name": "homeassistant"
        }
      }
    },
    "portainer": {
      "all": {
        "icon": {
          "library": "simple",
          "name": "portainer"
        }
      }
    },
    "traefik": {
      "all": {
        "icon": {
          "library": "simple",
          "name": "traefikproxy"
        }
      }
    },
    "grafana": {
      "all": {
        "icon": {
          "library": "simple",
          "name": "grafana"
        }
      }
    },
    "prometheus": {
      "all": {
        "icon": {
          "library": "simple",
          "name": "prometheus"
        }
      }
    },
    "unifi-controller": {
      "all": {
        "icon": {
          "library": "simple",
          "name": "ubiquiti"
        }
      }
    },
    "wireguard": {
      "all": {
        "icon": {
          "library": "simple",
          "name": "wireguard"
        }
      }
    }
  },
  "iconCache": {
    "selfhst-pi-hole": "<svg xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" viewBox=\"0 0 512 512\"><linearGradient id=\"pi-hole_svg__a\" x1=\"1124.653\" x2=\"1839.97\" y1=\"-669.315\" y2=\"-669.315\" gradientTransform=\"matrix(.3694 0 0 -.3694 -322.747 -168.195)\" gradientUnits=\"userSpaceOnUse\"><stop offset=\"0\" style=\"stop-color:#12b212\"/><stop offset=\"1\" style=\"stop-color:#0f0\"/></linearGradient><path d=\"M226.1 157.3C162.1 150.5 97.7 102.2 92.7 0 191.8 0 244.9 58.7 250 151.8c18.8-111.6 106.7-98.5 106.7-98.5 4.2 63.2-47.8 101.6-106.7 104.8-16.5-35-115.7-120.5-115.7-120.5-.1-.1-.3-.1-.4 0q-.15.15 0 .3s95.7 83.4 92.2 119.4\" style=\"fill:url(#pi-hole_svg__a)\"/><path d=\"M256 512c-6.2-.4-63.9-2.6-67.4-67.4-2.8-39.4 28.3-68.5 28.3-106.7-7.1-95.4-134.9-83.6-134.9 0-.1 20.9 8.2 40.9 23 55.7l95.2 95.3c14.8 14.8 34.8 23 55.8 23.1m0-348.1c6.2.4 63.9 2.6 67.4 67.4 2.8 39.4-28.3 68.5-28.3 106.7 7.1 95.4 134.8 83.6 134.8 0 .1-20.9-8.2-40.9-23-55.7L311.7 187c-14.8-14.8-34.8-23-55.7-23\" style=\"fill:#91180c\"/><path d=\"M430 337.9c-.4 6.2-2.6 63.9-67.4 67.4-39.4 2.8-68.5-28.3-106.7-28.3-95.4 7.1-83.6 134.8 0 134.8 20.9.1 40.9-8.2 55.7-23l95.3-95.2c14.8-14.8 23-34.8 23.1-55.7m-347.7 0c.4-6.2 2.6-63.9 67.4-67.4 39.4-2.8 68.5 28.3 106.7 28.3 95.4-7.2 83.6-134.8 0-134.8-20.9-.1-40.9 8.2-55.7 23l-95.3 95.3c-14.8 14.8-23 34.8-23 55.7\" style=\"fill:#f42e1c\"/></svg>",
    "selfhst-plex": "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><rect width=\"512\" height=\"512\" fill=\"#282a2d\" rx=\"15%\"/><path fill=\"#e5a00d\" d=\"M256 70H148l108 186-108 186h108l108-186z\"/></svg>",
    "selfhst-jellyfin": "<svg xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" viewBox=\"0 0 512 512\"><linearGradient id=\"jellyfin_svg__a\" x1=\"97.487\" x2=\"522.047\" y1=\"483.902\" y2=\"729.018\" gradientTransform=\"translate(0 -278)\" gradientUnits=\"userSpaceOnUse\"><stop offset=\"0\" style=\"stop-color:#aa5cc3\"/><stop offset=\"1\" style=\"stop-color:#00a4dc\"/></linearGradient><path d=\"M256 196.2c-22.4 0-94.8 131.3-83.8 153.4s156.8 21.9 167.7 0-61.3-153.4-83.9-153.4\" style=\"fill:url(#jellyfin_svg__a)\"/><linearGradient id=\"jellyfin_svg__b\" x1=\"94.186\" x2=\"518.747\" y1=\"489.619\" y2=\"734.735\" gradientTransform=\"translate(0 -278)\" gradientUnits=\"userSpaceOnUse\"><stop offset=\"0\" style=\"stop-color:#aa5cc3\"/><stop offset=\"1\" style=\"stop-color:#00a4dc\"/></linearGradient><path d=\"M256 0C188.3 0-29.8 395.4 3.4 462.2s472.3 66 505.2 0S323.8 0 256 0m165.6 404.3c-21.6 43.2-309.3 43.8-331.1 0S211.7 101.4 256 101.4 443.2 361 421.6 404.3\" style=\"fill:url(#jellyfin_svg__b)\"/></svg>",
    "simple-nextcloud": "<svg role=\"img\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><title>Nextcloud</title><path d=\"M12.018 6.537c-2.5 0-4.6 1.712-5.241 4.015-.56-1.232-1.793-2.105-3.225-2.105A3.569 3.569 0 0 0 0 12a3.569 3.569 0 0 0 3.552 3.553c1.432 0 2.664-.874 3.224-2.106.641 2.304 2.742 4.016 5.242 4.016 2.487 0 4.576-1.693 5.231-3.977.569 1.21 1.783 2.067 3.198 2.067A3.568 3.568 0 0 0 24 12a3.569 3.569 0 0 0-3.553-3.553c-1.416 0-2.63.858-3.199 2.067-.654-2.284-2.743-3.978-5.23-3.977zm0 2.085c1.878 0 3.378 1.5 3.378 3.378 0 1.878-1.5 3.378-3.378 3.378A3.362 3.362 0 0 1 8.641 12c0-1.878 1.5-3.378 3.377-3.378zm-8.466 1.91c.822 0 1.467.645 1.467 1.468s-.644 1.467-1.467 1.468A1.452 1.452 0 0 1 2.085 12c0-.823.644-1.467 1.467-1.467zm16.895 0c.823 0 1.468.645 1.468 1.468s-.645 1.468-1.468 1.468A1.452 1.452 0 0 1 18.98 12c0-.823.644-1.467 1.467-1.467z\"/></svg>",
    "simple-bitwarden": "<svg role=\"img\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><title>Bitwarden</title><path d=\"M21.722.296A.964.964 0 0 0 21.018 0H2.982a.959.959 0 0 0-.703.296.96.96 0 0 0-.297.702v12c0 .895.174 1.783.523 2.665.349.88.783 1.66 1.3 2.345.517.68 1.132 1.346 1.848 1.993a21.807 21.807 0 0 0 1.98 1.609c.605.427 1.235.83 1.893 1.212.657.381 1.125.638 1.4.772.276.134.5.241.664.311a.916.916 0 0 0 .814 0c.168-.073.389-.177.667-.311.275-.134.743-.394 1.401-.772a25.305 25.305 0 0 0 1.894-1.212A21.891 21.891 0 0 0 18.348 20c.716-.647 1.33-1.31 1.847-1.993s.949-1.463 1.3-2.345c.35-.879.524-1.767.524-2.665V1.001a.95.95 0 0 0-.297-.705zm-2.325 12.815c0 4.344-7.397 8.087-7.397 8.087V2.57h7.397v10.54z\"/></svg>",
    "simple-homeassistant": "<svg role=\"img\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><title>Home Assistant</title><path d=\"M22.939 10.627 13.061.749a1.505 1.505 0 0 0-2.121 0l-9.879 9.878C.478 11.21 0 12.363 0 13.187v9c0 .826.675 1.5 1.5 1.5h9.227l-4.063-4.062a2.034 2.034 0 0 1-.664.113c-1.13 0-2.05-.92-2.05-2.05s.92-2.05 2.05-2.05 2.05.92 2.05 2.05c0 .233-.041.456-.113.665l3.163 3.163V9.928a2.05 2.05 0 0 1-1.15-1.84c0-1.13.92-2.05 2.05-2.05s2.05.92 2.05 2.05a2.05 2.05 0 0 1-1.15 1.84v8.127l3.146-3.146A2.051 2.051 0 0 1 18 12.239c1.13 0 2.05.92 2.05 2.05s-.92 2.05-2.05 2.05c-.25 0-.488-.047-.709-.13L12.9 20.602v3.088h9.6c.825 0 1.5-.675 1.5-1.5v-9c0-.825-.477-1.977-1.061-2.561z\"/></svg>",
    "simple-portainer": "<svg role=\"img\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><title>Portainer</title><path d=\"M12.504 0v1.023l-.01-.015-6.106 3.526H3.417v.751h5.359v3.638h1.942V5.284h1.786v10.416c.027 0 .54-.01.751.091V5.285h.531v10.608c.293.147.55.312.751.54V5.286h6.046v-.75h-1.267l-6.061-3.5V0zm0 1.87v2.664H7.889zm.751.031l4.56 2.633h-4.56zM9.142 5.285h1.21v1.686h-1.21zm-4.736 2.73v1.951h1.942v-1.95zm2.19 0v1.951h1.941v-1.95zm-2.19 2.171v1.951h1.942v-1.95zm2.19 0v1.951h1.941v-1.95zm2.18 0v1.951h1.942v-1.95zM4.36 12.43a3.73 3.73 0 00-.494 1.851c0 1.227.604 2.308 1.52 2.986.239-.064.477-.1.724-.11.1 0 .165.01.266.019.284-1.191 1.383-1.988 2.665-1.988.724 0 1.438.201 1.924.668.229-.476.302-1.007.302-1.575 0-.65-.165-1.292-.494-1.85zm4.828 3.16c-1.21 0-2.226.844-2.492 1.97a.922.922 0 00-.275-.009 2.559 2.559 0 00-2.564 2.556 2.565 2.565 0 003.096 2.5A2.579 2.579 0 009.233 24c.862 0 1.622-.43 2.09-1.081a2.557 2.557 0 004.186-1.97c0-.567-.193-1.099-.504-1.52a2.557 2.557 0 00-3.866-2.94 2.574 2.574 0 00-1.951-.898z\"/></svg>",
    "simple-traefikproxy": "<svg role=\"img\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><title>Traefik Proxy</title><path d=\"M12 1.19c1.088 0 2.056.768 2.056 1.714 0 .947-.921 1.715-2.056 1.715-.13 0-.3-.022-.509-.064a.685.685 0 0 0-.475.076l-7.37 4.195a.344.344 0 0 0 .001.597l7.99 4.49c.208.116.461.116.669 0l8.034-4.468a.343.343 0 0 0 .003-.598l-2.507-1.424a.683.683 0 0 0-.67-.003l-2.647 1.468a.234.234 0 0 0-.119.18l-.001.025c0 .946-.921 1.714-2.056 1.714s-2.056-.768-2.056-1.714c0-.947.921-1.715 2.056-1.715.042 0 .09.002.145.007l.087.008.096.013a.685.685 0 0 0 .425-.08l3.913-2.173c.3-.166.662-.171.965-.017l.04.023 5.465 3.104c.686.39.693 1.368.03 1.773l-.037.021-3.656 2.033a.343.343 0 0 0 .007.604l3.62 1.906c.72.378.736 1.402.03 1.804l-10.995 6.272a1.03 1.03 0 0 1-1.019 0L.526 16.43a1.03 1.03 0 0 1 .034-1.806l3.66-1.911a.343.343 0 0 0 .01-.603L.524 10.029a1.03 1.03 0 0 1-.041-1.77l.036-.021L9.618 3.06a.688.688 0 0 0 .308-.369l.011-.036c.32-.952 1.046-1.466 2.063-1.466Zm5.076 12.63-4.492 2.586-.041.022c-.306.158-.671.152-.973-.018l-4.478-2.527a.682.682 0 0 0-.65-.01L3.86 15.224a.343.343 0 0 0-.012.602l7.887 4.515c.21.12.467.121.677 0l7.956-4.547a.343.343 0 0 0-.01-.602l-2.623-1.384a.683.683 0 0 0-.659.012z\"/></svg>",
    "simple-grafana": "<svg role=\"img\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><title>Grafana</title><path d=\"M23.02 10.59a8.578 8.578 0 0 0-.862-3.034 8.911 8.911 0 0 0-1.789-2.445c.337-1.342-.413-2.505-.413-2.505-1.292-.08-2.113.4-2.416.62-.052-.02-.102-.044-.154-.064-.22-.089-.446-.172-.677-.247-.231-.073-.47-.14-.711-.197a9.867 9.867 0 0 0-.875-.161C14.557.753 12.94 0 12.94 0c-1.804 1.145-2.147 2.744-2.147 2.744l-.018.093c-.098.029-.2.057-.298.088-.138.042-.275.094-.413.143-.138.055-.275.107-.41.166a8.869 8.869 0 0 0-1.557.87l-.063-.029c-2.497-.955-4.716.195-4.716.195-.203 2.658.996 4.33 1.235 4.636a11.608 11.608 0 0 0-.607 2.635C1.636 12.677.953 15.014.953 15.014c1.926 2.214 4.171 2.351 4.171 2.351.003-.002.006-.002.006-.005.285.509.615.994.986 1.446.156.19.32.371.488.548-.704 2.009.099 3.68.099 3.68 2.144.08 3.553-.937 3.849-1.173a9.784 9.784 0 0 0 3.164.501h.08l.055-.003.107-.002.103-.005.003.002c1.01 1.44 2.788 1.646 2.788 1.646 1.264-1.332 1.337-2.653 1.337-2.94v-.058c0-.02-.003-.039-.003-.06.265-.187.52-.387.758-.6a7.875 7.875 0 0 0 1.415-1.7c1.43.083 2.437-.885 2.437-.885-.236-1.49-1.085-2.216-1.264-2.354l-.018-.013-.016-.013a.217.217 0 0 1-.031-.02c.008-.092.016-.18.02-.27.011-.162.016-.323.016-.48v-.253l-.005-.098-.008-.135a1.891 1.891 0 0 0-.01-.13c-.003-.042-.008-.083-.013-.125l-.016-.124-.018-.122a6.215 6.215 0 0 0-2.032-3.73 6.015 6.015 0 0 0-3.222-1.46 6.292 6.292 0 0 0-.85-.048l-.107.002h-.063l-.044.003-.104.008a4.777 4.777 0 0 0-3.335 1.695c-.332.4-.592.84-.768 1.297a4.594 4.594 0 0 0-.312 1.817l.003.091c.005.055.007.11.013.164a3.615 3.615 0 0 0 .698 1.82 3.53 3.53 0 0 0 1.827 1.282c.33.098.66.14.971.137.039 0 .078 0 .114-.002l.063-.003c.02 0 .041-.003.062-.003.034-.002.065-.007.099-.01.007 0 .018-.003.028-.003l.031-.005.06-.008a1.18 1.18 0 0 0 .112-.02c.036-.008.072-.013.109-.024a2.634 2.634 0 0 0 .914-.415c.028-.02.056-.041.085-.065a.248.248 0 0 0 .039-.35.244.244 0 0 0-.309-.06l-.078.042c-.09.044-.184.083-.283.116a2.476 2.476 0 0 1-.475.096c-.028.003-.054.006-.083.006l-.083.002c-.026 0-.054 0-.08-.002l-.102-.006h-.012l-.024.006c-.016-.003-.031-.003-.044-.006-.031-.002-.06-.007-.091-.01a2.59 2.59 0 0 1-.724-.213 2.557 2.557 0 0 1-.667-.438 2.52 2.52 0 0 1-.805-1.475 2.306 2.306 0 0 1-.029-.444l.006-.122v-.023l.002-.031c.003-.021.003-.04.005-.06a3.163 3.163 0 0 1 1.352-2.29 3.12 3.12 0 0 1 .937-.43 2.946 2.946 0 0 1 .776-.101h.06l.07.002.045.003h.026l.07.005a4.041 4.041 0 0 1 1.635.49 3.94 3.94 0 0 1 1.602 1.662 3.77 3.77 0 0 1 .397 1.414l.005.076.003.075c.002.026.002.05.002.075 0 .024.003.052 0 .07v.065l-.002.073-.008.174a6.195 6.195 0 0 1-.08.639 5.1 5.1 0 0 1-.267.927 5.31 5.31 0 0 1-.624 1.13 5.052 5.052 0 0 1-3.237 2.014 4.82 4.82 0 0 1-.649.066l-.039.003h-.287a6.607 6.607 0 0 1-1.716-.265 6.776 6.776 0 0 1-3.4-2.274 6.75 6.75 0 0 1-.746-1.15 6.616 6.616 0 0 1-.714-2.596l-.005-.083-.002-.02v-.056l-.003-.073v-.096l-.003-.104v-.07l.003-.163c.008-.22.026-.45.054-.678a8.707 8.707 0 0 1 .28-1.355c.128-.444.286-.872.473-1.277a7.04 7.04 0 0 1 1.456-2.1 5.925 5.925 0 0 1 .953-.763c.169-.111.343-.213.524-.306.089-.05.182-.091.273-.135.047-.02.093-.042.138-.062a7.177 7.177 0 0 1 .714-.267l.145-.045c.049-.015.098-.026.148-.041.098-.029.197-.052.296-.076.049-.013.1-.02.15-.033l.15-.032.151-.028.076-.013.075-.01.153-.024c.057-.01.114-.013.171-.023l.169-.021c.036-.003.073-.008.106-.01l.073-.008.036-.003.042-.002c.057-.003.114-.008.171-.01l.086-.006h.023l.037-.003.145-.007a7.999 7.999 0 0 1 1.708.125 7.917 7.917 0 0 1 2.048.68 8.253 8.253 0 0 1 1.672 1.09l.09.077.089.078c.06.052.114.107.171.159.057.052.112.106.166.16.052.055.107.107.159.164a8.671 8.671 0 0 1 1.41 1.978c.012.026.028.052.04.078l.04.078.075.156c.023.051.05.1.07.153l.065.15a8.848 8.848 0 0 1 .45 1.34.19.19 0 0 0 .201.142.186.186 0 0 0 .172-.184c.01-.246.002-.532-.024-.856z\"/></svg>",
    "simple-prometheus": "<svg role=\"img\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><title>Prometheus</title><path d=\"M12 0C5.373 0 0 5.372 0 12c0 6.627 5.373 12 12 12s12-5.373 12-12c0-6.628-5.373-12-12-12zm0 22.46c-1.885 0-3.414-1.26-3.414-2.814h6.828c0 1.553-1.528 2.813-3.414 2.813zm5.64-3.745H6.36v-2.046h11.28v2.046zm-.04-3.098H6.391c-.037-.043-.075-.086-.111-.13-1.155-1.401-1.427-2.133-1.69-2.879-.005-.025 1.4.287 2.395.511 0 0 .513.119 1.262.255-.72-.843-1.147-1.915-1.147-3.01 0-2.406 1.845-4.508 1.18-6.207.648.053 1.34 1.367 1.387 3.422.689-.951.977-2.69.977-3.755 0-1.103.727-2.385 1.454-2.429-.648 1.069.168 1.984.894 4.256.272.854.237 2.29.447 3.201.07-1.892.395-4.652 1.595-5.605-.529 1.2.079 2.702.494 3.424.671 1.164 1.078 2.047 1.078 3.716a4.642 4.642 0 01-1.11 2.996c.792-.149 1.34-.283 1.34-.283l2.573-.502s-.374 1.538-1.81 3.019z\"/></svg>",
    "simple-ubiquiti": "<svg role=\"img\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><title>Ubiquiti</title><path d=\"M23.1627 0h-1.4882v1.4882h1.4882zm-5.2072 10.4226V7.4409l.0007.001h2.9755v2.9762h2.9756v.9433c0 1.0906-.0927 2.3827-.306 3.3973-.1194.5672-.3004 1.1308-.5127 1.672-.2175.5537-.468 1.0841-.7408 1.5595a11.6795 11.6795 0 0 1-1.2456 1.7762l-.0253.0294-.0417.0488c-.1148.1347-.2283.2679-.3531.398a11.7612 11.7612 0 0 1-.4494.4492c-1.9046 1.8343-4.3861 2.98-6.9808 3.243-.3122.032-.939.0652-1.2519.0652-.3139-.001-.9397-.0331-1.252-.0651-2.5946-.263-5.0761-1.4097-6.9806-3.243a11.75 11.75 0 0 1-.4495-.4494c-.131-.1356-.249-.2748-.3683-.4154l-.0006-.0004-.0512-.0603a11.6576 11.6576 0 0 1-1.2456-1.7762c-.2727-.4763-.5233-1.0058-.7408-1.5595-.2123-.5414-.3933-1.1048-.5128-1.6718C.1854 13.743.0927 12.452.0927 11.3616V.1864h5.9518v10.2362s0 .7847.0099 1.0415l.0022.0599v.0004c.0127.332.0247.6575.0594.9812.098.919.3014 1.7913.7203 2.5288.1213.213.2443.42.3915.616.8953 1.1939 2.2577 2.0901 3.9573 2.3398.2022.0294.6108.0552.8149.0552.204 0 .6125-.0258.8149-.0552 1.6996-.2497 3.062-1.146 3.9573-2.3398.148-.196.2701-.403.3914-.616.419-.7375.6224-1.6095.7204-2.5288.0346-.3243.047-.6503.0594-.9831l.0022-.0584c.0099-.2568.0099-1.0415.0099-1.0415zm.7427-8.19h2.2326v2.2319h2.9764v2.9764h-2.9764V4.4654h-2.2326V2.2328Z\"/></svg>",
    "simple-wireguard": "<svg role=\"img\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><title>WireGuard</title><path d=\"M23.98 11.645S24.533 0 11.735 0C.418 0 .064 11.17.064 11.17S-1.6 24 11.997 24C25.04 24 23.98 11.645 23.98 11.645zM8.155 7.576c2.4-1.47 5.469-.571 6.618 1.638.218.419.246 1.063.108 1.503-.477 1.516-1.601 2.366-3.145 2.728.455-.39.817-.832.933-1.442a2.112 2.112 0 0 0-.364-1.677 2.14 2.14 0 0 0-2.465-.75c-.95.36-1.47 1.228-1.377 2.294.087.99.839 1.632 2.245 1.876-.21.111-.372.193-.53.281a5.113 5.113 0 0 0-1.644 1.43c-.143.192-.24.208-.458.075-2.827-1.729-3.009-6.067.078-7.956zM6.04 18.258c-.455.116-.895.286-1.359.438.227-1.532 2.021-2.943 3.539-2.782a3.91 3.91 0 0 0-.74 2.072c-.504.093-.98.155-1.44.272zM15.703 3.3c.448.017.898.01 1.347.02a2.324 2.324 0 0 1 .334.047 3.249 3.249 0 0 1-.34.434c-.16.15-.341.296-.573.069-.055-.055-.187-.042-.283-.044-.447-.005-.894-.02-1.34-.003a8.323 8.323 0 0 0-1.154.118c-.072.013-.178.25-.146.338.078.207.191.435.359.567.619.49 1.277.928 1.9 1.413.604.472 1.167.99 1.51 1.7.446.928.46 1.9.267 2.877-.322 1.63-1.147 2.98-2.483 3.962-.538.395-1.205.62-1.821.903-.543.25-1.1.465-1.644.712-.98.446-1.53 1.51-1.369 2.615.149 1.015 1.04 1.862 2.059 2.037 1.223.21 2.486-.586 2.785-1.83.336-1.397-.423-2.646-1.845-3.024l-.256-.066c.38-.17.708-.291 1.012-.458q.793-.437 1.558-.925c.15-.096.231-.096.36.014.977.846 1.56 1.898 1.724 3.187.27 2.135-.74 4.096-2.646 5.101-2.948 1.555-6.557-.215-7.208-3.484-.558-2.8 1.418-5.34 3.797-5.83 1.023-.211 1.958-.637 2.685-1.425.47-.508.697-.944.775-1.141a3.165 3.165 0 0 0 .217-1.158 2.71 2.71 0 0 0-.237-.992c-.248-.566-1.2-1.466-1.435-1.656l-2.24-1.754c-.079-.065-.168-.06-.36-.047-.23.016-.815.048-1.067-.018.204-.155.76-.38 1-.56-.726-.49-1.554-.314-2.315-.46.176-.328 1.046-.831 1.541-.888a7.323 7.323 0 0 0-.135-.822c-.03-.111-.154-.22-.263-.283-.262-.154-.541-.281-.843-.434a1.755 1.755 0 0 1 .906-.28 3.385 3.385 0 0 1 .908.088c.54.123.97.042 1.399-.324-.338-.136-.676-.26-1.003-.407a9.843 9.843 0 0 1-.942-.493c.85.118 1.671.437 2.54.32l.022-.118-2.018-.47c1.203-.11 2.323-.128 3.384.388.299.146.61.266.897.432.14.08.233.24.348.365.09.098.164.23.276.29.424.225.89.234 1.366.223l.01-.16c.479.15 1.017.702 1.017 1.105-.776 0-1.55-.003-2.325.004-.083 0-.165.061-.247.094.078.046.155.128.235.131z M14.703 2.153a.118.118 0 0 0-.016.19.179.179 0 0 0 .246.065c.075-.038.148-.078.238-.125-.072-.062-.13-.114-.19-.163-.106-.087-.193-.032-.278.033z\"/></svg>"
  },
  "page": {
    "title": "Homelab",
    "background": "",
    "topbarBg": "rgba(9, 12, 20, 0.9)",
    "topbarBorder": "#1f2533",
    "panel": "#0b0e13",
    "panelAlt": "#10141b",
    "accent": "#4fd1c5",
    "danger": "#f56565",
    "textMain": "#e2e8f0",
    "textSoft": "#94a3b8",
    "topbarHeight": 100,
    "sidebarWidth": 435,
    "mobileFooterHeight": 20,
    "sidebarCollapsed": false
  },
  "canvas": {
    "zoom": 1.2244897959183674,
    "panX": 366.66666666666674,
    "panY": 0
  }
}</script>
  <script>
   const IconLibrary = {
    libraries: {
     mdi: {
      name: 'Material Design Icons',
      cdnBase: 'https://cdn.jsdelivr.net/npm/@mdi/svg@latest/svg/',
      metaUrl: 'https://cdn.jsdelivr.net/npm/@mdi/svg@latest/meta.json',
      icons: []
     },
     simple: {
      name: 'Simple Icons',
      cdnBase: 'https://cdn.jsdelivr.net/npm/simple-icons@latest/icons/',
      indexUrl: 'https://cdn.jsdelivr.net/npm/@iconify-json/simple-icons@latest/icons.json',
      icons: []
     },
     selfhst: {
      name: 'Selfh.st',
      cdnBase: 'https://cdn.jsdelivr.net/gh/selfhst/icons@master/png/',
      indexUrl: 'https://raw.githubusercontent.com/selfhst/icons/refs/heads/main/index.json',
      icons: []
     }
    },
    currentLibrary: 'mdi',
    iconCache: {},
    indexCache: {},
    indexLoading: {},
    
    async loadLibraryIndex(library) {
     if (this.indexCache[library]) {
      return this.indexCache[library];
     }
     
     if (this.indexLoading[library]) {
      return this.indexLoading[library];
     }
     
     const lib = this.libraries[library];
     
     this.indexLoading[library] = (async () => {
      try {
       if (library === 'selfhst') {
        const response = await fetch(lib.indexUrl);
        const data = await response.json();
        const icons = data.map(item => ({
         name: item.Reference,
         displayName: item.Name,
         tags: item.Tags ? item.Tags.split(',').map(t => t.trim()).filter(t => t) : [],
         category: item.Category
        }));
        this.indexCache[library] = icons;
        lib.icons = icons;
        return icons;
       } else if (library === 'simple') {
        const response = await fetch('https://cdn.jsdelivr.net/npm/@iconify-json/simple-icons@latest/icons.json');
        const data = await response.json();
        const icons = Object.keys(data.icons).map(slug => ({
         name: slug,
         displayName: data.icons[slug].title || slug,
         tags: data.aliases && data.aliases[slug] ? [data.aliases[slug].parent] : [],
         hex: data.icons[slug].hex
        }));
        this.indexCache[library] = icons;
        lib.icons = icons;
        return icons;
       } else if (library === 'mdi') {
        const response = await fetch(lib.metaUrl);
        const data = await response.json();
        const icons = data.map(item => ({
         name: item.name,
         displayName: item.name,
         tags: item.tags || [],
         author: item.author
        }));
        this.indexCache[library] = icons;
        lib.icons = icons;
        return icons;
       }
      } catch (error) {
       console.error(`Failed to load index for ${library}:`, error);
       this.indexCache[library] = [];
       lib.icons = [];
       return [];
      } finally {
       delete this.indexLoading[library];
      }
     })();
     
     return this.indexLoading[library];
    },
    
    async getIcon(library, name) {
     const cacheKey = `${library}-${name}`;
     
     if (this.iconCache[cacheKey]) {
      return this.iconCache[cacheKey];
     }
     
     const cached = localStorage.getItem(`icon-${cacheKey}`);
     if (cached) {
      this.iconCache[cacheKey] = cached;
      return cached;
     }
     
     const lib = this.libraries[library];
	 
     if (library === 'selfhst') {
      const pngUrl = `${lib.cdnBase}${name}.png`;
      const svgWrapper = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><image href="${pngUrl}" width="24" height="24"/></svg>`;
      this.iconCache[cacheKey] = svgWrapper;
      localStorage.setItem(`icon-${cacheKey}`, svgWrapper);
      return svgWrapper;
     }
     
     const url = `${lib.cdnBase}${name}.svg`;
     
     try {
      const response = await fetch(url);
      if (!response.ok) {
       throw new Error(`HTTP ${response.status}`);
      }
      const svg = await response.text();
      
      this.iconCache[cacheKey] = svg;
      localStorage.setItem(`icon-${cacheKey}`, svg);
      
      return svg;
     } catch (error) {
      console.error(`Failed to fetch icon ${cacheKey}:`, error);
      return null;
     }
    },
    
    searchIcons(library, query) {
     const lib = this.libraries[library];
     if (!lib.icons.length) return [];
     
     const q = query.toLowerCase();
     return lib.icons.filter(icon => {
      const nameMatch = icon.name.toLowerCase().includes(q);
      const displayMatch = icon.displayName && icon.displayName.toLowerCase().includes(q);
      const tagMatch = icon.tags && icon.tags.some(t => t.toLowerCase().includes(q));
      const categoryMatch = icon.category && icon.category.toLowerCase().includes(q);
      return nameMatch || displayMatch || tagMatch || categoryMatch;
     }).slice(0, 50);
    }
   };
   
   let iconPickerCallback = null;
   let selectedNodeIconData = null;
   let newNodeIconTags = [];
   
   function openIconPicker(callback) {
    iconPickerCallback = callback;
    const modal = document.getElementById('icon-picker-modal');
    modal.classList.add('active');
    
    const searchInput = document.getElementById('icon-search');
    searchInput.style.display = 'none';
    
    loadIconsForCurrentLibrary();
   }
   
   function closeIconPicker() {
    const modal = document.getElementById('icon-picker-modal');
    modal.classList.remove('active');
    iconPickerCallback = null;
   }
   
   async function loadIconsForCurrentLibrary() {
    const body = document.getElementById('icon-picker-body');
    
    const libNames = {
     mdi: 'MDI (Material Design Icons)',
     simple: 'Simple Icons',
     selfhst: 'Selfh.st'
    };
    
    body.innerHTML = `
     <div style="padding: 20px;">
      <p style="color: var(--text-soft); margin-bottom: 15px; text-align: center;">
       Search ${libNames[IconLibrary.currentLibrary]}:
      </p>
      <input 
       type="text" 
       id="icon-search-field" 
       placeholder="Search icons..."
       style="width: 100%; padding: 12px; background: var(--panel-alt); border: 1px solid var(--edge-main); border-radius: 6px; color: var(--text-main); font-size: 16px; margin-bottom: 20px;"
      >
      <div id="icon-grid-container" style="max-height: 400px; overflow-y: auto;">
       <div style="text-align: center; color: var(--text-soft); padding: 40px;">
        Loading icons...
       </div>
      </div>
     </div>
    `;
    
    const searchField = document.getElementById('icon-search-field');
    const gridContainer = document.getElementById('icon-grid-container');
    
    await IconLibrary.loadLibraryIndex(IconLibrary.currentLibrary);
    
    const renderIcons = (icons) => {
     if (!icons || icons.length === 0) {
      gridContainer.innerHTML = '<div style="text-align: center; color: var(--text-soft); padding: 40px;">No icons found</div>';
      return;
     }
     
     const grid = document.createElement('div');
     grid.style.cssText = 'display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 15px; padding: 10px;';
     
     icons.forEach(icon => {
      const item = document.createElement('div');
      item.style.cssText = 'display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 15px; background: var(--panel-alt); border: 1px solid var(--edge-main); border-radius: 6px; cursor: pointer; transition: all 0.2s;';
      item.onmouseover = () => {
       item.style.background = 'var(--panel)';
       item.style.borderColor = 'var(--accent)';
      };
      item.onmouseout = () => {
       item.style.background = 'var(--panel-alt)';
       item.style.borderColor = 'var(--edge-main)';
      };
      
      const iconPreview = document.createElement('div');
      iconPreview.style.cssText = 'width: 48px; height: 48px; display: flex; align-items: center; justify-content: center;';
      iconPreview.innerHTML = '<div style="color: var(--text-soft); font-size: 12px;">...</div>';
      
      IconLibrary.getIcon(IconLibrary.currentLibrary, icon.name).then(svg => {
       if (svg) {
        const parser = new DOMParser();
        const doc = parser.parseFromString(svg, 'image/svg+xml');
        const svgEl = doc.querySelector('svg');
        if (svgEl) {
         svgEl.setAttribute('width', '48');
         svgEl.setAttribute('height', '48');
         svgEl.style.fill = 'var(--text-main)';
         iconPreview.innerHTML = '';
         iconPreview.appendChild(svgEl);
        }
       }
      });
      
      const name = document.createElement('div');
      name.textContent = icon.displayName || icon.name;
      name.style.cssText = 'font-size: 11px; color: var(--text-soft); text-align: center; word-break: break-word; max-width: 100%;';
      
      item.appendChild(iconPreview);
      item.appendChild(name);
      
      item.addEventListener('click', async () => {
       const svg = await IconLibrary.getIcon(IconLibrary.currentLibrary, icon.name);
       if (iconPickerCallback && svg) {
        iconPickerCallback({
         library: IconLibrary.currentLibrary,
         name: icon.name,
         svg: svg
        });
       }
       closeIconPicker();
      });
      
      grid.appendChild(item);
     });
     
     gridContainer.innerHTML = '';
     gridContainer.appendChild(grid);
    };
    
    gridContainer.innerHTML = '<div style="text-align: center; color: var(--text-soft); padding: 40px;">Type to search icons</div>';
    
    let searchTimeout;
    searchField.addEventListener('input', (e) => {
     clearTimeout(searchTimeout);
     const query = e.target.value.trim();
     
     searchTimeout = setTimeout(() => {
      if (!query) {
       gridContainer.innerHTML = '<div style="text-align: center; color: var(--text-soft); padding: 40px;">Type to search icons</div>';
       return;
      }
      
      const results = IconLibrary.searchIcons(IconLibrary.currentLibrary, query);
      renderIcons(results);
     }, 300);
    });
    
    searchField.focus();
   }
   
   async function displayIcons(icons) {
    const body = document.getElementById('icon-picker-body');
    const grid = document.createElement('div');
    grid.className = 'icon-grid';
    
    for (const icon of icons) {
      const item = document.createElement('div');
      item.className = 'icon-item';
      
      const svg = await IconLibrary.getIcon(icon.library, icon.name);
      if (svg) {
       const parser = new DOMParser();
       const doc = parser.parseFromString(svg, 'image/svg+xml');
       const svgEl = doc.querySelector('svg');
       if (svgEl) {
        item.innerHTML = svgEl.outerHTML;
       }
      } else {
       item.innerHTML = '<svg width="32" height="32"><rect width="32" height="32" fill="currentColor"/></svg>';
      }
      
      const name = document.createElement('div');
      name.className = 'icon-item-name';
      name.textContent = icon.name;
      item.appendChild(name);
      
      item.addEventListener('click', () => {
       if (iconPickerCallback) {
        iconPickerCallback({
         library: icon.library,
         name: icon.name,
         svg: svg
        });
       }
       closeIconPicker();
      });
      
      grid.appendChild(item);
    }
    
    body.innerHTML = '';
    body.appendChild(grid);
   }
   
   window.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.icon-picker-tab').forEach(tab => {
     tab.addEventListener('click', () => {
      document.querySelectorAll('.icon-picker-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      IconLibrary.currentLibrary = tab.dataset.library;
      loadIconsForCurrentLibrary();
     });
    });
    
    document.getElementById('icon-picker-cancel').addEventListener('click', closeIconPicker);
    
    document.getElementById('icon-picker-modal').addEventListener('click', (e) => {
     if (e.target.id === 'icon-picker-modal') {
      closeIconPicker();
     }
    });
   });
   
   const BASE_NODE_DATA = JSON.parse(document.getElementById("nodes-json").textContent, );
   let currentNodeId = "host";
   let currentEdgeId = null;
   let currentStyleScope = "all";
   let NODE_DATA = {};
   let EDGE_DATA = {
    list: []
   };
   let EDGE_LEGEND = {};
   let savedPositions = {};
   let savedSizes = {};
   let savedStyles = {};
   let legendCollapsed = false;
   let minimapCollapsed = false;
   let drawToolbarCollapsed = false;
   let topologyToolbarCollapsed = false;
   let legendMiniBtn = null;
   let minimapMiniBtn = null;
   let drawToolbarMiniBtn = null;
   let topologyToolbarMiniBtn = null;

   function ensureLegendMiniButton() {
    if (legendMiniBtn) return legendMiniBtn;
    const panel = document.querySelector(".topology-panel");
    if (!panel) return null;
    const btn = document.createElement("button");
    btn.type = "button";
    btn.id = "edge-legend-mini";
    btn.className = "legend-mini-btn";
    btn.textContent = "Legend";
	btn.style.bottom = "10px";
    const handleClick = (e) => {
     e.stopPropagation();
     e.preventDefault();
     legendCollapsed = false;
     updateLegendVisibility();
    };
    btn.addEventListener("click", handleClick);
    btn.addEventListener("touchend", handleClick);
    panel.appendChild(btn);
    legendMiniBtn = btn;
    return btn;
   }

   function ensureMinimapMiniButton() {
    if (minimapMiniBtn) return minimapMiniBtn;
    const panel = document.querySelector(".topology-panel");
    if (!panel) return null;
    const btn = document.createElement("button");
    btn.type = "button";
    btn.id = "minimap-mini";
    btn.className = "legend-mini-btn";
    btn.textContent = "Map";
    btn.style.right = "10px";
    btn.style.left = "auto";
    btn.style.bottom = "10px";
    const handleClick = (e) => {
     e.stopPropagation();
     e.preventDefault();
     minimapCollapsed = false;
     updateMinimapVisibility();
    };
    btn.addEventListener("click", handleClick);
    btn.addEventListener("touchend", handleClick);
    panel.appendChild(btn);
    minimapMiniBtn = btn;
    return btn;
   }

   function ensureDrawToolbarMiniButton() {
    if (drawToolbarMiniBtn) return drawToolbarMiniBtn;
    const panel = document.querySelector(".topology-panel");
    if (!panel) return null;
    const btn = document.createElement("button");
    btn.type = "button";
    btn.id = "draw-toolbar-mini";
    btn.className = "legend-mini-btn";
    btn.textContent = "Draw";
    btn.style.top = "10px";
    btn.style.left = "10px";
    btn.style.right = "auto";
    const handleClick = (e) => {
     e.stopPropagation();
     e.preventDefault();
     drawToolbarCollapsed = false;
     updateDrawToolbarVisibility();
    };
    btn.addEventListener("click", handleClick);
    btn.addEventListener("touchend", handleClick);
    panel.appendChild(btn);
    drawToolbarMiniBtn = btn;
    return btn;
   }

   function ensureTopologyToolbarMiniButton() {
    if (topologyToolbarMiniBtn) return topologyToolbarMiniBtn;
    const panel = document.querySelector(".topology-panel");
    if (!panel) return null;
    const btn = document.createElement("button");
    btn.type = "button";
    btn.id = "topology-toolbar-mini";
    btn.className = "legend-mini-btn";
    btn.textContent = "Add Line";
    btn.style.top = "10px";
    btn.style.left = "auto";
    btn.style.right = "40px";
    const handleClick = (e) => {
     e.stopPropagation();
     e.preventDefault();
     topologyToolbarCollapsed = false;
     updateTopologyToolbarVisibility();
    };
    btn.addEventListener("click", handleClick);
    btn.addEventListener("touchend", handleClick);
    panel.appendChild(btn);
    topologyToolbarMiniBtn = btn;
    return btn;
   }

   function updateToolbarStack() {
    if (window.innerWidth > 720) return;
    const draw = document.getElementById("draw-toolbar");
    const topo = document.getElementById("topology-toolbar");
    if (!draw || !topo) return;
    const h = draw.getBoundingClientRect().height;
    document.documentElement.style.setProperty("--draw-toolbar-height", h + "px");
   }
   window.addEventListener("resize", updateToolbarStack);
   window.addEventListener("DOMContentLoaded", updateToolbarStack);
   updateToolbarStack();

   function updateLegendVisibility() {
    const legend = document.getElementById("edge-legend");
    const mini = ensureLegendMiniButton();
    if (!legend || !mini) return;
    const hasItems = legend.querySelectorAll(".legend-item").length > 0;
    if (!hasItems) {
     legend.style.display = "none";
     mini.style.display = "none";
     return;
    }
    if (legendCollapsed) {
     legend.style.display = "none";
     mini.style.display = "inline-flex";
    } else {
     legend.style.display = "flex";
     mini.style.display = "none";
    }
   }

   function updateMinimapVisibility() {
    const wrapper = document.getElementById("minimap-zoom-wrapper");
    const mini = ensureMinimapMiniButton();
    if (!wrapper || !mini) return;
    
    if (minimapCollapsed) {
     wrapper.style.display = "none";
     mini.style.display = "inline-flex";
    } else {
     wrapper.style.display = "block";
     mini.style.display = "none";
    }
   }

   function updateDrawToolbarVisibility() {
    const toolbar = document.getElementById("draw-toolbar");
    const mini = ensureDrawToolbarMiniButton();
    if (!toolbar || !mini) return;
    
    if (drawToolbarCollapsed) {
     toolbar.style.setProperty('display', 'none', 'important');
     mini.style.display = "inline-flex";
    } else {
     toolbar.style.setProperty('display', 'flex', 'important');
     mini.style.display = "none";
    }
   }

   function updateTopologyToolbarVisibility() {
    const toolbar = document.getElementById("topology-toolbar");
    const mini = ensureTopologyToolbarMiniButton();
    if (!toolbar || !mini) return;
    
    // Check if we have a selected node (which means toolbar should be available)
    const hasSelectedNode = currentNodeId !== null;
    
    if (!hasSelectedNode) {
     // No node selected - hide both
     toolbar.style.setProperty('display', 'none', 'important');
     mini.style.display = "none";
    } else if (topologyToolbarCollapsed) {
     // Node selected but toolbar collapsed - show mini button
     toolbar.style.setProperty('display', 'none', 'important');
     mini.style.display = "inline-flex";
    } else {
     // Node selected and toolbar not collapsed - show toolbar
     toolbar.style.setProperty('display', 'flex', 'important');
     mini.style.display = "none";
    }
   }
   const DEFAULT_PAGE_STATE = {
    title: "The One File: The Networkening",
    background: "",
    topbarBg: "rgba(9, 12, 20, 0.9)",
    topbarBorder: "#1f2533",
    panel: "#0b0e13",
    panelAlt: "#10141b",
    accent: "#4fd1c5",
    danger: "#f56565",
    textMain: "#e2e8f0",
    textSoft: "#94a3b8",
    topbarHeight: 52,
    sidebarWidth: 350,
    mobileFooterHeight: 40,
    sidebarCollapsed: false,
   };
   let PAGE_STATE = Object.assign({}, DEFAULT_PAGE_STATE);
   const CANVAS_WIDTH = 4000;
   const CANVAS_HEIGHT = 3000;
   const CANVAS_PADDING = 100;
   let canvasState = {
    zoom: 1,
    panX: 0,
    panY: 0,
    minZoom: 0.25,
    maxZoom: 4,
    isPanning: false,
    panStartX: 0,
    panStartY: 0,
    spacePressed: false,
   };

   function getViewBox() {
    const viewWidth = CANVAS_WIDTH / canvasState.zoom;
    const viewHeight = CANVAS_HEIGHT / canvasState.zoom;
    return {
     x: canvasState.panX,
     y: canvasState.panY,
     width: viewWidth,
     height: viewHeight,
    };
   }

   function updateViewBox() {
    const svg = document.getElementById("map");
    const vb = getViewBox();
    svg.setAttribute("viewBox", `${vb.x} ${vb.y} ${vb.width} ${vb.height}`, );
    const zoomLevel = document.getElementById("zoom-level");
    if (zoomLevel) {
     zoomLevel.textContent = Math.round(canvasState.zoom * 100) + "%";
    }
    updateMinimap();
   }

   function updateMinimap() {
    const minimapViewport = document.getElementById("minimap-viewport");
    const minimapSvg = document.getElementById("minimap");
    if (!minimapViewport || !minimapSvg) return;
    const vb = getViewBox();
    minimapViewport.setAttribute("x", vb.x);
    minimapViewport.setAttribute("y", vb.y);
    minimapViewport.setAttribute("width", vb.width);
    minimapViewport.setAttribute("height", vb.height);
    const minimapNodes = minimapSvg.querySelectorAll(".minimap-node");
    minimapNodes.forEach((n) => n.remove());
    const minimapEdges = minimapSvg.querySelectorAll(".minimap-edge");
    minimapEdges.forEach((e) => e.remove());
    EDGE_DATA.list.forEach((edge) => {
     if (edge.type === "custom") return;
     const p1 = savedPositions[edge.from];
     const p2 = savedPositions[edge.to];
     if (!p1 || !p2) return;
     const line = document.createElementNS("http://www.w3.org/2000/svg", "line", );
     line.setAttribute("x1", p1.x);
     line.setAttribute("y1", p1.y);
     line.setAttribute("x2", p2.x);
     line.setAttribute("y2", p2.y);
     line.classList.add("minimap-edge");
     minimapSvg.insertBefore(line, minimapViewport);
    });
    Object.entries(savedPositions).forEach(([id, pos]) => {
     const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle", );
     circle.setAttribute("cx", pos.x);
     circle.setAttribute("cy", pos.y);
     circle.setAttribute("r", 40);
     circle.classList.add("minimap-node");
     minimapSvg.insertBefore(circle, minimapViewport);
    });
   }

   function zoomTo(newZoom, centerX, centerY) {
    const oldZoom = canvasState.zoom;
    newZoom = Math.max(canvasState.minZoom, Math.min(canvasState.maxZoom, newZoom), );
    if (centerX !== undefined && centerY !== undefined) {
     const oldWidth = CANVAS_WIDTH / oldZoom;
     const oldHeight = CANVAS_HEIGHT / oldZoom;
     const newWidth = CANVAS_WIDTH / newZoom;
     const newHeight = CANVAS_HEIGHT / newZoom;
     const pointX = canvasState.panX + centerX * oldWidth;
     const pointY = canvasState.panY + centerY * oldHeight;
     canvasState.panX = pointX - centerX * newWidth;
     canvasState.panY = pointY - centerY * newHeight;
    }
    canvasState.zoom = newZoom;
    constrainPan();
    updateViewBox();
   }

   function constrainPan() {
    const viewWidth = CANVAS_WIDTH / canvasState.zoom;
    const viewHeight = CANVAS_HEIGHT / canvasState.zoom;
    const minVisiblePortion = 0.1;
    const maxPanX = CANVAS_WIDTH - viewWidth * minVisiblePortion;
    const maxPanY = CANVAS_HEIGHT - viewHeight * minVisiblePortion;
    const minPanX = -viewWidth * (1 - minVisiblePortion);
    const minPanY = -viewHeight * (1 - minVisiblePortion);
    canvasState.panX = Math.max(minPanX, Math.min(maxPanX, canvasState.panX), );
    canvasState.panY = Math.max(minPanY, Math.min(maxPanY, canvasState.panY), );
   }

   function fitToContent() {
    const positions = Object.values(savedPositions);
    if (positions.length === 0) {
     resetView();
     return;
    }
    let minX = Infinity,
     minY = Infinity,
     maxX = -Infinity,
     maxY = -Infinity;
    positions.forEach((pos) => {
     minX = Math.min(minX, pos.x - 100);
     minY = Math.min(minY, pos.y - 100);
     maxX = Math.max(maxX, pos.x + 100);
     maxY = Math.max(maxY, pos.y + 100);
    });
    const contentWidth = maxX - minX + 200;
    const contentHeight = maxY - minY + 200;
    const viewport = document.getElementById("canvas-viewport");
    const vpRect = viewport.getBoundingClientRect();
    const aspectRatio = vpRect.width / vpRect.height;
    const contentAspect = contentWidth / contentHeight;
    let newZoom;
    if (contentAspect > aspectRatio) {
     newZoom = (vpRect.width / contentWidth) * (CANVAS_WIDTH / vpRect.width);
    } else {
     newZoom = (vpRect.height / contentHeight) * (CANVAS_HEIGHT / vpRect.height);
    }
    newZoom = Math.max(canvasState.minZoom, Math.min(2, newZoom));
    const viewWidth = CANVAS_WIDTH / newZoom;
    const viewHeight = CANVAS_HEIGHT / newZoom;
    canvasState.zoom = newZoom;
    canvasState.panX = minX - 100 - (viewWidth - contentWidth) / 2;
    canvasState.panY = minY - 100 - (viewHeight - contentHeight) / 2;
    constrainPan();
    updateViewBox();
   }

   function resetView() {
    canvasState.zoom = 1;
    canvasState.panX = 0;
    canvasState.panY = 0;
    updateViewBox();
   }
   window.addEventListener("DOMContentLoaded", () => {
    const toggle = document.getElementById("mobile-menu-toggle");
    const menu = document.getElementById("topbar-menu");
    if (!toggle || !menu) return;
    toggle.addEventListener("click", () => {
     menu.classList.toggle("open");
    });
    menu.addEventListener("click", (e) => {
     const target = e.target.closest("a, button");
     if (!target) return;
     if (window.matchMedia("(max-width: 720px)").matches) {
      menu.classList.remove("open");
     }
    });
    
    // Close button event listeners with touch support
    const minimapCloseBtn = document.getElementById("minimap-close-btn");
    if (minimapCloseBtn) {
     const handleMinimapClose = (e) => {
      e.stopPropagation();
      e.preventDefault();
      minimapCollapsed = true;
      updateMinimapVisibility();
     };
     minimapCloseBtn.addEventListener("click", handleMinimapClose);
     minimapCloseBtn.addEventListener("touchend", handleMinimapClose);
    }
    
    const drawToolbarCloseBtn = document.getElementById("draw-toolbar-close-btn");
    if (drawToolbarCloseBtn) {
     const handleDrawClose = (e) => {
      e.stopPropagation();
      e.preventDefault();
      drawToolbarCollapsed = true;
      updateDrawToolbarVisibility();
     };
     drawToolbarCloseBtn.addEventListener("click", handleDrawClose);
     drawToolbarCloseBtn.addEventListener("touchend", handleDrawClose);
    }
    
    const topologyToolbarCloseBtn = document.getElementById("topology-toolbar-close-btn");
    if (topologyToolbarCloseBtn) {
     const handleTopologyClose = (e) => {
      e.stopPropagation();
      e.preventDefault();
      topologyToolbarCollapsed = true;
      updateTopologyToolbarVisibility();
     };
     topologyToolbarCloseBtn.addEventListener("click", handleTopologyClose);
     topologyToolbarCloseBtn.addEventListener("touchstart", (e) => e.preventDefault(), { passive: false });
     topologyToolbarCloseBtn.addEventListener("touchend", handleTopologyClose);
    }
    
    // Initialize visibility states
    updateMinimapVisibility();
    updateDrawToolbarVisibility();
    updateTopologyToolbarVisibility();
   });

   function wieldThePower() {
    const root = document.documentElement;
    root.style.setProperty("--panel", PAGE_STATE.panel);
    root.style.setProperty("--panel-alt", PAGE_STATE.panelAlt);
    root.style.setProperty("--accent", PAGE_STATE.accent);
    root.style.setProperty("--danger", PAGE_STATE.danger);
    root.style.setProperty("--text-main", PAGE_STATE.textMain);
    root.style.setProperty("--text-soft", PAGE_STATE.textSoft);
    root.style.setProperty("--topbar-bg", PAGE_STATE.topbarBg);
    root.style.setProperty("--topbar-border", PAGE_STATE.topbarBorder);
    const topbarHeight = PAGE_STATE.topbarHeight || 52;
    const sidebarWidth = PAGE_STATE.sidebarWidth || 350;
    const mobileFooterHeight = PAGE_STATE.mobileFooterHeight || 40;
    root.style.setProperty("--topbar-height", topbarHeight + "px");
    root.style.setProperty("--sidebar-width", sidebarWidth + "px");
    root.style.setProperty("--mobile-footer-height", mobileFooterHeight + "vh", );
    const topbarHeightInput = document.getElementById("topbar-height");
    const topbarHeightVal = document.getElementById("topbar-height-val");
    const sidebarWidthInput = document.getElementById("sidebar-width");
    const sidebarWidthVal = document.getElementById("sidebar-width-val");
    const mobileFooterHeightInput = document.getElementById("mobile-footer-height", );
    const mobileFooterHeightVal = document.getElementById("mobile-footer-height-val", );
    if (topbarHeightInput) topbarHeightInput.value = topbarHeight;
    if (topbarHeightVal) topbarHeightVal.textContent = topbarHeight + "px";
    if (sidebarWidthInput) sidebarWidthInput.value = sidebarWidth;
    if (sidebarWidthVal) sidebarWidthVal.textContent = sidebarWidth + "px";
    if (mobileFooterHeightInput) mobileFooterHeightInput.value = mobileFooterHeight;
    if (mobileFooterHeightVal) mobileFooterHeightVal.textContent = mobileFooterHeight + "%";
    const mainEl = document.querySelector("main");
    const detailsPanel = document.getElementById("details-panel");
    const sidebarToggle = document.getElementById("sidebar-toggle");
    if (PAGE_STATE.sidebarCollapsed) {
     if (mainEl) mainEl.classList.add("sidebar-collapsed");
     if (detailsPanel) detailsPanel.classList.add("collapsed");
     if (sidebarToggle) {
      sidebarToggle.classList.add("collapsed");
      sidebarToggle.textContent = "‚ñ∂";
     }
    } else {
     if (mainEl) mainEl.classList.remove("sidebar-collapsed");
     if (detailsPanel) detailsPanel.classList.remove("collapsed");
     if (sidebarToggle) {
      sidebarToggle.classList.remove("collapsed");
      sidebarToggle.textContent = "‚óÄ";
     }
    }
    if (PAGE_STATE.background) {
     document.body.style.background = PAGE_STATE.background;
    } else {
     document.body.style.background = "radial-gradient(circle at top, #1e2532 0, #050608 70%)";
    }
    document.title = PAGE_STATE.title || DEFAULT_PAGE_STATE.title;
    const titleEl = document.getElementById("page-title");
    if (titleEl) {
     titleEl.textContent = PAGE_STATE.title || DEFAULT_PAGE_STATE.title;
    }
   }
   (async function awakeTheImmortal() {
    let initialState = {};
    let decryptionCancelled = false;
    const stateEl = document.getElementById("topology-state");
    if (stateEl && stateEl.textContent.trim()) {
     try {
      let stateText = stateEl.textContent.trim();
      if (isEncrypted(stateText)) {
       let decrypted = false;
       let attempts = 0;
       const maxAttempts = 3;
       while (!decrypted && attempts < maxAttempts) {
        const password = prompt("This file is encrypted. Enter password to decrypt:\n(Attempt " + (attempts + 1) + " of " + maxAttempts + ")", );
        if (!password) {
         alert("Decryption cancelled. The file will not be loaded.", );
         decryptionCancelled = true;
         break;
        }
        try {
         stateText = await decryptData(stateText, password);
         decrypted = true;
        } catch (e) {
         attempts++;
         if (attempts < maxAttempts) {
          alert("Incorrect password. Please try again.");
         } else {
          alert("Maximum attempts reached. The file will not be loaded.", );
          decryptionCancelled = true;
         }
        }
       }
       if (!decrypted) {
        stateText = "{}";
       }
      }
      initialState = JSON.parse(stateText);
     } catch (e) {
      console.error("Failed to load state:", e);
      initialState = {};
     }
    }
    if (decryptionCancelled) {
     NODE_DATA = {};
     EDGE_DATA = {
      list: []
     };
     EDGE_LEGEND = {};
     savedPositions = {};
     savedSizes = {};
     savedStyles = {};
    } else {
     NODE_DATA = initialState.nodeData ? initialState.nodeData : BASE_NODE_DATA;
     EDGE_DATA = initialState.edgeData ? initialState.edgeData : {
      list: [],
     };
     EDGE_LEGEND = initialState.edgeLegend || {};
     savedPositions = initialState.nodePositions || {};
     savedSizes = initialState.nodeSizes || {};
     savedStyles = initialState.nodeStyles || {};
     if (initialState.iconCache) {
      IconLibrary.iconCache = initialState.iconCache;
     }
    }
    if (initialState.page) {
     PAGE_STATE = Object.assign({}, DEFAULT_PAGE_STATE, initialState.page, );
    }
    if (initialState.canvas) {
     canvasState.zoom = initialState.canvas.zoom || 1;
     canvasState.panX = initialState.canvas.panX || 0;
     canvasState.panY = initialState.canvas.panY || 0;
    }
    wieldThePower();
    forgeTheTopology();
    updateViewBox();
    const initialNodes = Object.keys(NODE_DATA);
    if (initialNodes.length > 0) {
     claimTheImmortal(initialNodes.includes("host") ? "host" : initialNodes[0], );
    } else {
     document.getElementById("node-panel").style.display = "none";
     document.getElementById("topology-toolbar").style.display = "none";
    }
   })();

   function saveEdgeData() {}

   function saveEdgeLegend() {}

   function getBreakpointKey() {
    const w = window.innerWidth;
    if (w <= 380) return "fold";
    if (w <= 768) return "mobile";
    if (w <= 1024) return "tablet";
    return "desktop";
   }

   function resolveStylesEntry(styleEntry) {
    if (!styleEntry) return {};
    if (styleEntry.circleColor || styleEntry.titleColor || styleEntry.titleFont || styleEntry.titleSize || styleEntry.subColor || styleEntry.subFont || styleEntry.subSize) {
     return styleEntry;
    }
    const bp = getBreakpointKey();
    const base = styleEntry.all || {};
    const bpStyles = styleEntry[bp] || {};
    return Object.assign({}, base, bpStyles);
   }

   function resolveStylesForNode(id) {
    const styleEntry = savedStyles[id];
    if (!styleEntry) return {};
    return resolveStylesEntry(styleEntry);
   }

   function ensureStyleEntry(id) {
    if (!savedStyles[id]) savedStyles[id] = {};
    const entry = savedStyles[id];
    const flatProps = ["circleColor", "titleColor", "titleFont", "titleSize", "subColor", "subFont", "subSize", ];
    const isFlat = flatProps.some((p) => Object.prototype.hasOwnProperty.call(entry, p), );
    if (isFlat) {
     const all = entry.all || {};
     flatProps.forEach((p) => {
      if (entry[p] !== undefined) {
       all[p] = entry[p];
       delete entry[p];
      }
     });
     entry.all = all;
    }
    return entry;
   }

   function getDefaultSize() {
    if (window.innerWidth <= 380) return 120;
    if (window.innerWidth <= 768) return 140;
    if (window.innerWidth <= 1024) return 70;
    return 55;
   }

   function createShapeElement(shape, size) {
    const ns = "http://www.w3.org/2000/svg";
    if (shape === "circle") {
     const c = document.createElementNS(ns, "circle");
     c.setAttribute("r", size);
     return c;
    }
    if (shape === "square") {
     const r = document.createElementNS(ns, "rect");
     const s = size * 2;
     r.setAttribute("x", -size);
     r.setAttribute("y", -size);
     r.setAttribute("width", s);
     r.setAttribute("height", s);
     r.setAttribute("rx", 4);
     return r;
    }
    if (shape === "rectangle") {
     const r = document.createElementNS(ns, "rect");
     r.setAttribute("x", -size * 1.4);
     r.setAttribute("y", -size * 0.8);
     r.setAttribute("width", size * 2.8);
     r.setAttribute("height", size * 1.6);
     r.setAttribute("rx", 6);
     return r;
    }
    if (shape === "triangle") {
     const p = document.createElementNS(ns, "polygon");
     const h = size * 1.8;
     const w = size * 2;
     p.setAttribute("points", `0,${-h} ${w / 2},${h / 2} ${-w / 2},${h / 2}`, );
     return p;
    }
    if (shape === "hexagon") {
     const p = document.createElementNS(ns, "polygon");
     const s = size;
     const pts = [
      [0, -s],
      [s * 0.86, -s * 0.5],
      [s * 0.86, s * 0.5],
      [0, s],
      [-s * 0.86, s * 0.5],
      [-s * 0.86, -s * 0.5],
     ].map((pt) => pt.join(",")).join(" ");
     p.setAttribute("points", pts);
     return p;
    }
    if (shape === "stop-sign") {
     const p = document.createElementNS(ns, "polygon");
     const r = size;
     const ptsArr = [];
     for (let i = 0; i < 8; i++) {
      const a = (Math.PI / 4) * i + Math.PI / 8;
      ptsArr.push([Math.cos(a) * r, Math.sin(a) * r]);
     }
     const pts = ptsArr.map((pt) => pt.join(",")).join(" ");
     p.setAttribute("points", pts);
     return p;
    }
    if (shape === "star") {
     const p = document.createElementNS(ns, "polygon");
     const outer = size;
     const inner = size * 0.45;
     let pts = "";
     for (let i = 0; i < 10; i++) {
      const a = (Math.PI / 5) * i - Math.PI / 2;
      const r = i % 2 === 0 ? outer : inner;
      pts += `${Math.cos(a) * r},${Math.sin(a) * r} `;
     }
     p.setAttribute("points", pts.trim());
     return p;
    }
    if (shape === "diamond") {
     const p = document.createElementNS(ns, "polygon");
     const s = size;
     p.setAttribute("points", `0,${-s} ${s},0 0,${s} ${-s},0`);
     return p;
    }
    if (shape === "server") {
     const g = document.createElementNS(ns, "g");
     const body = document.createElementNS(ns, "rect");
     body.setAttribute("x", -size * 1.2);
     body.setAttribute("y", -size * 0.6);
     body.setAttribute("width", size * 2.4);
     body.setAttribute("height", size * 1.2);
     body.setAttribute("rx", 4);
     g.appendChild(body);
     for (let i = 0; i < 3; i++) {
      const line = document.createElementNS(ns, "line");
      line.setAttribute("x1", -size * 0.9 + i * size * 0.5);
      line.setAttribute("y1", -size * 0.3);
      line.setAttribute("x2", -size * 0.9 + i * size * 0.5);
      line.setAttribute("y2", size * 0.3);
      line.style.stroke = "currentColor";
      line.style.strokeWidth = "2";
      line.style.opacity = "0.5";
      g.appendChild(line);
     }
     const led = document.createElementNS(ns, "circle");
     led.setAttribute("cx", size * 0.9);
     led.setAttribute("cy", 0);
     led.setAttribute("r", size * 0.1);
     led.style.fill = "#4ade80";
     g.appendChild(led);
     return g;
    }
    if (shape === "pc" || shape === "desktop") {
     const g = document.createElementNS(ns, "g");
     const monitor = document.createElementNS(ns, "rect");
     monitor.setAttribute("x", -size * 0.9);
     monitor.setAttribute("y", -size * 0.8);
     monitor.setAttribute("width", size * 1.8);
     monitor.setAttribute("height", size * 1.2);
     monitor.setAttribute("rx", 4);
     g.appendChild(monitor);
     const screen = document.createElementNS(ns, "rect");
     screen.setAttribute("x", -size * 0.75);
     screen.setAttribute("y", -size * 0.65);
     screen.setAttribute("width", size * 1.5);
     screen.setAttribute("height", size * 0.9);
     screen.setAttribute("rx", 2);
     screen.style.fill = "#1e293b";
     g.appendChild(screen);
     const neck = document.createElementNS(ns, "rect");
     neck.setAttribute("x", -size * 0.15);
     neck.setAttribute("y", size * 0.4);
     neck.setAttribute("width", size * 0.3);
     neck.setAttribute("height", size * 0.3);
     g.appendChild(neck);
     const base = document.createElementNS(ns, "rect");
     base.setAttribute("x", -size * 0.5);
     base.setAttribute("y", size * 0.7);
     base.setAttribute("width", size * 1);
     base.setAttribute("height", size * 0.15);
     base.setAttribute("rx", 2);
     g.appendChild(base);
     return g;
    }
    if (shape === "laptop") {
     const g = document.createElementNS(ns, "g");
     const screen = document.createElementNS(ns, "rect");
     screen.setAttribute("x", -size * 0.8);
     screen.setAttribute("y", -size * 0.9);
     screen.setAttribute("width", size * 1.6);
     screen.setAttribute("height", size * 1.1);
     screen.setAttribute("rx", 4);
     g.appendChild(screen);
     const base = document.createElementNS(ns, "rect");
     base.setAttribute("x", -size * 0.9);
     base.setAttribute("y", size * 0.25);
     base.setAttribute("width", size * 1.8);
     base.setAttribute("height", size * 0.6);
     base.setAttribute("rx", 4);
     g.appendChild(base);
     const pad = document.createElementNS(ns, "rect");
     pad.setAttribute("x", -size * 0.25);
     pad.setAttribute("y", size * 0.45);
     pad.setAttribute("width", size * 0.5);
     pad.setAttribute("height", size * 0.25);
     pad.setAttribute("rx", 2);
     pad.style.fill = "#1e293b";
     g.appendChild(pad);
     return g;
    }
    if (shape === "phone" || shape === "mobile") {
     const g = document.createElementNS(ns, "g");
     const body = document.createElementNS(ns, "rect");
     body.setAttribute("x", -size * 0.45);
     body.setAttribute("y", -size);
     body.setAttribute("width", size * 0.9);
     body.setAttribute("height", size * 2);
     body.setAttribute("rx", 8);
     g.appendChild(body);
     const screen = document.createElementNS(ns, "rect");
     screen.setAttribute("x", -size * 0.38);
     screen.setAttribute("y", -size * 0.85);
     screen.setAttribute("width", size * 0.76);
     screen.setAttribute("height", size * 1.6);
     screen.setAttribute("rx", 4);
     screen.style.fill = "#1e293b";
     g.appendChild(screen);
     const btn = document.createElementNS(ns, "rect");
     btn.setAttribute("x", -size * 0.15);
     btn.setAttribute("y", size * 0.82);
     btn.setAttribute("width", size * 0.3);
     btn.setAttribute("height", size * 0.06);
     btn.setAttribute("rx", 2);
     btn.style.fill = "#475569";
     g.appendChild(btn);
     return g;
    }
    if (shape === "router") {
     const g = document.createElementNS(ns, "g");
     const body = document.createElementNS(ns, "rect");
     body.setAttribute("x", -size * 1.1);
     body.setAttribute("y", -size * 0.3);
     body.setAttribute("width", size * 2.2);
     body.setAttribute("height", size * 0.8);
     body.setAttribute("rx", 6);
     g.appendChild(body);
     for (let i = -1; i <= 1; i++) {
      const ant = document.createElementNS(ns, "rect");
      ant.setAttribute("x", i * size * 0.6 - size * 0.05);
      ant.setAttribute("y", -size * 0.9);
      ant.setAttribute("width", size * 0.1);
      ant.setAttribute("height", size * 0.6);
      ant.setAttribute("rx", 2);
      g.appendChild(ant);
      const tip = document.createElementNS(ns, "circle");
      tip.setAttribute("cx", i * size * 0.6);
      tip.setAttribute("cy", -size * 0.95);
      tip.setAttribute("r", size * 0.08);
      g.appendChild(tip);
     }
     for (let i = 0; i < 4; i++) {
      const led = document.createElementNS(ns, "circle");
      led.setAttribute("cx", -size * 0.7 + i * size * 0.35);
      led.setAttribute("cy", size * 0.1);
      led.setAttribute("r", size * 0.06);
      led.style.fill = i < 2 ? "#4ade80" : "#facc15";
      g.appendChild(led);
     }
     return g;
    }
    if (shape === "switch") {
     const g = document.createElementNS(ns, "g");
     const body = document.createElementNS(ns, "rect");
     body.setAttribute("x", -size * 1.4);
     body.setAttribute("y", -size * 0.4);
     body.setAttribute("width", size * 2.8);
     body.setAttribute("height", size * 0.8);
     body.setAttribute("rx", 4);
     g.appendChild(body);
     for (let i = 0; i < 8; i++) {
      const port = document.createElementNS(ns, "rect");
      port.setAttribute("x", -size * 1.2 + i * size * 0.32);
      port.setAttribute("y", -size * 0.15);
      port.setAttribute("width", size * 0.22);
      port.setAttribute("height", size * 0.3);
      port.setAttribute("rx", 1);
      port.style.fill = "#1e293b";
      g.appendChild(port);
     }
     return g;
    }
    if (shape === "firewall") {
     const g = document.createElementNS(ns, "g");
     const wall = document.createElementNS(ns, "rect");
     wall.setAttribute("x", -size);
     wall.setAttribute("y", -size * 0.8);
     wall.setAttribute("width", size * 2);
     wall.setAttribute("height", size * 1.6);
     wall.setAttribute("rx", 4);
     g.appendChild(wall);
     for (let row = 0; row < 3; row++) {
      const line = document.createElementNS(ns, "line");
      line.setAttribute("x1", -size * 0.85);
      line.setAttribute("y1", -size * 0.5 + row * size * 0.45);
      line.setAttribute("x2", size * 0.85);
      line.setAttribute("y2", -size * 0.5 + row * size * 0.45);
      line.style.stroke = "#475569";
      line.style.strokeWidth = "2";
      g.appendChild(line);
     }
     for (let row = 0; row < 4; row++) {
      const offset = row % 2 === 0 ? 0 : size * 0.35;
      for (let col = 0; col < 3; col++) {
       const line = document.createElementNS(ns, "line");
       const x = -size * 0.5 + col * size * 0.7 + offset;
       if (x > -size * 0.85 && x < size * 0.85) {
        line.setAttribute("x1", x);
        line.setAttribute("y1", -size * 0.8 + row * size * 0.45, );
        line.setAttribute("x2", x);
        line.setAttribute("y2", -size * 0.8 + row * size * 0.45 + size * 0.45, );
        line.style.stroke = "#475569";
        line.style.strokeWidth = "2";
        g.appendChild(line);
       }
      }
     }
     return g;
    }
    if (shape === "cloud") {
     const p = document.createElementNS(ns, "path");
     const s = size;
     p.setAttribute("d", `
          M ${-s * 0.8} ${s * 0.2}
          Q ${-s * 1.1} ${s * 0.2} ${-s * 1.1} ${-s * 0.1}
          Q ${-s * 1.1} ${-s * 0.5} ${-s * 0.7} ${-s * 0.5}
          Q ${-s * 0.7} ${-s * 0.9} ${-s * 0.2} ${-s * 0.9}
          Q ${s * 0.1} ${-s * 1.1} ${s * 0.5} ${-s * 0.8}
          Q ${s * 1} ${-s * 0.8} ${s * 1.1} ${-s * 0.3}
          Q ${s * 1.3} ${-s * 0.1} ${s * 1.1} ${s * 0.2}
          Q ${s * 1.1} ${s * 0.5} ${s * 0.7} ${s * 0.5}
          L ${-s * 0.5} ${s * 0.5}
          Q ${-s * 0.9} ${s * 0.5} ${-s * 0.9} ${s * 0.2}
          Z
         `, );
     return p;
    }
    if (shape === "database") {
     const g = document.createElementNS(ns, "g");
     const body = document.createElementNS(ns, "rect");
     body.setAttribute("x", -size * 0.7);
     body.setAttribute("y", -size * 0.6);
     body.setAttribute("width", size * 1.4);
     body.setAttribute("height", size * 1.4);
     g.appendChild(body);
     const top = document.createElementNS(ns, "ellipse");
     top.setAttribute("cx", 0);
     top.setAttribute("cy", -size * 0.6);
     top.setAttribute("rx", size * 0.7);
     top.setAttribute("ry", size * 0.25);
     g.appendChild(top);
     const bottom = document.createElementNS(ns, "ellipse");
     bottom.setAttribute("cx", 0);
     bottom.setAttribute("cy", size * 0.8);
     bottom.setAttribute("rx", size * 0.7);
     bottom.setAttribute("ry", size * 0.25);
     g.appendChild(bottom);
     const mid1 = document.createElementNS(ns, "ellipse");
     mid1.setAttribute("cx", 0);
     mid1.setAttribute("cy", -size * 0.15);
     mid1.setAttribute("rx", size * 0.7);
     mid1.setAttribute("ry", size * 0.2);
     mid1.style.fill = "none";
     mid1.style.stroke = "#475569";
     mid1.style.strokeWidth = "2";
     g.appendChild(mid1);
     const mid2 = document.createElementNS(ns, "ellipse");
     mid2.setAttribute("cx", 0);
     mid2.setAttribute("cy", size * 0.35);
     mid2.setAttribute("rx", size * 0.7);
     mid2.setAttribute("ry", size * 0.2);
     mid2.style.fill = "none";
     mid2.style.stroke = "#475569";
     mid2.style.strokeWidth = "2";
     g.appendChild(mid2);
     return g;
    }
    if (shape === "printer") {
     const g = document.createElementNS(ns, "g");
     const body = document.createElementNS(ns, "rect");
     body.setAttribute("x", -size);
     body.setAttribute("y", -size * 0.4);
     body.setAttribute("width", size * 2);
     body.setAttribute("height", size * 0.9);
     body.setAttribute("rx", 4);
     g.appendChild(body);
     const trayTop = document.createElementNS(ns, "rect");
     trayTop.setAttribute("x", -size * 0.7);
     trayTop.setAttribute("y", -size * 0.8);
     trayTop.setAttribute("width", size * 1.4);
     trayTop.setAttribute("height", size * 0.4);
     trayTop.setAttribute("rx", 2);
     trayTop.style.fill = "#1e293b";
     g.appendChild(trayTop);
     const trayOut = document.createElementNS(ns, "rect");
     trayOut.setAttribute("x", -size * 0.6);
     trayOut.setAttribute("y", size * 0.5);
     trayOut.setAttribute("width", size * 1.2);
     trayOut.setAttribute("height", size * 0.35);
     trayOut.setAttribute("rx", 2);
     g.appendChild(trayOut);
     const paper = document.createElementNS(ns, "rect");
     paper.setAttribute("x", -size * 0.5);
     paper.setAttribute("y", size * 0.3);
     paper.setAttribute("width", size * 1);
     paper.setAttribute("height", size * 0.5);
     paper.style.fill = "#e2e8f0";
     g.appendChild(paper);
     return g;
    }
    const c = document.createElementNS(ns, "circle");
    c.setAttribute("r", size);
    return c;
   }

   function createNodeShape(id, size) {
    const styles = resolveStylesForNode(id);
	
    if (styles.icon && styles.icon.library && styles.icon.name) {
     const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
     g.classList.add("node-circle");
     
     IconLibrary.getIcon(styles.icon.library, styles.icon.name).then(svgText => {
      if (svgText) {
       const parser = new DOMParser();
       const doc = parser.parseFromString(svgText, 'image/svg+xml');
       const svgEl = doc.querySelector('svg');
       if (svgEl) {
        svgEl.setAttribute('width', size * 1.2);
        svgEl.setAttribute('height', size * 1.2);
        svgEl.setAttribute('x', -size * 0.6);
        svgEl.setAttribute('y', -size * 0.6);
        if (styles.circleColor) {
         svgEl.style.fill = styles.circleColor;
        }
        g.innerHTML = svgEl.outerHTML;
       }
      }
     });
     
     return g;
    }

    const shapeType = (NODE_DATA[id] && NODE_DATA[id].shape) || "circle";
    const shapeEl = createShapeElement(shapeType, size);
    shapeEl.classList.add("node-circle");
    if (styles.circleColor) {
     shapeEl.style.stroke = styles.circleColor;
    }
    return shapeEl;
   }

   function forgeTheLegend() {
    const container = document.getElementById("edge-legend");
    if (!container) return;
    container.innerHTML = "";
    const title = document.createElement("div");
    title.className = "legend-title";
    title.textContent = "Line Legend";
    container.appendChild(title);
    const closeBtn = document.createElement("button");
    closeBtn.type = "button";
    closeBtn.className = "legend-close-btn";
    closeBtn.textContent = "‚úï";
    closeBtn.addEventListener("click", (e) => {
     e.stopPropagation();
     legendCollapsed = true;
     updateLegendVisibility();
    });
    container.appendChild(closeBtn);
    const colors = [...new Set(EDGE_DATA.list.map((e) => e.color).filter(Boolean))];
    if (colors.length === 0) {
     updateLegendVisibility();
     return;
    }
    colors.forEach((color) => {
     if (!EDGE_LEGEND[color]) {
      EDGE_LEGEND[color] = "you can edit me too";
     }
     const item = document.createElement("div");
     item.className = "legend-item";
     item.addEventListener("mousedown", (e) => e.stopPropagation());
     item.addEventListener("click", (e) => e.stopPropagation());
     const swatch = document.createElement("span");
     swatch.className = "legend-swatch";
     swatch.style.backgroundColor = color;
     const label = document.createElement("span");
     label.className = "legend-label";
     label.textContent = EDGE_LEGEND[color];
     label.contentEditable = true;
     label.addEventListener("mousedown", (e) => e.stopPropagation());
     label.addEventListener("click", (e) => e.stopPropagation());
     label.addEventListener("touchstart", (e) => e.stopPropagation());
     label.addEventListener("focus", () => {
      label.classList.add("editing");
     });
     label.addEventListener("blur", () => {
      label.classList.remove("editing");
      const text = label.textContent.trim() || "you can edit me too";
      EDGE_LEGEND[color] = text;
      saveEdgeLegend();
     });
     label.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
       e.preventDefault();
       label.blur();
      }
     });
     item.append(swatch, label);
     container.appendChild(item);
    });
    updateLegendVisibility();
   }

   function forgeTheTopology() {
    if (!NODE_DATA || !EDGE_DATA) {
     console.warn("forgeTheTopology called before data initialized");
     return;
    }
    const svg = document.getElementById("map");
    svg.innerHTML = "";
    const ns = "http://www.w3.org/2000/svg";
    const defs = document.createElementNS(ns, "defs");
    const markerForward = document.createElementNS(ns, "marker");
    markerForward.id = "arrow-forward";
    markerForward.setAttribute("markerWidth", "10");
    markerForward.setAttribute("markerHeight", "10");
    markerForward.setAttribute("refX", "9");
    markerForward.setAttribute("refY", "3");
    markerForward.setAttribute("orient", "auto");
    markerForward.setAttribute("markerUnits", "strokeWidth");
    const pathForward = document.createElementNS(ns, "path");
    pathForward.setAttribute("d", "M0,0 L0,6 L9,3 z");
    pathForward.setAttribute("fill", "context-stroke");
    markerForward.appendChild(pathForward);
    defs.appendChild(markerForward);
    const markerBackward = document.createElementNS(ns, "marker");
    markerBackward.id = "arrow-backward";
    markerBackward.setAttribute("markerWidth", "10");
    markerBackward.setAttribute("markerHeight", "10");
    markerBackward.setAttribute("refX", "0");
    markerBackward.setAttribute("refY", "3");
    markerBackward.setAttribute("orient", "auto");
    markerBackward.setAttribute("markerUnits", "strokeWidth");
    const pathBackward = document.createElementNS(ns, "path");
    pathBackward.setAttribute("d", "M9,0 L9,6 L0,3 z");
    pathBackward.setAttribute("fill", "context-stroke");
    markerBackward.appendChild(pathBackward);
    defs.appendChild(markerBackward);
    svg.appendChild(defs);
    const boundary = document.createElementNS(ns, "rect");
    boundary.setAttribute("x", CANVAS_PADDING);
    boundary.setAttribute("y", CANVAS_PADDING);
    boundary.setAttribute("width", CANVAS_WIDTH - CANVAS_PADDING * 2);
    boundary.setAttribute("height", CANVAS_HEIGHT - CANVAS_PADDING * 2);
    boundary.setAttribute("fill", "none");
    boundary.setAttribute("stroke", "rgba(71, 85, 105, 0.3)");
    boundary.setAttribute("stroke-width", "2");
    boundary.setAttribute("stroke-dasharray", "10 5");
    boundary.setAttribute("rx", "8");
    svg.appendChild(boundary);
    const centerX = CANVAS_WIDTH / 2;
    const centerY = CANVAS_HEIGHT / 2;
    let positions = {};
    Object.keys(NODE_DATA).forEach((id) => {
     positions[id] = savedPositions[id] || {
      x: centerX,
      y: centerY
     };
    });
    if (Object.keys(savedPositions).length === 0) {
     const nodeIds = Object.keys(NODE_DATA);
     const baseY = centerY - 300;
     if (nodeIds.length > 0) {
      positions[nodeIds[0]] = {
       x: centerX,
       y: baseY
      };
      const remaining = nodeIds.slice(1);
      const radius = 350;
      const startAngle = Math.PI * 0.3;
      const endAngle = Math.PI * 0.7;
      remaining.forEach((id, i) => {
       const angle = startAngle + (endAngle - startAngle) * (i / Math.max(1, remaining.length - 1));
       positions[id] = {
        x: centerX + Math.cos(angle) * radius * (i % 2 === 0 ? 1 : 1.3),
        y: baseY + 200 + Math.sin(angle) * radius * 0.8 + i * 80,
       };
      });
     }
    }
    Object.keys(positions).forEach((id) => {
     let pos = savedPositions[id] || positions[id];
     const nodeSize = savedSizes[id] || 55;
     pos.x = Math.max(nodeSize + CANVAS_PADDING, Math.min(CANVAS_WIDTH - nodeSize - CANVAS_PADDING, pos.x), );
     pos.y = Math.max(nodeSize + CANVAS_PADDING, Math.min(CANVAS_HEIGHT - nodeSize - CANVAS_PADDING, pos.y), );
     positions[id] = {
      x: pos.x,
      y: pos.y
     };
     savedPositions[id] = {
      x: pos.x,
      y: pos.y
     };
    });
    const edgePairCount = {};
    const edgePairIndex = {};
    EDGE_DATA.list.forEach((edge) => {
     if (edge.type === "custom") return;
     const key = [edge.from, edge.to].sort().join("||");
     edgePairCount[key] = (edgePairCount[key] || 0) + 1;
    });
    EDGE_DATA.list.forEach((edge) => {
     if (edge.type === "custom") return;
     const key = [edge.from, edge.to].sort().join("||");
     if (!edgePairIndex[key]) edgePairIndex[key] = 0;
     edge._pairIndex = edgePairIndex[key];
     edge._pairTotal = edgePairCount[key];
     edgePairIndex[key]++;
    });
    EDGE_DATA.list.forEach((edge) => {
     if (edge.type === "custom" && Array.isArray(edge.points) && edge.points.length >= 2) {
      const poly = document.createElementNS(ns, "polyline");
      poly.classList.add("edge");
      poly.dataset.edgeId = edge.id;
      poly.style.stroke = edge.color || "#475569";
      poly.style.strokeWidth = edge.width || 4;
      poly.setAttribute("fill", "none");
      const lineStyle = edge.lineStyle || "solid";
      if (lineStyle === "dashed") {
       poly.style.strokeDasharray = "10,5";
      } else if (lineStyle === "dotted") {
       poly.style.strokeDasharray = "2,4";
      } else {
       poly.style.strokeDasharray = "none";
      }
      const direction = edge.direction || "none";
      if (direction === "forward") {
       poly.setAttribute("marker-end", "url(#arrow-forward)");
      } else if (direction === "backward") {
       poly.setAttribute("marker-start", "url(#arrow-backward)");
      } else if (direction === "both") {
       poly.setAttribute("marker-start", "url(#arrow-backward)");
       poly.setAttribute("marker-end", "url(#arrow-forward)");
      }
      const ptsStr = edge.points.map((p) => `${p.x},${p.y}`).join(" ");
      poly.setAttribute("points", ptsStr);
      poly.addEventListener("click", (e) => {
       e.stopPropagation();
       selectTheConnection(edge.id);
      });
      svg.appendChild(poly);
      return;
     }
     const p1 = positions[edge.from];
     const p2 = positions[edge.to];
     if (!p1 || !p2) return;
     const pairTotal = edge._pairTotal || 1;
     const pairIndex = edge._pairIndex || 0;
     const midX = (p1.x + p2.x) / 2;
     const midY = (p1.y + p2.y) / 2;
     const dx = p2.x - p1.x;
     const dy = p2.y - p1.y;
     const len = Math.sqrt(dx * dx + dy * dy) || 1;
     const perpX = -dy / len;
     const perpY = dx / len;
     let offsetAmount = 0;
     if (pairTotal > 1) {
      offsetAmount = (pairIndex - (pairTotal - 1) / 2) * 40;
     }
     const ctrlX = midX + perpX * offsetAmount;
     const ctrlY = midY + perpY * offsetAmount;
     const path = document.createElementNS(ns, "path");
     path.setAttribute("d", `M ${p1.x} ${p1.y} Q ${ctrlX} ${ctrlY} ${p2.x} ${p2.y}`, );
     path.setAttribute("fill", "none");
     path.classList.add("edge");
     if (edge.type === "backup") path.classList.add("backup");
     path.dataset.edgeId = edge.id;
     path.dataset.from = edge.from;
     path.dataset.to = edge.to;
     path.style.stroke = edge.color;
     path.style.strokeWidth = edge.width;
     path.addEventListener("click", (e) => {
      e.stopPropagation();
      selectTheConnection(edge.id);
     });
     svg.appendChild(path);
    });
    Object.entries(positions).forEach(([id, pos]) => {
     const g = document.createElementNS("http://www.w3.org/2000/svg", "g", );
     g.classList.add("node-group");
     g.dataset.nodeId = id;
     g.setAttribute("transform", `translate(${pos.x},${pos.y})`);
     let r = savedSizes[id] || 55;
     if (!savedSizes[id]) {
      if (window.innerWidth <= 380) r = 120;
      else if (window.innerWidth <= 768) r = 140;
      else if (window.innerWidth <= 1024) r = 70;
     }
     const styles = resolveStylesForNode(id);
     
     // Create invisible larger hit area for easier dragging (50% larger than visual size)
     const ns = "http://www.w3.org/2000/svg";
     const hitArea = document.createElementNS(ns, "circle");
     hitArea.setAttribute("r", r * 1.5);
     hitArea.style.fill = "transparent";
     hitArea.style.stroke = "none";
     hitArea.style.cursor = "grab";
     hitArea.classList.add("node-hit-area");
     
     const shapeEl = createNodeShape(id, r);
     const titleOffsetX = styles.titleOffsetX || 0;
     const titleOffsetY = styles.titleOffsetY || 0;
     const subOffsetX = styles.subOffsetX || 0;
     const subOffsetY = styles.subOffsetY || 0;
     const label = document.createElementNS("http://www.w3.org/2000/svg", "text", );
     label.classList.add("node-label");
     label.setAttribute("x", titleOffsetX);
     label.setAttribute("y", -r * 0.28 + titleOffsetY);
     const labelFontSize = styles.titleSize || r * 0.33;
     label.style.fontSize = labelFontSize + "px";
     label.textContent = NODE_DATA[id].name;
     if (styles.titleColor) label.style.fill = styles.titleColor;
     if (styles.titleFont) label.style.fontFamily = styles.titleFont;
     label.style.cursor = "pointer";
     label.addEventListener("dblclick", (e) => {
      e.stopPropagation();
      editNodeName(id);
     });
     
     // Touch support for mobile editing
     let labelTouchStart = null;
     label.addEventListener("touchstart", (e) => {
      labelTouchStart = Date.now();
     }, { passive: true });
     
     label.addEventListener("touchend", (e) => {
      if (labelTouchStart && Date.now() - labelTouchStart < 200) {
       // Quick tap detected (less than 200ms)
       e.stopPropagation();
       e.preventDefault();
       editNodeName(id);
      }
      labelTouchStart = null;
     });
     const sub = document.createElementNS("http://www.w3.org/2000/svg", "text", );
     sub.classList.add("node-sub");
     sub.setAttribute("x", subOffsetX);
     sub.setAttribute("y", r * 0.4 + subOffsetY);
     const subFontSize = styles.subSize || r * 0.24;
     sub.style.fontSize = subFontSize + "px";
     sub.textContent = NODE_DATA[id].ip;
     if (styles.subColor) sub.style.fill = styles.subColor;
     if (styles.subFont) sub.style.fontFamily = styles.subFont;
     sub.style.cursor = "pointer";
     sub.addEventListener("dblclick", (e) => {
      e.stopPropagation();
      editNodeIp(id);
     });
     
     // Touch support for mobile editing
     let subTouchStart = null;
     sub.addEventListener("touchstart", (e) => {
      subTouchStart = Date.now();
     }, { passive: true });
     
     sub.addEventListener("touchend", (e) => {
      if (subTouchStart && Date.now() - subTouchStart < 200) {
       // Quick tap detected (less than 200ms)
       e.stopPropagation();
       e.preventDefault();
       editNodeIp(id);
      }
      subTouchStart = null;
     });
     g.append(hitArea, shapeEl, label, sub);
     let isDragging = false;
     let startX, startY;
     g.addEventListener("mousedown", (e) => {
      e.preventDefault();
      isDragging = true;
      const svgEl = document.getElementById("map");
      const pt = svgEl.createSVGPoint();
      pt.x = e.clientX;
      pt.y = e.clientY;
      const svgP = pt.matrixTransform(svgEl.getScreenCTM().inverse(), );
      startX = svgP.x - pos.x;
      startY = svgP.y - pos.y;
      g.style.cursor = "grabbing";
      hitArea.style.cursor = "grabbing";
      e.stopPropagation();
     });
     const handleMouseMove = (e) => {
      if (!isDragging) return;
      e.preventDefault();
      const svgEl = document.getElementById("map");
      const pt = svgEl.createSVGPoint();
      pt.x = e.clientX;
      pt.y = e.clientY;
      const svgP = pt.matrixTransform(svgEl.getScreenCTM().inverse(), );
      let newX = svgP.x - startX;
      let newY = svgP.y - startY;
      const nodeSize = savedSizes[id] || 55;
      newX = Math.max(nodeSize + CANVAS_PADDING, Math.min(CANVAS_WIDTH - nodeSize - CANVAS_PADDING, newX), );
      newY = Math.max(nodeSize + CANVAS_PADDING, Math.min(CANVAS_HEIGHT - nodeSize - CANVAS_PADDING, newY), );
      pos.x = newX;
      pos.y = newY;
      g.setAttribute("transform", `translate(${pos.x},${pos.y})`);
      positions[id] = {
       x: pos.x,
       y: pos.y
      };
      savedPositions[id] = {
       x: pos.x,
       y: pos.y
      };
      updateMinimap();
      document.querySelectorAll(".edge").forEach((edgeEl) => {
       const fromId = edgeEl.dataset.from;
       const toId = edgeEl.dataset.to;
       if (fromId === id || toId === id) {
        const p1 = savedPositions[fromId] || positions[fromId] || {
         x: 600,
         y: 350
        };
        const p2 = savedPositions[toId] || positions[toId] || {
         x: 600,
         y: 350
        };
        if (edgeEl.tagName === "line") {
         edgeEl.setAttribute("x1", p1.x);
         edgeEl.setAttribute("y1", p1.y);
         edgeEl.setAttribute("x2", p2.x);
         edgeEl.setAttribute("y2", p2.y);
        } else if (edgeEl.tagName === "path") {
         const edgeId = edgeEl.dataset.edgeId;
         const edge = EDGE_DATA.list.find(
          (e) => e.id === edgeId, );
         if (edge) {
          const pairTotal = edge._pairTotal || 1;
          const pairIndex = edge._pairIndex || 0;
          const midX = (p1.x + p2.x) / 2;
          const midY = (p1.y + p2.y) / 2;
          const dx = p2.x - p1.x;
          const dy = p2.y - p1.y;
          const len = Math.sqrt(dx * dx + dy * dy) || 1;
          const perpX = -dy / len;
          const perpY = dx / len;
          let offsetAmount = 0;
          if (pairTotal > 1) {
           offsetAmount = (pairIndex - (pairTotal - 1) / 2) * 40;
          }
          const ctrlX = midX + perpX * offsetAmount;
          const ctrlY = midY + perpY * offsetAmount;
          edgeEl.setAttribute("d", `M ${p1.x} ${p1.y} Q ${ctrlX} ${ctrlY} ${p2.x} ${p2.y}`, );
         }
        }
       }
      });
     };
     const handleMouseUp = () => {
      if (isDragging) {
       isDragging = false;
       g.style.cursor = "grab";
       hitArea.style.cursor = "grab";
       savedPositions[id] = {
        x: pos.x,
        y: pos.y
       };
      }
     };
     document.addEventListener("mousemove", handleMouseMove);
     document.addEventListener("mouseup", handleMouseUp);
     g.addEventListener("touchstart",
      (e) => {
       e.preventDefault();
       isDragging = true;
       const svgEl = document.getElementById("map");
       const pt = svgEl.createSVGPoint();
       const touch = e.touches[0];
       pt.x = touch.clientX;
       pt.y = touch.clientY;
       const svgP = pt.matrixTransform(svgEl.getScreenCTM().inverse(), );
       startX = svgP.x - pos.x;
       startY = svgP.y - pos.y;
       e.stopPropagation();
      }, {
       passive: false
      }, );
     const handleTouchMove = (e) => {
      if (!isDragging) return;
      e.preventDefault();
      const svgEl = document.getElementById("map");
      const pt = svgEl.createSVGPoint();
      const touch = e.touches[0];
      pt.x = touch.clientX;
      pt.y = touch.clientY;
      const svgP = pt.matrixTransform(svgEl.getScreenCTM().inverse(), );
      let newX = svgP.x - startX;
      let newY = svgP.y - startY;
      const nodeSize = savedSizes[id] || 55;
      newX = Math.max(nodeSize + CANVAS_PADDING, Math.min(CANVAS_WIDTH - nodeSize - CANVAS_PADDING, newX), );
      newY = Math.max(nodeSize + CANVAS_PADDING, Math.min(CANVAS_HEIGHT - nodeSize - CANVAS_PADDING, newY), );
      pos.x = newX;
      pos.y = newY;
      g.setAttribute("transform", `translate(${pos.x},${pos.y})`);
      positions[id] = {
       x: pos.x,
       y: pos.y
      };
      savedPositions[id] = {
       x: pos.x,
       y: pos.y
      };
      updateMinimap();
      document.querySelectorAll(".edge").forEach((edgeEl) => {
       const fromId = edgeEl.dataset.from;
       const toId = edgeEl.dataset.to;
       if (fromId === id || toId === id) {
        const p1 = savedPositions[fromId] || positions[fromId] || {
         x: 600,
         y: 350
        };
        const p2 = savedPositions[toId] || positions[toId] || {
         x: 600,
         y: 350
        };
        if (edgeEl.tagName === "line") {
         edgeEl.setAttribute("x1", p1.x);
         edgeEl.setAttribute("y1", p1.y);
         edgeEl.setAttribute("x2", p2.x);
         edgeEl.setAttribute("y2", p2.y);
        } else if (edgeEl.tagName === "path") {
         const edgeId = edgeEl.dataset.edgeId;
         const edge = EDGE_DATA.list.find(
          (e) => e.id === edgeId, );
         if (edge) {
          const pairTotal = edge._pairTotal || 1;
          const pairIndex = edge._pairIndex || 0;
          const midX = (p1.x + p2.x) / 2;
          const midY = (p1.y + p2.y) / 2;
          const dx = p2.x - p1.x;
          const dy = p2.y - p1.y;
          const len = Math.sqrt(dx * dx + dy * dy) || 1;
          const perpX = -dy / len;
          const perpY = dx / len;
          let offsetAmount = 0;
          if (pairTotal > 1) {
           offsetAmount = (pairIndex - (pairTotal - 1) / 2) * 40;
          }
          const ctrlX = midX + perpX * offsetAmount;
          const ctrlY = midY + perpY * offsetAmount;
          edgeEl.setAttribute("d", `M ${p1.x} ${p1.y} Q ${ctrlX} ${ctrlY} ${p2.x} ${p2.y}`, );
         }
        }
       }
      });
     };
     const handleTouchEnd = () => {
      if (isDragging) {
       isDragging = false;
       savedPositions[id] = {
        x: pos.x,
        y: pos.y
       };
      }
     };
     document.addEventListener("touchmove", handleTouchMove, {
      passive: false,
     });
     document.addEventListener("touchend", handleTouchEnd);
     g.style.cursor = "grab";
     g.addEventListener("click", (e) => {
      if (!isDragging) {
       claimTheImmortal(id);
      }
     });
     svg.appendChild(g);
    });
    forgeTheLegend();
    updateMinimap();
   }

   function showEditModal(title, currentValue, onSave) {
    const modal = document.getElementById("edit-modal");
    const input = document.getElementById("modal-input");
    const titleEl = document.getElementById("modal-title");
    const saveBtn = document.getElementById("modal-save");
    const cancelBtn = document.getElementById("modal-cancel");
    titleEl.textContent = title;
    input.value = currentValue;
    modal.classList.add("active");
    input.focus();
    input.select();
    const handleSave = () => {
     if (input.value.trim()) {
      onSave(input.value.trim());
     }
     modal.classList.remove("active");
     saveBtn.removeEventListener("click", handleSave);
     cancelBtn.removeEventListener("click", handleCancel);
     input.removeEventListener("keypress", handleEnter);
    };
    const handleCancel = () => {
     modal.classList.remove("active");
     saveBtn.removeEventListener("click", handleSave);
     cancelBtn.removeEventListener("click", handleCancel);
     input.removeEventListener("keypress", handleEnter);
    };
    const handleEnter = (e) => {
     if (e.key === "Enter") handleSave();
    };
    saveBtn.addEventListener("click", handleSave);
    cancelBtn.addEventListener("click", handleCancel);
    input.addEventListener("keypress", handleEnter);
    modal.addEventListener("click", function bgHandler(e) {
     if (e.target === modal) {
      handleCancel();
      modal.removeEventListener("click", bgHandler);
     }
    });
   }

   function challengeTheImmortal(message, onConfirm) {
    const modal = document.getElementById("confirm-modal");
    const messageEl = document.getElementById("confirm-message");
    const deleteBtn = document.getElementById("confirm-delete");
    const cancelBtn = document.getElementById("confirm-cancel");
    messageEl.textContent = message;
    modal.classList.add("active");
    const handleConfirm = () => {
     onConfirm();
     modal.classList.remove("active");
     deleteBtn.removeEventListener("click", handleConfirm);
     cancelBtn.removeEventListener("click", handleCancel);
    };
    const handleCancel = () => {
     modal.classList.remove("active");
     deleteBtn.removeEventListener("click", handleConfirm);
     cancelBtn.removeEventListener("click", handleCancel);
    };
    deleteBtn.addEventListener("click", handleConfirm);
    cancelBtn.addEventListener("click", handleCancel);
    modal.addEventListener("click", function bgHandler(e) {
     if (e.target === modal) {
      handleCancel();
      modal.removeEventListener("click", bgHandler);
     }
    });
   }
   const pageTitleEl = document.getElementById("page-title");
   if (pageTitleEl) {
    pageTitleEl.addEventListener("click", () => {
     showEditModal("Edit Title", PAGE_STATE.title || DEFAULT_PAGE_STATE.title,
      (newTitle) => {
       PAGE_STATE.title = newTitle;
       wieldThePower();
      }, );
    });
   }

   function editNodeName(id) {
    showEditModal("Edit Name", NODE_DATA[id].name, (newName) => {
     NODE_DATA[id].name = newName;
     const nodeGroup = document.querySelector(`g[data-node-id="${id}"]`, );
     if (nodeGroup) {
      const label = nodeGroup.querySelector(".node-label");
      if (label) label.textContent = newName;
     }
     if (currentNodeId === id) {
      document.getElementById("node-name").textContent = newName;
     }
    });
   }

   function editNodeIp(id) {
    showEditModal("Edit IP/Subtitle", NODE_DATA[id].ip, (newIp) => {
     NODE_DATA[id].ip = newIp;
     const nodeGroup = document.querySelector(`g[data-node-id="${id}"]`, );
     if (nodeGroup) {
      const sub = nodeGroup.querySelector(".node-sub");
      if (sub) sub.textContent = newIp;
     }
     if (currentNodeId === id) {
      document.getElementById("node-ip").textContent = newIp;
     }
    });
   }

   function claimTheImmortal(id) {
    currentNodeId = id;
    currentEdgeId = null;
    const data = NODE_DATA[id];
    document.querySelectorAll(".node-group").forEach((n) => {
     n.classList.toggle("active", n.dataset.nodeId === id);
    });
    document.querySelectorAll(".edge").forEach((e) => {
     const active = e.dataset.from === id || e.dataset.to === id;
     e.classList.toggle("active", active);
    });
    document.getElementById("node-panel").style.display = "block";
    document.getElementById("edge-panel").style.display = "none";
    const toolbar = document.getElementById("topology-toolbar");
    if (!topologyToolbarCollapsed) {
     toolbar.style.display = "flex";
    }
    updateTopologyToolbarVisibility();
    document.getElementById("node-name").textContent = data.name;
    document.getElementById("node-ip").textContent = data.ip;
    document.getElementById("node-role").textContent = data.role;
    document.getElementById("node-name").onclick = () => editNodeName(id);
    document.getElementById("node-ip").onclick = () => editNodeIp(id);
    const currentSize = savedSizes[id] || getDefaultSize();
    document.getElementById("size-slider").value = currentSize;
    document.getElementById("size-value").textContent = currentSize;
    const styleEntry = savedStyles[id] || {};
    const resolvedStyles = resolveStylesEntry(styleEntry);
    const scopeKey = currentStyleScope || "all";
    const flatProps = ["circleColor", "titleColor", "titleFont", "titleSize", "subColor", "subFont", "subSize", ];
    const isFlat = flatProps.some((p) => Object.prototype.hasOwnProperty.call(styleEntry, p), );
    const scopedStyles = isFlat ? styleEntry : styleEntry[scopeKey] || {};
    const circleColorInput = document.getElementById("circle-color");
    const titleColorInput = document.getElementById("title-color");
    const titleFontSelect = document.getElementById("title-font");
    const titleSizeInput = document.getElementById("title-size");
    const subColorInput = document.getElementById("sub-color");
    const subFontSelect = document.getElementById("sub-font");
    const subSizeInput = document.getElementById("sub-size");
    const shapeSelect = document.getElementById("shape-select");
    const scopeSelect = document.getElementById("style-scope");
    circleColorInput.value = scopedStyles.circleColor || resolvedStyles.circleColor || "#1e293b";
    titleColorInput.value = scopedStyles.titleColor || resolvedStyles.titleColor || "#e2e8f0";
    titleFontSelect.value = scopedStyles.titleFont || resolvedStyles.titleFont || "system-ui, sans-serif";
    titleSizeInput.value = scopedStyles.titleSize || resolvedStyles.titleSize || 18;
    subColorInput.value = scopedStyles.subColor || resolvedStyles.subColor || "#94a3b8";
    subFontSelect.value = scopedStyles.subFont || resolvedStyles.subFont || "system-ui, sans-serif";
    subSizeInput.value = scopedStyles.subSize || resolvedStyles.subSize || 13;
    shapeSelect.value = data.shape || "circle";
    scopeSelect.value = currentStyleScope || "all";
    document.getElementById("title-offset-y").value = scopedStyles.titleOffsetY || resolvedStyles.titleOffsetY || 0;
    document.getElementById("title-offset-x").value = scopedStyles.titleOffsetX || resolvedStyles.titleOffsetX || 0;
    document.getElementById("sub-offset-y").value = scopedStyles.subOffsetY || resolvedStyles.subOffsetY || 0;
    document.getElementById("sub-offset-x").value = scopedStyles.subOffsetX || resolvedStyles.subOffsetX || 0;
    const tagEl = document.getElementById("node-tags");
    tagEl.innerHTML = "";
    data.tags.forEach((tag, i) => {
     const b = document.createElement("span");
     b.className = "badge";
    
     const isIconTag = typeof tag === 'object' && tag.type === 'icon';
     
     if (!isIconTag && typeof tag === 'string' && tag.toLowerCase().includes("wg")) b.classList.add("wg");
     b.style.cursor = "pointer";
     b.style.position = "relative";
     
     const tagContent = document.createElement("span");
     
     if (isIconTag) {
      b.classList.add("icon-badge");
      IconLibrary.getIcon(tag.library, tag.name).then(svgText => {
       if (svgText) {
        const parser = new DOMParser();
        const doc = parser.parseFromString(svgText, 'image/svg+xml');
        const svgEl = doc.querySelector('svg');
        if (svgEl) {
         svgEl.setAttribute('width', '16');
         svgEl.setAttribute('height', '16');
         tagContent.innerHTML = '';
         tagContent.appendChild(svgEl);
         const nameSpan = document.createElement('span');
         nameSpan.textContent = tag.name;
         nameSpan.style.marginLeft = '4px';
         tagContent.appendChild(nameSpan);
        }
       }
      });
     } else {
      tagContent.textContent = tag;
      tagContent.addEventListener("click", (e) => {
       e.stopPropagation();
       showEditModal("Edit Tag", tag, (newTag) => {
        if (newTag) {
         data.tags[i] = newTag;
         claimTheImmortal(id);
        }
       });
      });
     }
     
     const deleteTag = document.createElement("span");
     deleteTag.textContent = " ‚úï";
     deleteTag.style.opacity = "0.6";
     deleteTag.style.marginLeft = "4px";
     deleteTag.style.fontSize = "10px";
     deleteTag.addEventListener("click", (e) => {
      e.stopPropagation();
      data.tags.splice(i, 1);
      claimTheImmortal(id);
     });
     b.append(tagContent, deleteTag);
     tagEl.append(b);
    });
    const addTagBtn = document.createElement("span");
    addTagBtn.className = "badge";
    addTagBtn.style.cursor = "pointer";
    addTagBtn.style.opacity = "0.6";
    addTagBtn.style.borderStyle = "dashed";
    addTagBtn.textContent = "+ Add";
    addTagBtn.addEventListener("click", () => {
     showEditModal("Add Tag(s) : comma separated", "",
      (newTagStr) => {
       if (newTagStr) {
        const newTags = newTagStr.split(",").map((t) => t.trim()).filter((t) => t);
        newTags.forEach((t) => data.tags.push(t));
        claimTheImmortal(id);
       }
      }, );
    });
    tagEl.append(addTagBtn);
    const notesEl = document.getElementById("node-notes");
    notesEl.innerHTML = "";
    data.notes.forEach((note, i) => {
     const li = document.createElement("li");
     const noteText = document.createElement("span");
     noteText.textContent = note;
     noteText.style.flex = "1";
     const deleteBtn = document.createElement("span");
     deleteBtn.className = "delete-note";
     deleteBtn.textContent = "‚úï";
     deleteBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      challengeTheImmortal("Are you sure you want to delete this note?",
       () => {
        data.notes.splice(i, 1);
        claimTheImmortal(id);
       }, );
     });
     li.append(noteText, deleteBtn);
     noteText.addEventListener("dblclick", () => {
      noteText.classList.add("editing");
      noteText.contentEditable = true;
      noteText.focus();
     });
     noteText.addEventListener("blur", () => {
      noteText.classList.remove("editing");
      noteText.contentEditable = false;
      data.notes[i] = noteText.textContent;
     });
     notesEl.append(li);
    });
    const addLineSelect = document.getElementById("add-line-select");
    addLineSelect.innerHTML = "";
    Object.entries(NODE_DATA).forEach(([nodeId, node]) => {
     if (nodeId !== id) {
      const opt = document.createElement("option");
      opt.value = nodeId;
      opt.textContent = node.name;
      addLineSelect.appendChild(opt);
     }
    });
   }

   function selectTheConnection(id) {
    currentEdgeId = id;
    document.getElementById("node-panel").style.display = "none";
    document.getElementById("edge-panel").style.display = "block";
    document.getElementById("topology-toolbar").style.display = "none";
    document.querySelectorAll(".node-group").forEach((n) => n.classList.remove("active"));
    document.querySelectorAll(".edge").forEach((e) => {
     e.classList.toggle("active", e.dataset.edgeId === id);
    });
    const edge = EDGE_DATA.list.find((e) => e.id === id);
    if (!edge) return;
    const directionSymbols = {
     none: "‚áÑ",
     forward: "‚Üí",
     backward: "‚Üê",
     both: "‚Üî",
    };
    const dirSymbol = directionSymbols[edge.direction] || "‚áÑ";
    let titleText = "Custom line";
    if (edge.from || edge.to) {
     const fromName = edge.from ? NODE_DATA[edge.from]?.name || edge.from : "";
     const toName = edge.to ? NODE_DATA[edge.to]?.name || edge.to : "";
     titleText = `${fromName || "?"} ${dirSymbol} ${toName || "?"}`;
    }
    document.getElementById("edge-title").textContent = titleText;
    const widthInput = document.getElementById("edge-width");
    const colorInput = document.getElementById("edge-color");
    const directionSelect = document.getElementById("edge-direction");
    const lineStyleSelect = document.getElementById("edge-line-style");
    widthInput.value = edge.width;
    colorInput.value = edge.color;
    directionSelect.value = edge.direction || "none";
    lineStyleSelect.value = edge.lineStyle || "solid";
    const list = document.getElementById("edge-notes");
    list.innerHTML = "";
    edge.notes.forEach((note, i) => {
     const li = document.createElement("li");
     const txt = document.createElement("span");
     txt.textContent = note;
     txt.style.flex = "1";
     const del = document.createElement("span");
     del.className = "delete-note";
     del.textContent = "‚úï";
     del.addEventListener("click", (e) => {
      e.stopPropagation();
      challengeTheImmortal("Delete this line note?", () => {
       edge.notes.splice(i, 1);
       saveEdgeData();
       selectTheConnection(id);
      });
     });
     txt.addEventListener("dblclick", () => {
      txt.classList.add("editing");
      txt.contentEditable = true;
      txt.focus();
     });
     txt.addEventListener("blur", () => {
      txt.classList.remove("editing");
      txt.contentEditable = false;
      edge.notes[i] = txt.textContent;
      saveEdgeData();
     });
     li.append(txt, del);
     list.appendChild(li);
    });
   }
   window.addEventListener("resize", () => {
    forgeTheTopology();
    if (currentEdgeId) {
     selectTheConnection(currentEdgeId);
    } else if (currentNodeId && NODE_DATA[currentNodeId]) {
     claimTheImmortal(currentNodeId);
    } else {
     const availableNodes = Object.keys(NODE_DATA);
     if (availableNodes.length > 0) {
      claimTheImmortal(availableNodes[0]);
     }
    }
   });
   (function initZoomPan() {
    const viewport = document.getElementById("canvas-viewport");
    const svg = document.getElementById("map");
    const hint = document.getElementById("canvas-hint");
    setTimeout(() => {
     hint.classList.add("visible");
     setTimeout(() => hint.classList.remove("visible"), 4000);
    }, 1000);
    viewport.addEventListener("wheel",
     (e) => {
      e.preventDefault();
      const rect = viewport.getBoundingClientRect();
      const mouseX = (e.clientX - rect.left) / rect.width;
      const mouseY = (e.clientY - rect.top) / rect.height;
      const delta = e.deltaY > 0 ? 0.9 : 1.1;
      zoomTo(canvasState.zoom * delta, mouseX, mouseY);
     }, {
      passive: false
     }, );
    let initialPinchDistance = 0;
    let initialPinchZoom = 1;
    let pinchCenter = {
     x: 0.5,
     y: 0.5
    };
    viewport.addEventListener("touchstart",
     (e) => {
      if (e.touches.length === 2) {
       e.preventDefault();
       const touch1 = e.touches[0];
       const touch2 = e.touches[1];
       initialPinchDistance = Math.hypot(touch2.clientX - touch1.clientX, touch2.clientY - touch1.clientY, );
       initialPinchZoom = canvasState.zoom;
       const rect = viewport.getBoundingClientRect();
       const centerX = (touch1.clientX + touch2.clientX) / 2;
       const centerY = (touch1.clientY + touch2.clientY) / 2;
       pinchCenter.x = (centerX - rect.left) / rect.width;
       pinchCenter.y = (centerY - rect.top) / rect.height;
      }
     }, {
      passive: false
     }, );
    viewport.addEventListener("touchmove",
     (e) => {
      if (e.touches.length === 2) {
       e.preventDefault();
       const touch1 = e.touches[0];
       const touch2 = e.touches[1];
       const currentDistance = Math.hypot(touch2.clientX - touch1.clientX, touch2.clientY - touch1.clientY, );
       if (initialPinchDistance > 0) {
        const scale = currentDistance / initialPinchDistance;
        const newZoom = initialPinchZoom * scale;
        zoomTo(newZoom, pinchCenter.x, pinchCenter.y);
       }
      }
     }, {
      passive: false
     }, );
    let panStartViewX = 0;
    let panStartViewY = 0;
    viewport.addEventListener("mousedown", (e) => {
     if (e.target.closest(".draw-toolbar") || e.target.closest(".topology-toolbar") || e.target.closest(".legend-container")) {
      return;
     }
     const isEmptySpace = e.target === svg || e.target === viewport || e.target.tagName === "svg";
     if (isEmptySpace || canvasState.spacePressed) {
      e.preventDefault();
      canvasState.isPanning = true;
      canvasState.panStartX = e.clientX;
      canvasState.panStartY = e.clientY;
      panStartViewX = canvasState.panX;
      panStartViewY = canvasState.panY;
      viewport.classList.add("panning");
     }
    });
    viewport.addEventListener("touchstart",
     (e) => {
      if (e.target.closest(".draw-toolbar") || e.target.closest(".topology-toolbar") || e.target.closest(".legend-container")) {
       return;
      }
      const isEmptySpace = e.target === svg || e.target === viewport || e.target.tagName === "svg";
      if (isEmptySpace && e.touches.length === 1) {
       e.preventDefault();
       canvasState.isPanning = true;
       canvasState.panStartX = e.touches[0].clientX;
       canvasState.panStartY = e.touches[0].clientY;
       panStartViewX = canvasState.panX;
       panStartViewY = canvasState.panY;
       viewport.classList.add("panning");
      }
     }, {
      passive: false
     }, );
    document.addEventListener("mousemove", (e) => {
     if (!canvasState.isPanning) return;
     const dx = e.clientX - canvasState.panStartX;
     const dy = e.clientY - canvasState.panStartY;
     const rect = viewport.getBoundingClientRect();
     const viewWidth = CANVAS_WIDTH / canvasState.zoom;
     const viewHeight = CANVAS_HEIGHT / canvasState.zoom;
     const canvasDx = (dx / rect.width) * viewWidth;
     const canvasDy = (dy / rect.height) * viewHeight;
     canvasState.panX = panStartViewX - canvasDx;
     canvasState.panY = panStartViewY - canvasDy;
     constrainPan();
     updateViewBox();
    });
    document.addEventListener("touchmove", (e) => {
     if (!canvasState.isPanning || !e.touches[0]) return;
     const dx = e.touches[0].clientX - canvasState.panStartX;
     const dy = e.touches[0].clientY - canvasState.panStartY;
     const rect = viewport.getBoundingClientRect();
     const viewWidth = CANVAS_WIDTH / canvasState.zoom;
     const viewHeight = CANVAS_HEIGHT / canvasState.zoom;
     const canvasDx = (dx / rect.width) * viewWidth;
     const canvasDy = (dy / rect.height) * viewHeight;
     canvasState.panX = panStartViewX - canvasDx;
     canvasState.panY = panStartViewY - canvasDy;
     constrainPan();
     updateViewBox();
    });
    document.addEventListener("mouseup", () => {
     if (canvasState.isPanning) {
      canvasState.isPanning = false;
      viewport.classList.remove("panning");
     }
    });
    document.addEventListener("touchend", () => {
     if (canvasState.isPanning) {
      canvasState.isPanning = false;
      viewport.classList.remove("panning");
     }
    });
    document.addEventListener("keydown", (e) => {
     const isEditing = document.activeElement.tagName === "INPUT" || document.activeElement.tagName === "TEXTAREA" || document.activeElement.isContentEditable;
     if (e.code === "Space" && !e.repeat && !isEditing) {
      e.preventDefault();
      canvasState.spacePressed = true;
      viewport.style.cursor = "grab";
     }
    });
    document.addEventListener("keyup", (e) => {
     if (e.code === "Space") {
      canvasState.spacePressed = false;
      viewport.style.cursor = "";
     }
    });
    document.getElementById("zoom-in-btn").addEventListener("click", () => {
     zoomTo(canvasState.zoom * 1.25, 0.5, 0.5);
    });
    document.getElementById("zoom-out-btn").addEventListener("click", () => {
     zoomTo(canvasState.zoom * 0.8, 0.5, 0.5);
    });
    document.getElementById("zoom-fit-btn").addEventListener("click", fitToContent);
    document.getElementById("zoom-reset-btn").addEventListener("click", resetView);
    const minimapContainer = document.getElementById("minimap-container");
    const minimapSvg = document.getElementById("minimap");
    let minimapDragging = false;
    minimapContainer.addEventListener("mousedown", (e) => {
     e.preventDefault();
     minimapDragging = true;
     updatePanFromMinimap(e);
    });
    minimapContainer.addEventListener("touchstart",
     (e) => {
      e.preventDefault();
      minimapDragging = true;
      updatePanFromMinimapTouch(e);
     }, {
      passive: false
     }, );
    document.addEventListener("mousemove", (e) => {
     if (minimapDragging) {
      updatePanFromMinimap(e);
     }
    });
    document.addEventListener("touchmove", (e) => {
     if (minimapDragging && e.touches[0]) {
      updatePanFromMinimapTouch(e);
     }
    });
    document.addEventListener("mouseup", () => {
     minimapDragging = false;
    });
    document.addEventListener("touchend", () => {
     minimapDragging = false;
    });

    function updatePanFromMinimap(e) {
     const rect = minimapContainer.getBoundingClientRect();
     const x = (e.clientX - rect.left) / rect.width;
     const y = (e.clientY - rect.top) / rect.height;
     const viewWidth = CANVAS_WIDTH / canvasState.zoom;
     const viewHeight = CANVAS_HEIGHT / canvasState.zoom;
     canvasState.panX = x * CANVAS_WIDTH - viewWidth / 2;
     canvasState.panY = y * CANVAS_HEIGHT - viewHeight / 2;
     constrainPan();
     updateViewBox();
    }

    function updatePanFromMinimapTouch(e) {
     const rect = minimapContainer.getBoundingClientRect();
     const touch = e.touches[0];
     const x = (touch.clientX - rect.left) / rect.width;
     const y = (touch.clientY - rect.top) / rect.height;
     const viewWidth = CANVAS_WIDTH / canvasState.zoom;
     const viewHeight = CANVAS_HEIGHT / canvasState.zoom;
     canvasState.panX = x * CANVAS_WIDTH - viewWidth / 2;
     canvasState.panY = y * CANVAS_HEIGHT - viewHeight / 2;
     constrainPan();
     updateViewBox();
    }
    document.addEventListener("keydown", (e) => {
     if (document.activeElement.tagName === "INPUT" || document.activeElement.tagName === "TEXTAREA") return;
     if (
      (e.key === "+" || e.key === "=") && (e.ctrlKey || e.metaKey)) {
      e.preventDefault();
      zoomTo(canvasState.zoom * 1.25, 0.5, 0.5);
     } else if (e.key === "-" && (e.ctrlKey || e.metaKey)) {
      e.preventDefault();
      zoomTo(canvasState.zoom * 0.8, 0.5, 0.5);
     } else if (e.key === "0" && (e.ctrlKey || e.metaKey)) {
      e.preventDefault();
      resetView();
     }
    });
    setTimeout(() => {
     fitToContent();
    }, 100);
   })();
   const sizeSlider = document.getElementById("size-slider");
   const sizeValue = document.getElementById("size-value");
   const resetSizeBtn = document.getElementById("reset-size");
   sizeSlider.addEventListener("input", () => {
    const newSize = parseInt(sizeSlider.value, 10);
    sizeValue.textContent = newSize;
    savedSizes[currentNodeId] = newSize;
    const nodeGroup = document.querySelector(`g[data-node-id="${currentNodeId}"]`, );
    if (nodeGroup) {
     const oldShape = nodeGroup.querySelector(".node-circle");
     if (oldShape) oldShape.remove();
     const newShape = createNodeShape(currentNodeId, newSize);
     nodeGroup.insertBefore(newShape, nodeGroup.firstChild);
										   
     const styles = resolveStylesForNode(currentNodeId);
     if (styles.circleColor) newShape.style.stroke = styles.circleColor;
															
     const label = nodeGroup.querySelector(".node-label");
     const sub = nodeGroup.querySelector(".node-sub");
     if (label) {
      label.setAttribute("y", -newSize * 0.28);
      const labelSize = styles.titleSize || newSize * 0.33;
      label.style.fontSize = labelSize + "px";
     }
     if (sub) {
      sub.setAttribute("y", newSize * 0.4);
      const subSize = styles.subSize || newSize * 0.24;
      sub.style.fontSize = subSize + "px";
     }
    }
   });
   resetSizeBtn.addEventListener("click", () => {
    delete savedSizes[currentNodeId];
    const defaultSize = getDefaultSize();
    sizeSlider.value = defaultSize;
    sizeValue.textContent = defaultSize;
    const nodeGroup = document.querySelector(`g[data-node-id="${currentNodeId}"]`, );
    if (nodeGroup) {
     const oldShape = nodeGroup.querySelector(".node-circle");
     if (oldShape) oldShape.remove();
     const shapeType = (NODE_DATA[currentNodeId] && NODE_DATA[currentNodeId].shape) || "circle";
     const newShape = createNodeShape(currentNodeId, defaultSize);
     nodeGroup.insertBefore(newShape, nodeGroup.firstChild);
     const styles = resolveStylesForNode(currentNodeId);
     if (styles.circleColor) newShape.style.stroke = styles.circleColor;
     const label = nodeGroup.querySelector(".node-label");
     const sub = nodeGroup.querySelector(".node-sub");
     if (label) {
      label.setAttribute("y", -defaultSize * 0.28);
      const labelSize = styles.titleSize || defaultSize * 0.33;
      label.style.fontSize = labelSize + "px";
     }
     if (sub) {
      sub.setAttribute("y", defaultSize * 0.4);
      const subSize = styles.subSize || defaultSize * 0.24;
      sub.style.fontSize = subSize + "px";
     }
    }
   });
   const applyStyle = (property, value) => {
    const styleEntry = ensureStyleEntry(currentNodeId);
    const scopeKey = currentStyleScope || "all";
    if (!styleEntry[scopeKey]) styleEntry[scopeKey] = {};
    styleEntry[scopeKey][property] = value;
    const nodeGroup = document.querySelector(`g[data-node-id="${currentNodeId}"]`, );
    if (!nodeGroup) return;
    const shapeEl = nodeGroup.querySelector(".node-circle");
    const label = nodeGroup.querySelector(".node-label");
    const sub = nodeGroup.querySelector(".node-sub");
    if (property === "circleColor" && shapeEl) shapeEl.style.stroke = value;
    else if (property === "titleColor" && label) label.style.fill = value;
    else if (property === "titleFont" && label) label.style.fontFamily = value;
    else if (property === "titleSize" && label) label.style.fontSize = value + "px";
    else if (property === "subColor" && sub) sub.style.fill = value;
    else if (property === "subFont" && sub) sub.style.fontFamily = value;
    else if (property === "subSize" && sub) sub.style.fontSize = value + "px";
   };
   document.getElementById("circle-color").addEventListener("input", (e) => applyStyle("circleColor", e.target.value), );
   document.getElementById("title-color").addEventListener("input", (e) => applyStyle("titleColor", e.target.value), );
   document.getElementById("title-font").addEventListener("change", (e) => applyStyle("titleFont", e.target.value), );
   document.getElementById("title-size").addEventListener("input", (e) => applyStyle("titleSize", parseInt(e.target.value, 10)), );
   document.getElementById("sub-color").addEventListener("input", (e) => applyStyle("subColor", e.target.value), );
   document.getElementById("sub-font").addEventListener("change", (e) => applyStyle("subFont", e.target.value), );
   document.getElementById("sub-size").addEventListener("input", (e) => applyStyle("subSize", parseInt(e.target.value, 10)), );
   document.getElementById("title-offset-y").addEventListener("input", (e) => {
    applyStyle("titleOffsetY", parseInt(e.target.value, 10) || 0);
    forgeTheTopology();
    if (currentNodeId) claimTheImmortal(currentNodeId);
   });
   document.getElementById("title-offset-x").addEventListener("input", (e) => {
    applyStyle("titleOffsetX", parseInt(e.target.value, 10) || 0);
    forgeTheTopology();
    if (currentNodeId) claimTheImmortal(currentNodeId);
   });
   document.getElementById("sub-offset-y").addEventListener("input", (e) => {
    applyStyle("subOffsetY", parseInt(e.target.value, 10) || 0);
    forgeTheTopology();
    if (currentNodeId) claimTheImmortal(currentNodeId);
   });
   document.getElementById("sub-offset-x").addEventListener("input", (e) => {
    applyStyle("subOffsetX", parseInt(e.target.value, 10) || 0);
    forgeTheTopology();
    if (currentNodeId) claimTheImmortal(currentNodeId);
   });
   document.getElementById("reset-styles").addEventListener("click", () => {
    delete savedStyles[currentNodeId];
    forgeTheTopology();
    claimTheImmortal(currentNodeId);
   });
   document.getElementById("style-scope").addEventListener("change", (e) => {
    currentStyleScope = e.target.value || "all";
    claimTheImmortal(currentNodeId);
   });
   document.getElementById("shape-select").addEventListener("change", (e) => {
    const shape = e.target.value || "circle";
    NODE_DATA[currentNodeId].shape = shape;
    const nodeGroup = document.querySelector(`g[data-node-id="${currentNodeId}"]`, );
    if (!nodeGroup) return;
    const oldShape = nodeGroup.querySelector(".node-circle");
    if (oldShape) oldShape.remove();
    const size = savedSizes[currentNodeId] || getDefaultSize();
    const newShape = createNodeShape(currentNodeId, size);
    nodeGroup.insertBefore(newShape, nodeGroup.firstChild);
   });
   const addNoteBtn = document.getElementById("add-note-btn");
   const noteInput = document.getElementById("new-note-input");
   addNoteBtn.addEventListener("click", () => {
    const newNote = noteInput.value.trim();
    if (newNote && currentNodeId) {
     NODE_DATA[currentNodeId].notes.push(newNote);
     claimTheImmortal(currentNodeId);
     noteInput.value = "";
    }
   });
   noteInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
     addNoteBtn.click();
    }
   });
   document.getElementById("edge-width").addEventListener("input", () => {
    if (!currentEdgeId) return;
    const edge = EDGE_DATA.list.find((e) => e.id === currentEdgeId);
    if (!edge) return;
    const v = parseInt(document.getElementById("edge-width").value, 10);
    if (Number.isNaN(v) || v <= 0) return;
    edge.width = v;
    saveEdgeData();
    const el = document.querySelector(`.edge[data-edge-id="${currentEdgeId}"]`, );
    if (el) el.style.strokeWidth = v;
   });
   document.getElementById("edge-color").addEventListener("input", () => {
    if (!currentEdgeId) return;
    const edge = EDGE_DATA.list.find((e) => e.id === currentEdgeId);
    if (!edge) return;
    const color = document.getElementById("edge-color").value;
    edge.color = color;
    saveEdgeData();
    const el = document.querySelector(`.edge[data-edge-id="${currentEdgeId}"]`, );
    if (el) el.style.stroke = color;
    forgeTheLegend();
   });
   document.getElementById("edge-direction").addEventListener("change", () => {
    if (!currentEdgeId) return;
    const edge = EDGE_DATA.list.find((e) => e.id === currentEdgeId);
    if (!edge) return;
    edge.direction = document.getElementById("edge-direction").value;
    saveEdgeData();
    forgeTheTopology();
    selectTheConnection(currentEdgeId);
   });
   document.getElementById("edge-line-style").addEventListener("change", () => {
    if (!currentEdgeId) return;
    const edge = EDGE_DATA.list.find((e) => e.id === currentEdgeId);
    if (!edge) return;
    edge.lineStyle = document.getElementById("edge-line-style").value;
    saveEdgeData();
    forgeTheTopology();
    selectTheConnection(currentEdgeId);
   });
   const addEdgeNoteBtn = document.getElementById("add-edge-note");
   const newEdgeNoteInput = document.getElementById("new-edge-note");
   addEdgeNoteBtn.addEventListener("click", () => {
    const txt = newEdgeNoteInput.value.trim();
    if (!txt || !currentEdgeId) return;
    const edge = EDGE_DATA.list.find((e) => e.id === currentEdgeId);
    if (!edge) return;
    edge.notes.push(txt);
    saveEdgeData();
    newEdgeNoteInput.value = "";
    selectTheConnection(currentEdgeId);
   });
   newEdgeNoteInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
     addEdgeNoteBtn.click();
    }
   });
   document.getElementById("delete-edge").addEventListener("click", () => {
    if (!currentEdgeId) return;
    challengeTheImmortal("Are you sure you want to delete this line?",
     () => {
      EDGE_DATA.list = EDGE_DATA.list.filter(
       (e) => e.id !== currentEdgeId, );
      saveEdgeData();
      currentEdgeId = null;
      forgeTheTopology();
      const availableNodes = Object.keys(NODE_DATA);
      if (availableNodes.length > 0) {
       claimTheImmortal(availableNodes[0]);
      } else {
       document.getElementById("node-panel").style.display = "none";
       document.getElementById("edge-panel").style.display = "none";
       document.getElementById("topology-toolbar", ).style.display = "none";
      }
     }, );
   });
   document.getElementById("add-line-btn").addEventListener("click", () => {
    if (!currentNodeId) return;
    const select = document.getElementById("add-line-select");
    const directionSelect = document.getElementById("add-line-direction");
    const colorInput = document.getElementById("add-line-color");
    const targetId = select.value;
    if (!targetId || targetId === currentNodeId) return;
    const direction = directionSelect.value || "none";
    const lineColor = colorInput.value || "#475569";
    const newId = `${currentNodeId}-${targetId}-${Date.now()}`;
    const newEdge = {
     id: newId,
     from: currentNodeId,
     to: targetId,
     width: 4,
     color: lineColor,
     direction: direction,
     type: "main",
     notes: [],
    };
    EDGE_DATA.list.push(newEdge);
    saveEdgeData();
    forgeTheTopology();
    claimTheImmortal(currentNodeId);
   });
   let freeDrawMode = false;
   let freeDrawPoints = [];
   let freeDrawPolylineEl = null;
   let freeDrawPointEls = [];
   const drawToggleBtn = document.getElementById("draw-toggle");
   const drawUndoBtn = document.getElementById("draw-undo");
   const drawColorInput = document.getElementById("draw-color");
   const drawStyleSelect = document.getElementById("draw-style");
   const drawArrowSelect = document.getElementById("draw-arrow");
   const svgMap = document.getElementById("map");

   function updateFreeDrawGraphics() {
    const ns = "http://www.w3.org/2000/svg";
    const svg = svgMap;
    if (!freeDrawPolylineEl && freeDrawPoints.length > 0) {
     freeDrawPolylineEl = document.createElementNS(ns, "polyline");
     freeDrawPolylineEl.classList.add("edge", "free-preview");
     freeDrawPolylineEl.setAttribute("fill", "none");
     svg.appendChild(freeDrawPolylineEl);
    }
    if (freeDrawPolylineEl) {
     if (freeDrawPoints.length === 0) {
      freeDrawPolylineEl.remove();
      freeDrawPolylineEl = null;
     } else {
      const ptsStr = freeDrawPoints.map((p) => `${p.x},${p.y}`).join(" ");
      freeDrawPolylineEl.setAttribute("points", ptsStr);
      freeDrawPolylineEl.style.stroke = drawColorInput.value || "#475569";
      freeDrawPolylineEl.style.strokeWidth = 3;
      const lineStyle = drawStyleSelect.value || "solid";
      if (lineStyle === "dashed") {
       freeDrawPolylineEl.style.strokeDasharray = "10,5";
      } else if (lineStyle === "dotted") {
       freeDrawPolylineEl.style.strokeDasharray = "2,4";
      } else {
       freeDrawPolylineEl.style.strokeDasharray = "none";
      }
     }
    }
    freeDrawPointEls.forEach((el) => el.remove());
    freeDrawPointEls = [];
    freeDrawPoints.forEach((p, idx) => {
     const c = document.createElementNS(ns, "circle");
     c.classList.add("free-point");
     c.setAttribute("cx", p.x);
     c.setAttribute("cy", p.y);
     c.setAttribute("r", 5);
     c.dataset.index = String(idx);
     c.addEventListener("mousedown", (e) => {
      if (!freeDrawMode) return;
      e.preventDefault();
      e.stopPropagation();
      let dragging = true;
      const svgEl = svgMap;
      const moveHandler = (ev) => {
       if (!dragging) return;
       const pt = svgEl.createSVGPoint();
       pt.x = ev.clientX;
       pt.y = ev.clientY;
       const svgP = pt.matrixTransform(svgEl.getScreenCTM().inverse(), );
       const i = parseInt(c.dataset.index, 10);
       if (Number.isNaN(i) || !freeDrawPoints[i]) return;
       freeDrawPoints[i].x = svgP.x;
       freeDrawPoints[i].y = svgP.y;
       updateFreeDrawGraphics();
      };
      const upHandler = () => {
       dragging = false;
       document.removeEventListener("mousemove", moveHandler);
       document.removeEventListener("mouseup", upHandler);
      };
      document.addEventListener("mousemove", moveHandler);
      document.addEventListener("mouseup", upHandler);
     });
     c.addEventListener("touchstart",
      (e) => {
       if (!freeDrawMode) return;
       e.preventDefault();
       e.stopPropagation();
       let dragging = true;
       const svgEl = svgMap;
       const touchMoveHandler = (ev) => {
        if (!dragging || !ev.touches[0]) return;
        const pt = svgEl.createSVGPoint();
        pt.x = ev.touches[0].clientX;
        pt.y = ev.touches[0].clientY;
        const svgP = pt.matrixTransform(svgEl.getScreenCTM().inverse(), );
        const i = parseInt(c.dataset.index, 10);
        if (Number.isNaN(i) || !freeDrawPoints[i]) return;
        freeDrawPoints[i].x = svgP.x;
        freeDrawPoints[i].y = svgP.y;
        updateFreeDrawGraphics();
       };
       const touchUpHandler = () => {
        dragging = false;
        document.removeEventListener("touchmove", touchMoveHandler, );
        document.removeEventListener("touchend", touchUpHandler, );
       };
       document.addEventListener("touchmove", touchMoveHandler);
       document.addEventListener("touchend", touchUpHandler);
      }, {
       passive: false
      }, );
     svg.appendChild(c);
     freeDrawPointEls.push(c);
    });
    drawUndoBtn.style.display = freeDrawPoints.length ? "inline-block" : "none";
   }

   function addFreeDrawPoint(x, y) {
    freeDrawPoints.push({
     x,
     y
    });
    updateFreeDrawGraphics();
   }

   function startFreeDraw() {
    freeDrawMode = true;
    freeDrawPoints = [];
    if (freeDrawPolylineEl) {
     freeDrawPolylineEl.remove();
     freeDrawPolylineEl = null;
    }
    freeDrawPointEls.forEach((el) => el.remove());
    freeDrawPointEls = [];
    svgMap.style.cursor = "crosshair";
    drawToggleBtn.textContent = "Done";
    drawUndoBtn.style.display = "none";
   }

   function finishFreeDraw() {
    freeDrawMode = false;
    svgMap.style.cursor = "";
    drawToggleBtn.textContent = "‚úèÔ∏è";
    if (freeDrawPoints.length >= 2) {
     const color = drawColorInput.value || "#475569";
     const lineStyle = drawStyleSelect.value || "solid";
     const arrowDir = drawArrowSelect.value || "none";
     const newId = "custom-" + Date.now();
     const pointsCopy = freeDrawPoints.map((p) => ({
      x: p.x,
      y: p.y,
     }));
     EDGE_DATA.list.push({
      id: newId,
      type: "custom",
      color,
      width: 4,
      lineStyle: lineStyle,
      direction: arrowDir,
      points: pointsCopy,
      notes: [],
     });
     saveEdgeData();
     freeDrawPoints = [];
     if (freeDrawPolylineEl) {
      freeDrawPolylineEl.remove();
      freeDrawPolylineEl = null;
     }
     freeDrawPointEls.forEach((el) => el.remove());
     freeDrawPointEls = [];
     forgeTheTopology();
     selectTheConnection(newId);
    } else {
     freeDrawPoints = [];
     if (freeDrawPolylineEl) {
      freeDrawPolylineEl.remove();
      freeDrawPolylineEl = null;
     }
     freeDrawPointEls.forEach((el) => el.remove());
     freeDrawPointEls = [];
     forgeTheLegend();
    }
    drawUndoBtn.style.display = "none";
   }
   drawToggleBtn.addEventListener("click", () => {
    if (freeDrawMode) {
     finishFreeDraw();
    } else {
     startFreeDraw();
    }
   });
   drawUndoBtn.addEventListener("click", () => {
    if (!freeDrawMode || !freeDrawPoints.length) return;
    freeDrawPoints.pop();
    updateFreeDrawGraphics();
   });
   const drawToolbar = document.getElementById("draw-toolbar");
   drawToolbar.addEventListener("mousedown", (e) => {
    e.stopPropagation();
   });
   drawToolbar.addEventListener("click", (e) => {
    if (e.target !== drawToggleBtn && e.target !== drawUndoBtn) {
     e.stopPropagation();
    }
   });
   drawStyleSelect.addEventListener("change", () => {
    if (freeDrawMode) {
     updateFreeDrawGraphics();
    }
   });
   drawArrowSelect.addEventListener("change", () => {
    if (freeDrawMode) {
     updateFreeDrawGraphics();
    }
   });
   drawColorInput.addEventListener("input", () => {
    if (freeDrawMode) {
     updateFreeDrawGraphics();
    }
   });
   drawStyleSelect.addEventListener("mousedown", (e) => {
    e.stopPropagation();
   });
   drawStyleSelect.addEventListener("click", (e) => {
    e.stopPropagation();
   });
   drawArrowSelect.addEventListener("mousedown", (e) => {
    e.stopPropagation();
   });
   drawArrowSelect.addEventListener("click", (e) => {
    e.stopPropagation();
   });
   drawColorInput.addEventListener("mousedown", (e) => {
    e.stopPropagation();
   });
   drawColorInput.addEventListener("click", (e) => {
    e.stopPropagation();
   });
   svgMap.addEventListener("click", (e) => {
    if (!freeDrawMode) return;
    if (e.button !== 0) return;
    const target = e.target;
    if (target && target.classList && target.classList.contains("free-point")) return;
    const svgEl = svgMap;
    const pt = svgEl.createSVGPoint();
    pt.x = e.clientX;
    pt.y = e.clientY;
    const svgP = pt.matrixTransform(svgEl.getScreenCTM().inverse());
    addFreeDrawPoint(svgP.x, svgP.y);
   });
   svgMap.addEventListener("touchend",
    (e) => {
     if (!freeDrawMode) return;
     const target = e.target;
     if (target && target.classList && target.classList.contains("free-point")) return;
     if (e.changedTouches && e.changedTouches[0]) {
      e.preventDefault();
      const svgEl = svgMap;
      const pt = svgEl.createSVGPoint();
      pt.x = e.changedTouches[0].clientX;
      pt.y = e.changedTouches[0].clientY;
      const svgP = pt.matrixTransform(svgEl.getScreenCTM().inverse(), );
      addFreeDrawPoint(svgP.x, svgP.y);
     }
    }, {
     passive: false
    }, );
   const settingsBtn = document.getElementById("settings-btn");
   const settingsModal = document.getElementById("settings-modal");
   const settingsClose = document.getElementById("settings-close");
   settingsBtn.addEventListener("click", () => {
    document.getElementById("page-bg-color").value = PAGE_STATE.background || "#050608";
    document.getElementById("topbar-bg-color").value = PAGE_STATE.topbarBg || "#0b0e13";
    document.getElementById("topbar-border-color").value = PAGE_STATE.topbarBorder || "#1f2533";
    document.getElementById("panel-color").value = PAGE_STATE.panel || "#0b0e13";
    document.getElementById("panel-alt-color").value = PAGE_STATE.panelAlt || "#10141b";
    document.getElementById("accent-color").value = PAGE_STATE.accent || "#4fd1c5";
    document.getElementById("danger-color").value = PAGE_STATE.danger || "#f56565";
    document.getElementById("text-main-color").value = PAGE_STATE.textMain || "#e2e8f0";
    document.getElementById("text-soft-color").value = PAGE_STATE.textSoft || "#94a3b8";
    settingsModal.classList.add("active");
   });
   settingsClose.addEventListener("click", () => {
    settingsModal.classList.remove("active");
   });
   settingsModal.addEventListener("click", (e) => {
    if (e.target === settingsModal) {
     settingsModal.classList.remove("active");
    }
   });
   document.getElementById("page-bg-color").addEventListener("input", (e) => {
    PAGE_STATE.background = e.target.value;
    wieldThePower();
   });
   document.getElementById("topbar-bg-color").addEventListener("input", (e) => {
    PAGE_STATE.topbarBg = e.target.value;
    wieldThePower();
   });
   document.getElementById("topbar-border-color").addEventListener("input", (e) => {
    PAGE_STATE.topbarBorder = e.target.value;
    wieldThePower();
   });
   document.getElementById("panel-color").addEventListener("input", (e) => {
    PAGE_STATE.panel = e.target.value;
    wieldThePower();
   });
   document.getElementById("panel-alt-color").addEventListener("input", (e) => {
    PAGE_STATE.panelAlt = e.target.value;
    wieldThePower();
   });
   document.getElementById("accent-color").addEventListener("input", (e) => {
    PAGE_STATE.accent = e.target.value;
    wieldThePower();
   });
   document.getElementById("danger-color").addEventListener("input", (e) => {
    PAGE_STATE.danger = e.target.value;
    wieldThePower();
   });
   document.getElementById("text-main-color").addEventListener("input", (e) => {
    PAGE_STATE.textMain = e.target.value;
    wieldThePower();
   });
   document.getElementById("text-soft-color").addEventListener("input", (e) => {
    PAGE_STATE.textSoft = e.target.value;
    wieldThePower();
   });
   document.getElementById("topbar-height").addEventListener("input", (e) => {
    PAGE_STATE.topbarHeight = parseInt(e.target.value, 10);
    document.getElementById("topbar-height-val").textContent = PAGE_STATE.topbarHeight + "px";
    wieldThePower();
   });
   document.getElementById("sidebar-width").addEventListener("input", (e) => {
    PAGE_STATE.sidebarWidth = parseInt(e.target.value, 10);
    document.getElementById("sidebar-width-val").textContent = PAGE_STATE.sidebarWidth + "px";
    wieldThePower();
   });
   document.getElementById("mobile-footer-height").addEventListener("input", (e) => {
    PAGE_STATE.mobileFooterHeight = parseInt(e.target.value, 10);
    document.getElementById("mobile-footer-height-val").textContent = PAGE_STATE.mobileFooterHeight + "%";
    wieldThePower();
   });
   document.getElementById("export-data-btn").addEventListener("click", () => {
    const data = captureTheQuickening();
    const jsonStr = JSON.stringify(data, null, 2);
    const blob = new Blob([jsonStr], {
     type: "application/json"
    });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    const safeTitle = (PAGE_STATE.title || "network-topology").toLowerCase().replace(/[^a-z0-9\-]+/g, "-");
    const timestamp = new Date().toISOString().split("T")[0];
    a.download = `${safeTitle}-data-${timestamp}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
   });
   document.getElementById("import-data-btn").addEventListener("click", () => {
    document.getElementById("import-data-file").click();
   });
   document.getElementById("import-data-file").addEventListener("change", async (e) => {
    const file = e.target.files[0];
    if (!file) return;
    try {
     const text = await file.text();
     const data = JSON.parse(text);
     if (!data.nodeData || !data.edgeData) {
      alert("Invalid data file. Missing required fields.");
      return;
     }
     const confirmMsg = `This will replace all current data with the imported data.\n\nImporting:\n- ${Object.keys(data.nodeData).length} nodes\n- ${data.edgeData.list?.length || 0} connections\n\nContinue?`;
     if (!confirm(confirmMsg)) {
      e.target.value = "";
      return;
     }
     NODE_DATA = data.nodeData || {};
     EDGE_DATA = data.edgeData || {
      list: []
     };
     EDGE_LEGEND = data.edgeLegend || {};
     savedPositions = data.nodePositions || {};
     savedSizes = data.nodeSizes || {};
     savedStyles = data.nodeStyles || {};
     if (data.page) {
      PAGE_STATE = Object.assign({}, DEFAULT_PAGE_STATE, data.page, );
      wieldThePower();
     }
     if (data.canvas) {
      canvasState.zoom = data.canvas.zoom || 1;
      canvasState.panX = data.canvas.panX || 0;
      canvasState.panY = data.canvas.panY || 0;
     }
     if (data.page?.title) {
      document.title = data.page.title;
      document.querySelector(".editable-page-title", ).textContent = data.page.title;
     }
     forgeTheTopology();
     forgeTheLegend();
     updateViewBox();
     const nodeIds = Object.keys(NODE_DATA);
     if (nodeIds.length > 0) {
      claimTheImmortal(nodeIds[0]);
     } else {
      document.getElementById("node-panel").style.display = "none";
      document.getElementById("edge-panel").style.display = "none";
      document.getElementById("topology-toolbar").style.display = "none";
     }
     alert("Data imported successfully!");
     e.target.value = "";
    } catch (err) {
     console.error("Import error:", err);
     alert(`Failed to import data: ${err.message}`);
     e.target.value = "";
    }
   });
   const saveHelpBtn = document.getElementById("save-help-btn");
   const saveInfoModal = document.getElementById("save-info-modal");
   const saveInfoClose = document.getElementById("save-info-close");
   saveHelpBtn.addEventListener("click", () => {
    saveInfoModal.classList.add("active");
   });
   saveInfoClose.addEventListener("click", () => {
    saveInfoModal.classList.remove("active");
   });
   saveInfoModal.addEventListener("click", (e) => {
    if (e.target === saveInfoModal) {
     saveInfoModal.classList.remove("active");
    }
   });
   async function deriveKey(password, salt) {
    const encoder = new TextEncoder();
    const keyMaterial = await crypto.subtle.importKey("raw", encoder.encode(password), "PBKDF2", false,
     ["deriveKey"], );
    return crypto.subtle.deriveKey({
      name: "PBKDF2",
      salt: salt,
      iterations: 100000,
      hash: "SHA-256",
     }, keyMaterial, {
      name: "AES-GCM",
      length: 256
     }, false,
     ["encrypt", "decrypt"], );
   }
   async function encryptData(data, password) {
    const encoder = new TextEncoder();
    const salt = crypto.getRandomValues(new Uint8Array(16));
    const iv = crypto.getRandomValues(new Uint8Array(12));
    const key = await deriveKey(password, salt);
    const encrypted = await crypto.subtle.encrypt({
     name: "AES-GCM",
     iv: iv
    }, key, encoder.encode(data), );
    const result = new Uint8Array(salt.length + iv.length + encrypted.byteLength, );
    result.set(salt, 0);
    result.set(iv, salt.length);
    result.set(new Uint8Array(encrypted), salt.length + iv.length);
    return "ENCRYPTED:" + btoa(String.fromCharCode(...result));
   }
   async function decryptData(encryptedData, password) {
    const base64Data = encryptedData.replace("ENCRYPTED:", "");
    const data = Uint8Array.from(atob(base64Data), (c) => c.charCodeAt(0), );
    const salt = data.slice(0, 16);
    const iv = data.slice(16, 28);
    const encrypted = data.slice(28);
    const key = await deriveKey(password, salt);
    const decrypted = await crypto.subtle.decrypt({
     name: "AES-GCM",
     iv: iv
    }, key, encrypted, );
    const decoder = new TextDecoder();
    return decoder.decode(decrypted);
   }

   function isEncrypted(data) {
    return typeof data === "string" && data.startsWith("ENCRYPTED:");
   }

   function captureTheQuickening() {
    return {
     nodeData: NODE_DATA,
     edgeData: EDGE_DATA,
     edgeLegend: EDGE_LEGEND,
     nodePositions: savedPositions,
     nodeSizes: savedSizes,
     nodeStyles: savedStyles,
     iconCache: IconLibrary.iconCache,
     page: PAGE_STATE,
     canvas: {
      zoom: canvasState.zoom,
      panX: canvasState.panX,
      panY: canvasState.panY,
     },
    };
   }

   function assembleTheImmortalForm() {
    const clone = document.documentElement.cloneNode(true);
    const nodeScript = clone.querySelector("#nodes-json");
    if (nodeScript) {
     nodeScript.textContent = JSON.stringify(NODE_DATA, null, 2);
    }
    let stateScript = clone.querySelector("#topology-state");
    if (!stateScript) {
     stateScript = document.createElement("script");
     stateScript.id = "topology-state";
     stateScript.type = "application/json";
     const body = clone.querySelector("body") || clone;
     body.appendChild(stateScript);
    }
    stateScript.textContent = JSON.stringify(captureTheQuickening(), null, 2, );
    return "<!DOCTYPE html>\n" + clone.outerHTML;
   }
   async function becomeImmortal() {
    const encryptEnabled = document.getElementById("encrypt-toggle").checked;
    let stateData = JSON.stringify(captureTheQuickening(), null, 2);
    if (encryptEnabled) {
     const password = prompt("Enter a password to encrypt your data:\n(Remember this password! You will need it to open this file and its non recoverable!)", );
     if (!password) {
      alert("Encryption cancelled. File not saved.");
      return;
     }
     const confirmPassword = prompt("Confirm your password:");
     if (password !== confirmPassword) {
      alert("Passwords do not match. File not saved.");
      return;
     }
     try {
      stateData = await encryptData(stateData, password);
     } catch (e) {
      alert("Encryption failed: " + e.message);
      return;
     }
    }
    const clone = document.documentElement.cloneNode(true);
    const nodeScript = clone.querySelector("#nodes-json");
    if (nodeScript) {
     if (encryptEnabled) {
      nodeScript.textContent = JSON.stringify({}, null, 2);
     } else {
      nodeScript.textContent = JSON.stringify(NODE_DATA, null, 2);
     }
    }
    let stateScript = clone.querySelector("#topology-state");
    if (!stateScript) {
     stateScript = document.createElement("script");
     stateScript.id = "topology-state";
     stateScript.type = "application/json";
     const body = clone.querySelector("body") || clone;
     body.appendChild(stateScript);
    }
    stateScript.textContent = stateData;
    const html = "<!DOCTYPE html>\n" + clone.outerHTML;
    const blob = new Blob([html], {
     type: "text/html"
    });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    const safeTitle = (PAGE_STATE.title || document.title || "network-topology").toLowerCase().replace(/[^a-z0-9\-]+/g, "-");
    a.download = safeTitle + ".html";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
   }
   document.getElementById("save-file-btn").addEventListener("click", becomeImmortal);
   const addNodeBtn = document.getElementById("add-node-btn");
   const addNodeModal = document.getElementById("add-node-modal");
   const addNodeCancel = document.getElementById("add-node-cancel");
   const addNodeSave = document.getElementById("add-node-save");
   addNodeBtn.addEventListener("click", () => {
    document.getElementById("new-node-name").value = "";
    document.getElementById("new-node-ip").value = "";
    document.getElementById("new-node-tags").value = "";
    document.getElementById("new-node-shape").value = "circle";
    newNodeIconTags = [];
    document.getElementById("new-node-icon-tags").style.display = "none";
    document.getElementById("new-node-icon-tags-list").innerHTML = "";
    addNodeModal.classList.add("active");
    document.getElementById("new-node-name").focus();
   });
   addNodeCancel.addEventListener("click", () => {
    addNodeModal.classList.remove("active");
   });
   addNodeModal.addEventListener("click", (e) => {
    if (e.target === addNodeModal) {
     addNodeModal.classList.remove("active");
    }
   });
   addNodeSave.addEventListener("click", () => {
    const name = document.getElementById("new-node-name").value.trim();
    const ip = document.getElementById("new-node-ip").value.trim();
    const tagsStr = document.getElementById("new-node-tags").value.trim();
    const shape = document.getElementById("new-node-shape").value;
    if (!name) {
     alert("Please enter a node name.");
     return;
    }
    const tags = tagsStr ? tagsStr.split(",").map((t) => t.trim()).filter((t) => t) : [];
    
    if (newNodeIconTags.length > 0) {
     tags.push(...newNodeIconTags);
    }
    
    let baseId = name.toLowerCase().replace(/[^a-z0-9]+/g, "-").replace(/^-|-$/g, "");
    if (!baseId) baseId = "node";
    let nodeId = baseId;
    let counter = 1;
    while (NODE_DATA[nodeId]) {
     nodeId = baseId + "-" + counter;
     counter++;
    }
    NODE_DATA[nodeId] = {
     shape: shape || "circle",
     name: name,
     ip: ip || "0.0.0.0",
     role: "",
     tags: tags,
     notes: [],
    };
    
    if (selectedNodeIconData) {
     if (!savedStyles[nodeId]) savedStyles[nodeId] = {};
     if (!savedStyles[nodeId]['all']) savedStyles[nodeId]['all'] = {};
     savedStyles[nodeId]['all'].icon = {
      library: selectedNodeIconData.library,
      name: selectedNodeIconData.name
     };
     selectedNodeIconData = null;
     document.getElementById('selected-node-icon').style.display = 'none';
    }
    
    newNodeIconTags = [];
    
    const centerX = CANVAS_WIDTH / 2;
    const centerY = CANVAS_HEIGHT / 2;
    savedPositions[nodeId] = {
     x: centerX,
     y: centerY
    };
    addNodeModal.classList.remove("active");
    forgeTheTopology();
    claimTheImmortal(nodeId);
   });
   ["new-node-name", "new-node-ip", "new-node-tags"].forEach(
    (inputId) => {
     document.getElementById(inputId).addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
       addNodeSave.click();
      }
     });
    }, );

   document.getElementById('pick-node-icon-btn').addEventListener('click', () => {
    openIconPicker((iconData) => {
     selectedNodeIconData = iconData;
     const preview = document.getElementById('selected-node-icon-preview');
     const container = document.getElementById('selected-node-icon');
     
     const parser = new DOMParser();
     const doc = parser.parseFromString(iconData.svg, 'image/svg+xml');
     const svgEl = doc.querySelector('svg');
     
     preview.innerHTML = '';
     if (svgEl) {
      preview.appendChild(svgEl.cloneNode(true));
     }
     const nameSpan = document.createElement('span');
     nameSpan.textContent = iconData.name;
     preview.appendChild(nameSpan);
     
     container.style.display = 'block';
    });
   });
   
   document.getElementById('pick-tag-icon-btn').addEventListener('click', () => {
    if (!currentNodeId) return;
    
    openIconPicker((iconData) => {
     if (!NODE_DATA[currentNodeId].tags) {
      NODE_DATA[currentNodeId].tags = [];
     }
     NODE_DATA[currentNodeId].tags.push({
      type: 'icon',
      library: iconData.library,
      name: iconData.name
     });
     forgeTheTopology();
     claimTheImmortal(currentNodeId);
    });
   });
   
   document.getElementById('pick-new-node-tag-icon-btn').addEventListener('click', () => {
    openIconPicker((iconData) => {
     newNodeIconTags.push({
      type: 'icon',
      library: iconData.library,
      name: iconData.name
     });
     
     const container = document.getElementById('new-node-icon-tags');
     const list = document.getElementById('new-node-icon-tags-list');
     
     const badge = document.createElement('div');
     badge.className = 'icon-badge';
     badge.style.cssText = 'display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; background: var(--panel-alt); border: 1px solid var(--edge-main); border-radius: 6px; font-size: 13px;';
     
     const iconPreview = document.createElement('div');
     iconPreview.style.cssText = 'width: 16px; height: 16px; display: flex; align-items: center; justify-content: center;';
     
     IconLibrary.getIcon(iconData.library, iconData.name).then(svg => {
      if (svg) {
       const parser = new DOMParser();
       const doc = parser.parseFromString(svg, 'image/svg+xml');
       const svgEl = doc.querySelector('svg');
       if (svgEl) {
        svgEl.setAttribute('width', '16');
        svgEl.setAttribute('height', '16');
        svgEl.style.fill = 'var(--text-main)';
        iconPreview.appendChild(svgEl);
       }
      }
     });
     
     const name = document.createElement('span');
     name.textContent = iconData.name;
     name.style.color = 'var(--text-soft)';
     
     const removeBtn = document.createElement('button');
     removeBtn.textContent = '√ó';
     removeBtn.style.cssText = 'background: none; border: none; color: var(--danger); cursor: pointer; font-size: 18px; line-height: 1; padding: 0 4px;';
     removeBtn.addEventListener('click', () => {
      const index = newNodeIconTags.findIndex(t => t.type === 'icon' && t.library === iconData.library && t.name === iconData.name);
      if (index > -1) {
       newNodeIconTags.splice(index, 1);
      }
      badge.remove();
      if (list.children.length === 0) {
       container.style.display = 'none';
      }
     });
     
     badge.appendChild(iconPreview);
     badge.appendChild(name);
     badge.appendChild(removeBtn);
     list.appendChild(badge);
     
     container.style.display = 'block';
    });
   });
   
   document.getElementById('pick-shape-icon-btn').addEventListener('click', () => {
    if (!currentNodeId) return;
    
    openIconPicker((iconData) => {
     if (!savedStyles[currentNodeId]) {
      savedStyles[currentNodeId] = {};
     }
     if (!savedStyles[currentNodeId][currentStyleScope]) {
      savedStyles[currentNodeId][currentStyleScope] = {};
     }
     savedStyles[currentNodeId][currentStyleScope].icon = {
      library: iconData.library,
      name: iconData.name
     };
     forgeTheTopology();
    });
   });
   
   document.getElementById('add-tag-btn').addEventListener('click', () => {
    if (!currentNodeId) return;
    const input = document.getElementById('new-tag-input');
    const tagText = input.value.trim();
    if (!tagText) return;
    
    if (!NODE_DATA[currentNodeId].tags) {
     NODE_DATA[currentNodeId].tags = [];
    }
    NODE_DATA[currentNodeId].tags.push(tagText);
    input.value = '';
    forgeTheTopology();
    claimTheImmortal(currentNodeId);
   });

   const clearAllBtn = document.getElementById("clear-all-btn");
   const clearAllModal = document.getElementById("clear-all-modal");
   const clearAllCancel = document.getElementById("clear-all-cancel");
   const clearAllConfirm = document.getElementById("clear-all-confirm");
   clearAllBtn.addEventListener("click", () => {
    clearAllModal.classList.add("active");
   });
   clearAllCancel.addEventListener("click", () => {
    clearAllModal.classList.remove("active");
   });
   clearAllModal.addEventListener("click", (e) => {
    if (e.target === clearAllModal) {
     clearAllModal.classList.remove("active");
    }
   });
   clearAllConfirm.addEventListener("click", () => {
    NODE_DATA = {};
    EDGE_DATA = {
     list: []
    };
    EDGE_LEGEND = {};
    savedPositions = {};
    savedSizes = {};
    savedStyles = {};
    clearAllModal.classList.remove("active");
    forgeTheTopology();
    document.getElementById("node-panel").style.display = "none";
    document.getElementById("edge-panel").style.display = "none";
    document.getElementById("topology-toolbar").style.display = "none";
    currentNodeId = null;
    currentEdgeId = null;
   });
   (function addDeleteNodeButton() {
    const nodePanel = document.getElementById("node-panel");
    if (!nodePanel) return;
    if (document.getElementById("delete-node-btn")) return;
    const deleteBtn = document.createElement("button");
    deleteBtn.id = "delete-node-btn";
    deleteBtn.textContent = "Delete Node";
    deleteBtn.style.cssText = "margin-top:15px; padding:10px 16px; background:var(--danger); color:#fff; border:none; border-radius:6px; cursor:pointer; font-size:clamp(14px,1.6vw,18px); font-weight:600; width:100%;";
    deleteBtn.addEventListener("click", () => {
     if (!currentNodeId) return;
     challengeTheImmortal(`Delete node "${NODE_DATA[currentNodeId]?.name || currentNodeId}" and all its connections?`,
      () => {
       EDGE_DATA.list = EDGE_DATA.list.filter(
        (e) => e.from !== currentNodeId && e.to !== currentNodeId, );
       delete NODE_DATA[currentNodeId];
       delete savedPositions[currentNodeId];
       delete savedSizes[currentNodeId];
       delete savedStyles[currentNodeId];
       currentNodeId = null;
       currentEdgeId = null;
       forgeTheTopology();
       const remainingNodes = Object.keys(NODE_DATA);
       if (remainingNodes.length > 0) {
        claimTheImmortal(remainingNodes[0]);
       } else {
        document.getElementById("node-panel").style.display = "none";
        document.getElementById("edge-panel").style.display = "none";
        document.getElementById("topology-toolbar", ).style.display = "none";
       }
      }, );
    });
    nodePanel.appendChild(deleteBtn);
   })();

   function screenshotCanvas() {
    const svg = document.getElementById("map");
    const svgClone = svg.cloneNode(true);
    const viewBox = svg.getAttribute("viewBox").split(" ").map(Number);
    const [x, y, width, height] = viewBox;
    svgClone.setAttribute("width", width);
    svgClone.setAttribute("height", height);
    svgClone.setAttribute("viewBox", `${x} ${y} ${width} ${height}`);
    const wrapper = document.createElement("div");
    wrapper.style.position = "absolute";
    wrapper.style.left = "-9999px";
    wrapper.appendChild(svgClone);
    document.body.appendChild(wrapper);

    function inlineStyles(original, clone) {
     const elements = original.querySelectorAll("*");
     const clonedElements = clone.querySelectorAll("*");
     const rootStyles = getComputedStyle(document.documentElement);
     const bgColor = rootStyles.getPropertyValue("--bg").trim() || "#050608";
     const bgRect = document.createElementNS("http://www.w3.org/2000/svg", "rect", );
     bgRect.setAttribute("x", x);
     bgRect.setAttribute("y", y);
     bgRect.setAttribute("width", width);
     bgRect.setAttribute("height", height);
     bgRect.setAttribute("fill", bgColor);
     clone.insertBefore(bgRect, clone.firstChild);
     elements.forEach((el, index) => {
      const clonedEl = clonedElements[index];
      if (!clonedEl) return;
      const computedStyle = getComputedStyle(el);
      const svgProps = ["fill", "stroke", "stroke-width", "stroke-dasharray", "stroke-linecap", "stroke-linejoin", "opacity", "font-family", "font-size", "font-weight", "font-style", "text-anchor", "dominant-baseline", "marker-start", "marker-end", ];
      svgProps.forEach((prop) => {
       const value = computedStyle.getPropertyValue(prop);
       if (value && value !== "none" && value !== "normal") {
        clonedEl.style[prop] = value;
       }
      });
      clonedEl.removeAttribute("class");
     });
    }
    inlineStyles(svg, svgClone);
    const svgData = new XMLSerializer().serializeToString(svgClone);
    document.body.removeChild(wrapper);
    const svgBlob = new Blob([svgData], {
     type: "image/svg+xml;charset=utf-8",
    });
    const url = URL.createObjectURL(svgBlob);
    const img = new Image();
    img.onload = function() {
     const canvas = document.createElement("canvas");
     canvas.width = width;
     canvas.height = height;
     const ctx = canvas.getContext("2d");
     ctx.drawImage(img, 0, 0);
     canvas.toBlob(function(blob) {
      const link = document.createElement("a");
      const timestamp = new Date().toISOString().slice(0, 10);
      link.download = `topology-${timestamp}.png`;
      link.href = URL.createObjectURL(blob);
      link.click();
      URL.revokeObjectURL(url);
      URL.revokeObjectURL(link.href);
     }, "image/png");
    };
    img.onerror = function() {
     console.error("Failed to load SVG image");
     alert("Screenshot failed. Please try again.");
     URL.revokeObjectURL(url);
    };
    img.src = url;
   }

   function exportCanvasSVG() {
    const svg = document.getElementById("map");
    const svgClone = svg.cloneNode(true);
    const viewBox = svg.getAttribute("viewBox").split(" ").map(Number);
    const [x, y, width, height] = viewBox;
    svgClone.setAttribute("width", width);
    svgClone.setAttribute("height", height);
    const rootStyles = getComputedStyle(document.documentElement);
    const bgColor = rootStyles.getPropertyValue("--bg").trim() || "#050608";
    const bgRect = document.createElementNS("http://www.w3.org/2000/svg", "rect", );
    bgRect.setAttribute("x", x);
    bgRect.setAttribute("y", y);
    bgRect.setAttribute("width", width);
    bgRect.setAttribute("height", height);
    bgRect.setAttribute("fill", bgColor);
    svgClone.insertBefore(bgRect, svgClone.firstChild);
    const wrapper = document.createElement("div");
    wrapper.style.position = "absolute";
    wrapper.style.left = "-9999px";
    wrapper.appendChild(svgClone);
    document.body.appendChild(wrapper);
    const elements = svg.querySelectorAll("*");
    const clonedElements = svgClone.querySelectorAll("*");
    elements.forEach((el, index) => {
     const clonedEl = clonedElements[index];
     if (!clonedEl) return;
     const computedStyle = getComputedStyle(el);
     const svgProps = ["fill", "stroke", "stroke-width", "stroke-dasharray", "stroke-linecap", "stroke-linejoin", "opacity", "font-family", "font-size", "font-weight", "font-style", "text-anchor", "dominant-baseline", "marker-start", "marker-end", ];
     svgProps.forEach((prop) => {
      const value = computedStyle.getPropertyValue(prop);
      if (value && value !== "none" && value !== "normal") {
       clonedEl.setAttribute(prop, value);
      }
     });
     clonedEl.removeAttribute("class");
    });
    const svgData = new XMLSerializer().serializeToString(svgClone);
    document.body.removeChild(wrapper);
    const blob = new Blob([svgData], {
     type: "image/svg+xml;charset=utf-8",
    });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    const timestamp = new Date().toISOString().slice(0, 10);
    link.download = `topology-${timestamp}.svg`;
    link.href = url;
    link.click();
    URL.revokeObjectURL(url);
   }
  </script>
 
</body></html>